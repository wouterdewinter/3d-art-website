(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{327:function(e,t){},400:function(e,t,n){},401:function(e,t,n){},409:function(e,t){},449:function(e,t,n){var r=n(450),a=n(451),i=n(460),o=i.isArray,s=i.equals,c=i.orientRings;function u(e,t){this.vertices=null,this.edges=null,this._closed=!1,this._distance=0,e&&this.data(e),this._arcSegments=void 0!==t?t:5}u.prototype.data=function(e){if(this._edges=[],!o(e))throw new Error("Offset requires at least one coodinate to work with");return o(e)&&"number"===typeof e[0]?this.vertices=e:(this.vertices=e,this._processContour(this.vertices,this._edges)),this},u.prototype._processContour=function(e,t){var n,a;if(o(e[0])&&"number"===typeof e[0][0])for(a=e.length,s(e[0],e[a-1])&&(a-=1),n=0;n<a;n++)t.push(new r(e[n],e[(n+1)%a]));else for(n=0,a=e.length;n<a;n++)t.push([]),this._processContour(e[n],t[t.length-1])},u.prototype.arcSegments=function(e){return this._arcSegments=e,this},u.prototype.validate=function(e){var t=e.length;return"number"===typeof e[0]?[e]:(e[0][0]===e[t-1][0]&&e[0][1]===e[t-1][1]&&t>1&&(e=e.slice(0,t-1),this._closed=!0),e)},u.prototype.createArc=function(e,t,n,r,a,i,o){var s=2*Math.PI,c=Math.atan2(r[1]-t[1],r[0]-t[0]),u=Math.atan2(a[1]-t[1],a[0]-t[0]);i%2===0&&(i-=1),c<0&&(c+=s),u<0&&(u+=s);var h=c>u?c-u:c+s-u,l=(o?-h:s-h)/i;e.push(r);for(var d=1;d<i;++d)h=c+l*d,e.push([t[0]+Math.cos(h)*n,t[1]+Math.sin(h)*n]);return e.push(a),e},u.prototype.distance=function(e,t){return this._distance=e||0,this},u.degreesToUnits=function(e,t){switch(t){case"miles":e/=69.047;break;case"feet":e/=364568;break;case"kilometers":e/=111.12;break;case"meters":case"metres":e/=111120}return e},u.prototype.ensureLastPoint=function(e){return s(e[0],e[e.length-1])||e.push([e[0][0],e[0][1]]),e},u.prototype.offset=function(e){return this.distance(e),0===this._distance?this.vertices:this._distance>0?this.margin(this._distance):this.padding(-this._distance)},u.prototype._offsetSegment=function(e,t,n,r,a){for(var i=[],o=[n.offsetDist(n._inNormal[0]*r,n._inNormal[1]*r,n._inNormal[0]*a,n._inNormal[1]*a),n.inverseOffsetDist(n._outNormal[0]*r,n._outNormal[1]*r,n._outNormal[0]*a,n._outNormal[1]*a)],s=0;s<2;s++){var c=0===s?r:a,u=o[s],h=o[(s+2-1)%2];this.createArc(i,0===s?e:t,c,h.next,u.current,this._arcSegments,!0)}return i},u.prototype.margin=function(e){if(this.distance(e),"number"===typeof this.vertices[0])return this.offsetPoint(this._distance);if(0===e)return this.vertices;var t=this.offsetLines(this._distance);return t=a.union(this.vertices,t),c(t)},u.prototype.padding=function(e){if(this.distance(e),0===this._distance)return this.ensureLastPoint(this.vertices);if(2===this.vertices.length&&"number"===typeof this.vertices[0])return this.vertices;var t=this.offsetLines(this._distance),n=a.diff(this.vertices,t);return c(n)},u.prototype.offsetLine=function(e){return 0===e?this.vertices:c(this.offsetLines(e))},u.prototype.offsetLines=function(e){if(e<0)throw new Error("Cannot apply negative margin to the line");var t;if(this.distance(e),o(this.vertices[0])&&"number"!==typeof this.vertices[0][0])for(var n=0,r=this._edges.length;n<r;n++)t=0===n?this.offsetContour(this.vertices[n],this._edges[n]):a.union(t,this.offsetContour(this.vertices[n],this._edges[n]));else t=1===this.vertices.length?this.offsetPoint():this.offsetContour(this.vertices,this._edges);return t},u.prototype.getDistance=function(e){return"function"===typeof this._distance?this._distance(e):this._distance},u.prototype.offsetContour=function(e,t){var n,r,i;if(o(e[0])&&"number"===typeof e[0][0])for(r=0,i=e.length-1;r<i;r++){var s=this.ensureLastPoint(this._offsetSegment(e[r],e[r+1],t[r],this.getDistance(r),this.getDistance(r+1)));n=0===r?[this.ensureLastPoint(s)]:a.union(n,this.ensureLastPoint(s))}else for(r=0,i=t.length;r<i;r++)n=0===r?this.offsetContour(e[r],t[r]):a.union(n,this.offsetContour(e[r],t[r]));return n},u.prototype.offsetPoint=function(e){this.distance(e);var t=2*this._arcSegments,n=[],r=this.vertices,a=this._distance,i=0;t%2===0&&t++;for(var o=0;o<t;o++)i+=2*Math.PI/t,n.push([r[0]+a*Math.cos(i),r[1]+a*Math.sin(i)]);return c([this.ensureLastPoint(n)])},u.orientRings=c,e.exports=u},450:function(e,t){function n(e,t){this.current=e,this.next=t,this._inNormal=this.inwardsNormal(),this._outNormal=this.outwardsNormal()}n.prototype.outwardsNormal=function(){var e=this.inwardsNormal();return[-e[0],-e[1]]},n.prototype.inwardsNormal=function(){var e=this.next[0]-this.current[0],t=this.next[1]-this.current[1],n=Math.sqrt(e*e+t*t);if(0===n)throw new Error("Vertices overlap");return[-t/n,e/n]},n.prototype.offset=function(e,t){return n.offsetEdge(this.current,this.next,e,t)},n.prototype.offsetDist=function(e,t,r,a){return new n([this.current[0]+e,this.current[1]+t],[this.next[0]+r,this.next[1]+a])},n.prototype.inverseOffsetDist=function(e,t,r,a){return new n([this.next[0]+r,this.next[1]+a],[this.current[0]+e,this.current[1]+t])},n.prototype.inverseOffset=function(e,t){return n.offsetEdge(this.next,this.current,e,t)},n.offsetEdge=function(e,t,r,a){return new n([e[0]+r,e[1]+a],[t[0]+r,t[1]+a])},n.prototype.inverse=function(){return new n(this.next,this.current)},e.exports=n},460:function(e,t){var n=e.exports.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};e.exports.equals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.exports.orientRings=function e(t,r,a){var i,o;if(r=r||0,n(t)&&"number"===typeof t[0][0]){var s=0,c=t;for(i=0,o=c.length;i<o;i++){var u=c[i],h=c[(i+1)%o];s+=u[0]*h[1],s-=h[0]*u[1]}(!a&&s>0||a&&s<0)&&c.reverse()}else for(i=0,o=t.length;i<o;i++)e(t[i],r+1,i>0);return t}},482:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"intersection",(function(){return cn})),n.d(r,"union",(function(){return un}));var a,i,o=n(5),s=n(4),c=n.n(s),u=n(84),h=n.n(u),l=(n(400),n(401),n(24)),d=n(521),f=n(382),p=n(492),m=n(540),v=n(541),j=n(525),b=n(13),g=n(43),x=n(77),O=n(82);!function(e){e[e.WHITE=0]="WHITE",e[e.BLACK=1]="BLACK",e[e.BLACK_GLOSSY=2]="BLACK_GLOSSY",e[e.DARK_BLUE=3]="DARK_BLUE",e[e.LIGHT_BLUE=4]="LIGHT_BLUE",e[e.GREEN=5]="GREEN",e[e.ORANGE=6]="ORANGE",e[e.BROWN=7]="BROWN",e[e.YELLOW=8]="YELLOW",e[e.BLACK_MATTE=9]="BLACK_MATTE",e[e.GRAY=10]="GRAY",e[e.RED=11]="RED",e[e.GOLD=12]="GOLD",e[e.WIRE=13]="WIRE",e[e.PLYWOOD=14]="PLYWOOD",e[e.REDWOOD=15]="REDWOOD"}(i||(i={}));var y,w,M,C=(a={},Object(O.a)(a,i.BLACK,(function(e){var t=new b.PBRMaterial("BLACK",e);t.albedoColor=new b.Color3(0,0,0),t.roughness=.5;var n=new b.Texture("/assets/plastic-rough/base.jpg",e),r=new b.Texture("/assets/plastic-rough/normal.jpg",e);return t.albedoTexture=n,t.bumpTexture=r,t})),Object(O.a)(a,i.BLACK_GLOSSY,(y=0,w=0,M=0,function(e){var t=new b.PBRMaterial("RGB(".concat(y,", ").concat(w,", ").concat(M,")"),e);return t.albedoColor=new b.Color3(y/255,w/255,M/255).toLinearSpace(),t.roughness=.1,t.metallic=0,t})),Object(O.a)(a,i.BLACK_MATTE,(function(e){var t=new b.PBRMaterial("BLACK_MATTE",e);return t.albedoColor=new b.Color3(.1,.1,.1),t.roughness=.9,t})),Object(O.a)(a,i.GOLD,(function(e){var t=new b.PBRMaterial("GOLD",e),n=new b.Texture("/assets/gold.jpg",e);return t.microSurface=.76,t.albedoColor=new b.Color3(.45,.4,.05),t.reflectivityColor=new b.Color3(.9,.8,.1),t.reflectivityTexture=n,t.environmentIntensity=.45,t.directIntensity=.65,t})),Object(O.a)(a,i.WIRE,(function(e){var t=new b.StandardMaterial("WIRE",e);return t.diffuseColor=new b.Color3(.8,.8,.8),t.wireframe=!0,t})),Object(O.a)(a,i.RED,E(180,0,0)),Object(O.a)(a,i.DARK_BLUE,E(21,22,171)),Object(O.a)(a,i.LIGHT_BLUE,E(45,150,233)),Object(O.a)(a,i.GREEN,E(56,189,122)),Object(O.a)(a,i.ORANGE,E(255,126,13)),Object(O.a)(a,i.BROWN,E(160,82,45)),Object(O.a)(a,i.YELLOW,E(227,213,17)),Object(O.a)(a,i.WHITE,E(220,220,220)),Object(O.a)(a,i.GRAY,E(70,70,70)),Object(O.a)(a,i.PLYWOOD,(function(e){var t=new b.PBRMaterial("PLYWOOD",e);return t.roughness=.7,t.metallic=0,t.environmentIntensity=0,t.albedoTexture=new b.Texture("/assets/plywood/Wood_Plywood_Front_001_basecolor.jpg",e),t})),Object(O.a)(a,i.REDWOOD,(function(e){var t=new b.PBRMaterial("REDWOOD",e);return t.roughness=.2,t.metallic=0,t.albedoTexture=new b.Texture("/assets/redwood/Wood_016_basecolor.jpg",e),t.reflectivityTexture=new b.Texture("/assets/redwood/Wood_016_roughness.jpg",e),t.bumpTexture=new b.Texture("/assets/redwood/Wood_016_normal.jpg",e),t.ambientTexture=new b.Texture("/assets/redwood/Wood_016_ambientOcclusion.jpg",e),t})),a);function E(e,t,n){return function(r){var a=new b.PBRMaterial("RGB(".concat(e,", ").concat(t,", ").concat(n,")"),r);return a.albedoColor=new b.Color3(e/255,t/255,n/255).toLinearSpace(),a.bumpTexture=new b.Texture("/assets/plastic-rough/normal.jpg",r),a.roughness=.7,a.metallic=0,a}}var T=n(83),S=n.n(T);function R(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=25,i=35,o=3,s=3,c=5,u=[],h=[new b.Vector2(t,0),new b.Vector2(e,0),new b.Vector2(i-c,n),new b.Vector2(i,n),new b.Vector2(t,0)],l=new b.PolygonMeshBuilder("support",h.reverse()),d=0;d<r;d++){var f=l.build(!1,s);f.rotation.x=Math.PI/2,f.rotation.y=d*(2*Math.PI)/r,u.push(f)}var p=[new b.Vector3(a,0,0),new b.Vector3(i,0,0),new b.Vector3(i,o,0),new b.Vector3(a,o,0),new b.Vector3(a,0,0)],m=b.MeshBuilder.CreateLathe("ring",{shape:p,radius:1,tessellation:64,closed:!0});m.convertToFlatShadedMesh(),m.position.y=-n,u.push(m);var v=b.Mesh.MergeMeshes(u,!0);if(!v)throw new Error("merging failed");return v}function L(e){for(var t=S()(e.seed+""),n=e.sizeY/30,r=.2,a=[],i=null,o=e.sizeY/2,s=29;s>=0;s--){var c=Math.acos(s/30),u=Math.sin(c)*e.sizeX/2,h=i?i-r:u-2;if(29===s){var l=R(h,h+1,5);l.position.y=o,a.push(l)}i=u;var d=A(h,u,r,1,150,t);d.position.y=o,o-=r,a.push(d);var f=A(u-r,u,n,e.fill,150,t);f.position.y=o,o-=n,a.push(f)}var p=b.Mesh.MergeMeshes(a,!0,!0);if(null===p)throw new Error("Mesh cannot be null");return p}function A(e,t,n,r,a,i){for(var o=[],s=[],c=[],u=!1,h=0,l=0;l<=a;l++){var d=l*(Math.PI/(a/2)),f=new b.Vector2(Math.sin(d)*e,Math.cos(d)*e),p=new b.Vector2(Math.sin(d)*t,Math.cos(d)*t),m=h>10||i()<r;if(!u&&m&&(u=!0),u){if(s.push(f),c.push(p),h=0,!m&&s.length>1){var v=[];v.push.apply(v,Object(g.a)(s)),v.push.apply(v,Object(g.a)(c.reverse())),v.push(s[0]),o.push(v),s=[],c=[],u=!1}}else h++}if(u&&s.length>1){var j=[];j.push.apply(j,Object(g.a)(s)),j.push.apply(j,Object(g.a)(c.reverse())),j.push(s[0]),o.push(j)}var x=o.map((function(e){return new b.PolygonMeshBuilder("polytri",e).build(!1,n)}));return b.Mesh.MergeMeshes(x,!0)}n(322),n(410);function N(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:400,r=new b.Scene(e,{useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0});r.clearColor=new b.Color4(.9,.9,.9);var a=new b.ArcRotateCamera("camera",-Math.PI/2,Math.PI/2.5,n,b.Vector3.Zero(),r);a.attachControl(t,!0);var i=new b.HemisphericLight("scene-light",new b.Vector3(1,.7,1),r);i.intensity=.5;var o=new b.GlowLayer("glow",r);return o.intensity=2,r.blockMaterialDirtyMechanism=!0,window.addEventListener("keypress",(function(e){"d"===e.key&&(r.debugLayer.isVisible()?r.debugLayer.hide():r.debugLayer.show({showExplorer:!0}))})),r}function k(){var e=Object(s.useRef)(null),t=Object(s.useState)(i.BLACK),n=Object(l.a)(t,2),r=n[0],a=n[1],c=Object(s.useState)(28),u=Object(l.a)(c,2),h=u[0],g=u[1],O=Object(s.useState)(10),y=Object(l.a)(O,2),w=y[0],M=y[1],E=Object(s.useState)(.1),T=Object(l.a)(E,2),S=T[0],R=T[1],A=[{value:10,label:"10cm"},{value:80,label:"80cm"}],k=[{value:10,label:"10cm"},{value:50,label:"50cm"}],P=[{value:.1,label:"10%"},{value:1,label:"100%"}];return Object(s.useEffect)((function(){console.log("running setup"),e.current=function(e){var t=document.getElementById("renderCanvas"),n=new b.Engine(t,!0),r=N(n,t),a=function(e,t){var n=L(e);n.material=C[e.material](t);var r=0;return t.beforeRender=function(){r+=.003,n.rotation.y=r},{onUpdate:function(e){n.dispose(),(n=L(e)).material=C[e.material](t)},startExport:function(){x.STLExport.CreateSTL([n],!0,"export")}}}(e,r),i=a.onUpdate,o=a.startExport;return n.runRenderLoop((function(){r.render()})),window.addEventListener("resize",(function(){n.resize()})),{onUpdate:i,startExport:o}}({sizeX:h,sizeY:w,material:r,fill:S,seed:123})}),[]),Object(s.useEffect)((function(){console.log("size changed to ",h,w),e.current&&e.current.onUpdate({sizeX:h,sizeY:w,material:r,fill:S,seed:123})}),[h,w,r,S]),Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)(d.a,{container:!0,spacing:3,children:[Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:600,height:600})}),Object(o.jsxs)(d.a,{item:!0,xs:3,children:[Object(o.jsx)(f.a,{id:"material-select",gutterBottom:!0,children:"Kleur"}),Object(o.jsxs)(p.a,{labelId:"material-select",value:r,onChange:function(e){a(e.target.value)},children:[Object(o.jsx)(m.a,{value:i.WHITE,children:"Wit"}),Object(o.jsx)(m.a,{value:i.BLACK,children:"Zwart"}),Object(o.jsx)(m.a,{value:i.DARK_BLUE,children:"Blauw"})]}),Object(o.jsx)(f.a,{id:"slider-size-x",gutterBottom:!0,children:"Breedte"}),Object(o.jsx)(v.a,{marks:A,min:A[0].value,max:A[1].value,value:h,onChange:function(e,t){g(t)},"aria-labelledby":"slider-size-x"}),Object(o.jsx)(f.a,{id:"slider-size-y",gutterBottom:!0,children:"Hoogte"}),Object(o.jsx)(v.a,{marks:k,min:k[0].value,max:k[1].value,value:w,onChange:function(e,t){M(t)},"aria-labelledby":"slider-size-y"}),Object(o.jsx)(f.a,{id:"slider-fill",gutterBottom:!0,children:"Opvulling"}),Object(o.jsx)(v.a,{marks:P,min:P[0].value,max:P[1].value,step:.05,value:S,onChange:function(e,t){R(t)},"aria-labelledby":"slider-fill"}),Object(o.jsx)(j.a,{onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})]})]})})}var P=n(373),I=n(86),B=n(74),W=n(75),z=n(415);function D(e){var t=new V,n=new z({productions:{X:{successors:[{weight:.7,successor:"FFF-[[X]+X]+F[+FX]-X"},{weight:.3,successor:"FF-[X+]+FF[-FX]-XF"}]},F:{successors:[{weight:.8,successor:"F"},{weight:.17,successor:"FF"},{weight:.03,successor:"FF+"}]}},finals:{F:function(){t.line()},"+":function(){t.rotate(22.5+10*Math.random())},"-":function(){t.rotate(10*+Math.random()-22.5)},"[":function(){t.pushContext()},"]":function(){t.popContext()}}});n.setAxiom("X"),n.iterate(5),n.final();var r=t.getMesh();return r.position.y=-20,r}var V=function(){function e(){Object(B.a)(this,e),this.context={x:0,y:0,rotation:0,width:.5,length:2},this.stack=[],this.meshes=[]}return Object(W.a)(e,[{key:"rotate",value:function(e){this.context.rotation+=e,this.context.rotation<0&&(this.context.rotation+=360),this.context.rotation>360&&(this.context.rotation-=360)}},{key:"line",value:function(){this.context.width+=(Math.random()-.5)/100;var e=this.context.x+Math.sin(this.context.rotation/360*2*Math.PI)*this.context.length,t=this.context.y+Math.cos(this.context.rotation/360*2*Math.PI)*this.context.length,n=[new b.Vector3(this.context.x,this.context.y,0),new b.Vector3(e,t,0)];this.context.x=e,this.context.y=t;var r=b.MeshBuilder.CreateTube("tube",{path:n,radius:this.context.width,tessellation:8,sideOrientation:b.Mesh.DOUBLESIDE});this.meshes.push(r)}},{key:"pushContext",value:function(){this.stack.push(Object(I.a)({},this.context)),this.context.width*=.5,this.context.length*=.8}},{key:"popContext",value:function(){var e=this.stack.pop();if(!e)throw new Error("Unexpected end of stack");this.context=e,this.context.width*=.8,this.context.length*=.8}},{key:"getMesh",value:function(){var e=b.Mesh.MergeMeshes(this.meshes,!0,!0);if(!e)throw new Error("merging failed");return e}}]),e}();function F(){var e=Object(s.useRef)(null),t=Object(s.useState)(i.BLACK),n=Object(l.a)(t,2),r=n[0],a=n[1],c=Object(s.useState)(28),u=Object(l.a)(c,2),h=u[0],g=u[1],O=Object(s.useState)(10),y=Object(l.a)(O,2),w=y[0],M=y[1],E=Object(s.useState)(.1),T=Object(l.a)(E,2),S=T[0],R=T[1],L=[{value:10,label:"10cm"},{value:80,label:"80cm"}],A=[{value:10,label:"10cm"},{value:50,label:"50cm"}],k=[{value:.1,label:"10%"},{value:1,label:"100%"}];return Object(s.useEffect)((function(){console.log("running setup"),e.current=function(e){var t=document.getElementById("renderCanvas"),n=new b.Engine(t,!0),r=N(n,t),a=function(e,t){var n=D();return n.material=C[e.material](t),t.beforeRender=function(){},{onUpdate:function(e){n.dispose(),(n=D()).material=C[e.material](t)},startExport:function(){x.STLExport.CreateSTL([n],!0,"export")}}}(e,r),i=a.onUpdate,o=a.startExport;return n.runRenderLoop((function(){r.render()})),window.addEventListener("resize",(function(){n.resize()})),{onUpdate:i,startExport:o}}({sizeX:h,sizeY:w,material:r,fill:S,seed:1234})}),[]),Object(s.useEffect)((function(){console.log("size changed to ",h,w),e.current&&e.current.onUpdate({sizeX:h,sizeY:w,material:r,fill:S,seed:1234})}),[h,w,r,S]),Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)(d.a,{container:!0,spacing:3,children:[Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:600,height:600})}),Object(o.jsxs)(d.a,{item:!0,xs:3,children:[Object(o.jsx)(f.a,{id:"material-select",gutterBottom:!0,children:"Kleur"}),Object(o.jsxs)(p.a,{labelId:"material-select",value:r,onChange:function(e){a(e.target.value)},children:[Object(o.jsx)(m.a,{value:i.WHITE,children:"Wit"}),Object(o.jsx)(m.a,{value:i.BLACK,children:"Zwart"}),Object(o.jsx)(m.a,{value:i.DARK_BLUE,children:"Blauw"})]}),Object(o.jsx)(f.a,{id:"slider-size-x",gutterBottom:!0,children:"Breedte"}),Object(o.jsx)(v.a,{marks:L,min:L[0].value,max:L[1].value,value:h,onChange:function(e,t){g(t)},"aria-labelledby":"slider-size-x"}),Object(o.jsx)(f.a,{id:"slider-size-y",gutterBottom:!0,children:"Hoogte"}),Object(o.jsx)(v.a,{marks:A,min:A[0].value,max:A[1].value,value:w,onChange:function(e,t){M(t)},"aria-labelledby":"slider-size-y"}),Object(o.jsx)(f.a,{id:"slider-fill",gutterBottom:!0,children:"Opvulling"}),Object(o.jsx)(v.a,{marks:k,min:k[0].value,max:k[1].value,step:.05,value:S,onChange:function(e,t){R(t)},"aria-labelledby":"slider-fill"}),Object(o.jsx)(j.a,{onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})]})]})})}var G=n(46),_=n.n(G),H=n(85),U=function(){function e(t){Object(B.a)(this,e),this.ctx=t}return Object(W.a)(e,[{key:"init",value:function(){this.ctx.fillStyle="#333333",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}},{key:"drawAttractor",value:function(e){this.ctx.beginPath(),this.ctx.arc(e.position.x,e.position.y,5,0,2*Math.PI),this.ctx.fillStyle=e.killed?"#aa4444":"#444444",this.ctx.fill()}},{key:"drawSegment",value:function(e,t){this.ctx.beginPath(),this.ctx.moveTo(t.position.x,t.position.y),this.ctx.lineTo(e.position.x,e.position.y),this.ctx.strokeStyle="#ffffff",this.ctx.lineWidth=1+Math.round(t.numBranches/10),this.ctx.stroke()}}]),e}(),Y=n(0),K=n(9);function Z(e,t,n){return n()*(t-e)+e}function X(e,t,n,r,a){for(var i=[],o=360/r,s=0;s<360;s+=o){var c=e+Math.sin(s*Math.PI/180)*n,u=t+Math.cos(s*Math.PI/180)*n;i.push(a.addNode(new Y.d(c,u)))}return i}function q(e,t,n,r,a){return r+(e-t)/(n-t)*(a-r)}function J(e,t){return Object.keys(e).filter((function(n){return e[n]!==t[n]}))}function Q(e){return new Promise((function(t){return setTimeout(t,e)}))}function $(e){return{shape:ee(e[0]),holes:e.slice(1).map((function(e){return ee(e).reverse()}))}}function ee(e){return e.map((function(e){return new Y.e(e[0],0,e[1])}))}function te(e){return e.map((function(e){return new Y.d(e[0],e[1])}))}function ne(e,t){return t.length>0?[re(e)].concat(Object(g.a)(t.map((function(e){return re(e)})))):[re(e)]}function re(e){return e.map((function(e){return[e.x,e.z]}))}function ae(e,t){return t.length>0?[ie(e)].concat(Object(g.a)(t.map((function(e){return ie(e)})))):[ie(e)]}function ie(e){return e.map((function(e){return[e.x,e.y]}))}function oe(e){return new Y.d(e.x,e.z)}function se(e){return e.map(oe)}function ce(e){return new Y.e(e.x,0,e.y)}function ue(e){return e.map(ce)}function he(e,t,n,r,a){for(var i=Math.floor(e/n),o=Math.floor(t/n),s=[],c=0;c<o;c++)for(var u=0;u<i;u++){var h={position:new Y.d(u*n+Z(-r,r,a)+n/2,c*n+Z(-r,r,a)+n/2),killed:!1,reached:!1};s.push(h)}return s}var le={aspectRatio:1,leafAmount:.1};function de(e){for(var t=Object(I.a)(Object(I.a)({},le),e),n=S()(t.seed),r=[],a=t.innerRadius;a<t.outerRadius;a+=t.distance*t.aspectRatio)for(var i=360/(2*a*Math.PI/t.distance),o=0;o<360;o+=i){var s=o*Math.PI/180,c=(1-t.leafAmount+(1-Math.abs(Math.cos(s*t.numLeafs)))*t.leafAmount)*a,u=t.centerX+Math.sin(s)*c,h=t.centerY+Math.cos(s)*c;n()>t.dropOut&&r.push({position:new Y.d(u+Z(-t.noise,t.noise,n),h+Z(-t.noise,t.noise,n)),killed:!1,reached:!1})}return r}var fe=n(72),pe=n(316);function me(e,t){var n=180*Math.atan2(t,e)/Math.PI;return(360+Math.round(n))%360}var ve={killDistance:30,segmentLength:10,attractionDistance:300,maxIterations:500,openVenation:!1,averageJitter:.001,rotation:0,seed:"123",distanceMethod:"normal"},je=function(){function e(t){Object(B.a)(this,e),this.settings=void 0,this.randomGenerator=void 0,this.nodes=[],this.attractors=[],this.directionRotationMatrix=void 0,this.settings=Object(I.a)(Object(I.a)({},ve),t),this.randomGenerator=S()(this.settings.seed),this.settings.rotation>0&&(this.directionRotationMatrix=Y.a.RotationAxis(Y.e.Forward(),this.settings.rotation))}return Object(W.a)(e,[{key:"getNodes",value:function(){return this.nodes}},{key:"getAttractors",value:function(){return this.attractors}},{key:"setAttractors",value:function(e){this.attractors=e}},{key:"run",value:function(e){var t=this;return new Promise((function(n,r){if(0===e){for(var a=0;a<t.settings.maxIterations;a++){if(t.stepFunction())break}n()}else var i=0,o=setInterval((function(){(t.stepFunction()||i>t.settings.maxIterations)&&(clearInterval(o),n()),i++}),e)}))}},{key:"stepFunction",value:function(){var e=this,t=this.nodes.filter((function(e){return!e.inactive})),n=new pe.a(t,(function(e){return e.position.x}),(function(e){return e.position.y})),r=[],a=this.attractors.filter((function(e){return!e.killed})).reduce((function(t,a){var i=e.settings.openVenation?e.findNearest(n,a):e.findRelativeNeighbors(n,a),o=Object(l.a)(i,2),s=o[0],c=o[1];return r.push.apply(r,Object(g.a)(c)),s.forEach((function(e){var n=t.get(e);n?n.push(a):t.set(e,[a])})),t}),new Map);return n.points.forEach((function(t,n){if(r.includes(n)){if(a.has(n)){var i=a.get(n);if(i&&i.length>0){var o=e.getAverageDirection(t,i),s={position:t.position.add(o.scale(e.settings.segmentLength)),inactive:!1,children:[],parents:[t],numBranches:0,branchNr:t.children.length>0?t.branchNr+1:t.branchNr,direction:o};t.children.push(s),e.nodes.push(s)}}}else t.inactive=!0})),0===a.size&&(console.log("Done"),!0)}},{key:"findNearest",value:function(e,t){var n=this,r=e.within(t.position.x,t.position.y,this.settings.attractionDistance),a=null,i=Number.MAX_VALUE;return r.forEach((function(r){var o=e.points[r],s=o.position.subtract(t.position).length();if(s<n.settings.killDistance){n.createLeaf([o],t);return t.killed=!0,be(o,1),[[],[]]}s<i&&(a=r,i=s)})),null===a?[[],[]]:[[a],[a]]}},{key:"findRelativeNeighbors",value:function(e,t){var n,r,a=e.within(t.position.x,t.position.y,this.settings.attractionDistance),i=[],o=[],s=Object(fe.a)(a);try{for(s.s();!(r=s.n()).done;){var c=r.value,u=e.points[c];n=!1;var h,l=u.position.subtract(t.position).length(),d=Object(fe.a)(a);try{for(d.s();!(h=d.n()).done;){var f=h.value;if(c!==f){var p=e.points[f];if(!(p.position.subtract(t.position).length()>l))if(l>u.position.subtract(p.position).length()){n=!0;break}}}}catch(j){d.e(j)}finally{d.f()}n||(l<this.settings.killDistance?o.push(c):i.push(c))}}catch(j){s.e(j)}finally{s.f()}if(o.length>0&&0===i.length){t.killed=!0;var m=o.map((function(t){return e.points[t]})),v=this.createLeaf(m,t);m.forEach((function(e){return e.children.push(v)})),be(v,1/o.length)}return[i,a]}},{key:"getAverageDirection",value:function(e,t){var n,r,a,i=this,o=t.reduce((function(t,n){var r=n.position.subtract(e.position);if("weight"===i.settings.distanceMethod){var a=Math.pow((i.settings.attractionDistance-r.length())/i.settings.attractionDistance,10);return t.add(r.normalize().scale(a))}return t.add(r)}),Y.d.Zero()).normalize();return n=o,r=this.settings.averageJitter,a=this.randomGenerator,n.x=n.x+Z(-r,r,a),n.y=n.y+Z(-r,r,a),o=n,this.directionRotationMatrix&&Y.d.TransformToRef(o,this.directionRotationMatrix,o),o}},{key:"createLeaf",value:function(e,t){var n={position:t.position.clone(),inactive:!0,children:[],parents:e,numBranches:e[0].numBranches,branchNr:e[0].branchNr};return this.nodes.push(n),t.reached=!0,n}},{key:"addNode",value:function(e,t){var n={position:e,inactive:!1,children:[],parents:t?[t]:[],numBranches:0,branchNr:0};return this.nodes.push(n),t&&(n.branchNr=t.children.length>0?t.branchNr+1:t.branchNr,n.direction=n.position.subtract(t.position),t.children.push(n)),n}}]),e}();function be(e,t){e.numBranches+=t,e.parents.forEach((function(e){return be(e,t)}))}var ge=function(e){var t=Object(s.useRef)(null);return Object(s.useEffect)((function(){var n=t.current;if(n){var r=n.getContext("2d");r&&function(e,t){xe.apply(this,arguments)}(r,e)}}),[]),Object(o.jsx)(d.a,{children:Object(o.jsx)("canvas",{ref:t,width:700,height:700})})};function xe(){return(xe=Object(H.a)(_.a.mark((function e(t,n){var r,a,i,o,s,c;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new U(t),a=t.canvas.width,i=t.canvas.height,o=new je(Object(I.a)({openVenation:!1,killDistance:10,segmentLength:3,attractionDistance:50,rotation:0},n.settings)),s=de({centerX:a/2,centerY:i/2,innerRadius:100,outerRadius:300,distance:20,noise:5,seed:"123",numLeafs:3,leafAmount:.3,dropOut:0}),r.init(),s.forEach((function(e){return r.drawAttractor(e)})),o.setAttractors(s),X(a/2,i/2,60,3,o),console.time("growth"),c=!1;case 11:return c=o.stepFunction(),o.getNodes().forEach((function(e){e.parents.length>0&&r.drawSegment(e.parents[0],e)})),e.next=15,Q(30);case 15:if(!c){e.next=11;break}case 16:console.timeEnd("growth");case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Oe=function(){return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(d.a,{item:!0,xs:5,children:Object(o.jsx)(ge,{settings:{distanceMethod:"normal",attractionDistance:100}})}),Object(o.jsx)(d.a,{item:!0,xs:5,children:Object(o.jsx)(ge,{settings:{distanceMethod:"weight",attractionDistance:100}})})]})},ye=function(){function e(t,n){Object(B.a)(this,e),this.ctx=t,this.killDistance=n,this.paths=new Map}return Object(W.a)(e,[{key:"init",value:function(){this.ctx.fillStyle="#333333",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}},{key:"drawAttractor",value:function(e){this.ctx.beginPath(),this.ctx.arc(e.position.x,e.position.y,this.killDistance,0,2*Math.PI),this.ctx.fillStyle=e.killed?"#554444":"#444444",this.ctx.fill()}},{key:"drawPath",value:function(e){var t=this;if(!(e.length<2)){var n=this.paths.get(e[0]),r=n||{nodes:e,color:"#"+Math.floor(16777215*Math.random()).toString(16)};n||this.paths.set(e[0],r),this.ctx.beginPath(),this.ctx.moveTo(e[0].position.x,e[0].position.y),e.slice(1).forEach((function(e){t.ctx.lineTo(e.position.x,e.position.y)})),this.ctx.strokeStyle=r.color,this.ctx.stroke(),e.forEach((function(e){t.ctx.beginPath(),t.ctx.arc(e.position.x,e.position.y,2,0,2*Math.PI),t.ctx.fillStyle=r.color,t.ctx.fill()}))}}}]),e}();function we(e){var t,n=[],r=new Map,a=Object(fe.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;n.push.apply(n,Object(g.a)(Me(i,[],r)))}}catch(o){a.e(o)}finally{a.f()}return n}function Me(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map;t.push(e);var r=n.get(e)||new Set;if(n.has(e)||n.set(e,r),t.length>1&&t[t.length-2].parents.includes(e)&&e.children.length>1)return[t];var a=e.children.concat(e.parents).filter((function(t){return!Ce(t,e,n)})),i=a.reduce((function(t,n){var r=Math.abs(n.numBranches-e.numBranches);return(null===t||r<t.delta)&&(t={node:n,delta:r}),t}),null);if(null===i)return[t];r.add(i.node);var o=Me(i.node,t,n),s=a.filter((function(e){return e!==i.node})).map((function(t){return Ce(t,e,n)?[]:(r.add(t),Me(t,[e],n))}));return o.concat.apply(o,Object(g.a)(s))}function Ce(e,t,n){var r=n.get(e);if(r&&r.has(t))return!0;var a=n.get(t);return!(!a||!a.has(e))}var Ee=function(){var e=Object(s.useRef)(null);return Object(s.useEffect)((function(){var t=e.current;if(t){var n=t.getContext("2d");n&&function(e){Te.apply(this,arguments)}(n)}}),[]),Object(o.jsx)(d.a,{children:Object(o.jsx)("canvas",{ref:e,width:1200,height:600})})};function Te(){return(Te=Object(H.a)(_.a.mark((function e(t){var n,r,a,i,o,s,c,u,h,l;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:30,n=new ye(t,30),r=t.canvas.width,a=t.canvas.height,i=S()("123"),o=new je({openVenation:!0,killDistance:30,attractionDistance:300,segmentLength:10,distanceMethod:"weight"}),s=he(r,a,100,0,i),o.setAttractors(s),c=[o.addNode(new Y.d(0,0)),o.addNode(new Y.d(1200,600))],console.time("growth"),u=!1;case 11:return u=o.stepFunction(),h=we(c),n.init(),s.forEach((function(e){return n.drawAttractor(e)})),h.forEach((function(e){n.drawPath(e)})),e.next=18,Q(30);case 18:if(!u){e.next=11;break}case 19:console.timeEnd("growth"),l=we(c),console.log("".concat(l.length," paths ").concat(o.getNodes().length," nodes"));case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Se=n(526),Re=n(489),Le=n(495),Ae=n(246),Ne=n(535);function ke(e,t){var n=[new b.Vector3(t.innerRadius,0,0),new b.Vector3(t.outerRadius,0,0),new b.Vector3(t.outerRadius,t.height,0),new b.Vector3(t.innerRadius,t.height,0),new b.Vector3(t.innerRadius,0,0)];return b.MeshBuilder.CreateLathe(e,{shape:n,radius:1,tessellation:t.tesselation,closed:!0})}function Pe(e,t,n){var r=n(300+Be,300)[1]+4,a=ke("ring",{innerRadius:5.5,outerRadius:8,height:20,tesselation:360});a.convertToFlatShadedMesh(),a.position.y=r-8-10,a.material=e,a.parent=t}var Ie=.5;var Be=14;function We(e,t){var n=new b.TransformNode("root"),r=new Map,a=C[e.material](t),i=0,o=function(t,n){var r=Object(Ne.a)().scale(220).translate([300,300]);if(!r.invert)throw new Error("projection non invertable");var a=r.invert([t,n]);if(!a)throw new Error("cannot map position");var i=a[0]*Math.PI/180,o=a[1]*Math.PI/180,s=10*e.sizeY,c=e.sizeX/2*10,u=s*Math.cos(o)*Math.cos(i),h=c*Math.cos(o)*Math.sin(i),l=c*Math.sin(o);return[h,u-10*e.sizeY/2,l]},s=function(){var t=new je({openVenation:!1,killDistance:10,segmentLength:6,attractionDistance:90,rotation:.5,seed:e.seed}),r=de({centerX:300,centerY:300,innerRadius:100,outerRadius:300,distance:50,noise:2,seed:e.seed,numLeafs:3,dropOut:1-e.fill,aspectRatio:.5});t.setAttractors(r);var i=function(e,t,n,r,a,i){for(var o=[],s=360/a,c=0;c<360;c+=s){var u=e+Math.sin(c*Math.PI/180)*n,h=t+Math.cos(c*Math.PI/180)*n,l=i.addNode(new Y.d(u,h)),d=e+Math.sin(c*Math.PI/180)*r,f=t+Math.cos(c*Math.PI/180)*r,p=i.addNode(new Y.d(d,f));l.children.push(p),p.parents.push(l),o.push(l)}return o}(300,300,Be,Be+10,5,t);return Pe(a,n,o),{iteration:0,done:!1,spaceColonization:t,attractors:r,startNodes:i}},c=s(),u=c.iteration,h=c.done,l=c.spaceColonization,d=c.attractors,f=c.startNodes;t.beforeRender=function(){u++,h||u%5!==0||(h=l.stepFunction(),p(),h&&console.log("Created ".concat(l.getNodes().length," nodes, ").concat(d.length," attractors, ").concat(r.size," tubes, ").concat(n.getChildMeshes().length," meshes"))),i+=.001,n.rotation.y=i};var p=function(e){var i=Math.floor(l.getAttractors().length/f.length);r.forEach((function(e){e.forEach((function(e){e.isActive=!1}))})),we(f).forEach((function(s,c){var u;if(!(s.length<2)){var h=s.map((function(e){return Object(Ae.a)(b.Vector3,Object(g.a)(o(e.position.x,e.position.y)))})),l=null===(u=r.get(s[0]))||void 0===u?void 0:u.get(s[1]);if(l)if(l.isActive=!0,!function(e,t){if(e.length!==t.length)return!1;return e.every((function(e,n){return e===t[n]}))}(l.nodes,s)||e){var d=ze(h,s,a,n,t,i);l.mesh.dispose(),l.mesh=d,l.firstNodeNumBranches=s[0].numBranches,l.numNodes=s.length,l.nodes=s}else l.firstNodeNumBranches!==s[0].numBranches&&(ze(h,s,a,n,t,i,l.mesh),l.firstNodeNumBranches=s[0].numBranches,l.nodes=s);else{var f={mesh:ze(h,s,a,n,t,i),numNodes:s.length,firstNodeNumBranches:s[0].numBranches,nodes:s,isActive:!0};r.has(s[0])||r.set(s[0],new Map);var p=r.get(s[0]);void 0!==p&&p.set(s[1],f)}}})),r.forEach((function(e,t){e.forEach((function(t,n){t.isActive||(t.mesh.dispose(),e.delete(n))})),0===e.size&&r.delete(t)}))};return{onUpdate:function(i){var c=J(e,i);if(console.log(c,"changed"),e=i,c.includes("material")&&(console.log("material changed"),a=C[e.material](t),n.getChildMeshes().forEach((function(e){e.material=a}))),(c.includes("sizeX")||c.includes("sizeY"))&&(console.log("size changed"),n.getChildMeshes().forEach((function(e){e.dispose()})),Pe(a,n,o),p(!0)),c.includes("fill")||c.includes("seed")){console.log("fill or seed changed"),n.getChildMeshes().forEach((function(e){e.dispose()})),r.clear();var m=s();u=m.iteration,h=m.done,l=m.spaceColonization,d=m.attractors,f=m.startNodes}},startExport:function(){x.STLExport.CreateSTL(n.getChildMeshes(),!0,"export",!0)}}}function ze(e,t,n,r,a,i,o){var s=0===t[t.length-1].children.length,c=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.path,a=new b.Path3D(t.path).getTangents(),i=[],o=0;o<r.length;o++)if(o>0&&o<r.length-1){var s=r[o-1].subtract(r[o]).normalize(),c=r[o+1].subtract(r[o]).normalize(),u=s.add(c).normalize(),h=Math.abs(Y.e.GetAngleBetweenVectors(s,c.negate(),Y.e.Zero())/2);if(h>Ie)if(b.Plane.FromPoints(r[o-1],r[o],r[o+1]).normal.equals(Y.e.Zero()))i.push(r[o]);else for(var l=u.cross(a[o]),d=1.1*t.radiusFunction(o),f=r[o].add(u.scale(d)),p=Math.ceil(h/Ie),m=h;m>=-h;m-=h/p*2){var v=Y.a.RotationAxis(l,m),j=Y.e.TransformCoordinates(u.scale(-d),v).add(f);i.push(j)}else i.push(r[o])}else i.push(r[o]);return b.MeshBuilder.CreateTube("tube",Object(I.a)(Object(I.a)({},t),{},{path:i}),n)}("tube",{path:e,radiusFunction:function(e){return function(e,t){var n=q(Math.max(Math.min(e,t),1),1,t,0,1);return q(Math.sqrt(n),0,1,1,4)}(e>t.length-3?0:t[e+1].numBranches,i)},cap:K.a.CAP_ALL,tessellation:6,updatable:!0,instance:o,isLeaf:s},a);return c.material=n,c.parent=r,c}function De(){var e=Object(s.useRef)(null),t=Object(s.useState)("1234"),n=Object(l.a)(t,2),r=n[0],a=n[1],c=Object(s.useState)(i.WHITE),u=Object(l.a)(c,2),h=u[0],f=u[1],g=Object(s.useState)(20),x=Object(l.a)(g,2),O=x[0],y=x[1],w=Object(s.useState)(20),M=Object(l.a)(w,2),C=M[0],E=M[1],T=Object(s.useState)(1),S=Object(l.a)(T,2),R=S[0],L=S[1],A=Object(s.useState)(0),k=Object(l.a)(A,2),P=k[0],I=k[1],B=[{value:10,label:"10cm"},{value:30,label:"30cm"}],W=[{value:10,label:"10cm"},{value:30,label:"30cm"}],z=[{value:.5,label:"50%"},{value:1,label:"100%"}];return Object(s.useEffect)((function(){console.log("running setup"),e.current=function(e,t){var n=document.getElementById("renderCanvas"),r=new b.Engine(n,!0),a=N(r,n),i=We(e,a),o=i.onUpdate,s=i.startExport;return r.runRenderLoop((function(){a.render(),t(Math.round(r.getFps()))})),window.addEventListener("resize",(function(){r.resize()})),{onUpdate:o,startExport:s}}({sizeX:O,sizeY:C,material:h,fill:R,seed:r},I)}),[]),Object(s.useEffect)((function(){e.current&&e.current.onUpdate({sizeX:O,sizeY:C,material:h,fill:R,seed:r})}),[O,C,h,R,r]),Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)(d.a,{item:!0,xs:5,children:[Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:600,height:600}),Object(o.jsx)("br",{}),P," fps"]}),Object(o.jsx)(d.a,{item:!0,xs:3,children:Object(o.jsxs)("form",{style:{padding:"0 30px"},children:[Object(o.jsx)(Se.a,{label:"Naam",value:r,onChange:function(e){return a(e.target.value)}}),Object(o.jsx)("br",{}),Object(o.jsxs)(Re.a,{children:[Object(o.jsx)(Le.a,{id:"material-select",children:"Kleur"}),Object(o.jsxs)(p.a,{labelId:"material-select",value:h,onChange:function(e){f(e.target.value)},children:[Object(o.jsx)(m.a,{value:i.WHITE,children:"Wit"}),Object(o.jsx)(m.a,{value:i.BLACK,children:"Zwart"}),Object(o.jsx)(m.a,{value:i.DARK_BLUE,children:"Blauw"}),Object(o.jsx)(m.a,{value:i.BROWN,children:"Bruin"})]})]}),Object(o.jsx)(Le.a,{id:"slider-size-x",children:"Breedte"}),Object(o.jsx)(v.a,{marks:B,min:B[0].value,max:B[1].value,value:O,onChange:function(e,t){y(t)},"aria-labelledby":"slider-size-x"}),Object(o.jsx)(Le.a,{id:"slider-size-y",children:"Hoogte"}),Object(o.jsx)(v.a,{marks:W,min:W[0].value,max:W[1].value,value:C,onChange:function(e,t){E(t)},"aria-labelledby":"slider-size-y"}),Object(o.jsx)(Le.a,{id:"slider-fill",children:"Opvulling"}),Object(o.jsx)(v.a,{marks:z,min:z[0].value,max:z[1].value,step:.05,value:R,onChange:function(e,t){L(t)},"aria-labelledby":"slider-fill"}),Object(o.jsx)(j.a,{color:"primary",variant:"contained",onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})]})})]})}var Ve=n(378),Fe=n(101);function Ge(e,t,n,r){var a=t/(2*Math.tan(Math.PI/r)),i=b.MeshBuilder.CreateBox("box",{width:t,depth:t,height:n});i.position.z=a+t/2,i.bakeCurrentTransformIntoVertices();for(var o=[],s=0;s<r;s++){var c=s*(2*Math.PI/r),u=i.clone("clone");console.log(c),u.rotation.y=c,u.convertToFlatShadedMesh(),o.push(u)}i.dispose();var h=K.a.MergeMeshes(o);if(!h)throw new Error("merging failed");return{mesh:h,excludeMeshes:[]}}function _e(){var e=Object(s.useRef)(null);return Object(s.useEffect)((function(){console.log("running setup"),e.current=function(){var e=document.getElementById("renderCanvas"),t=new b.Engine(e,!0),n=N(t,e),r=Ge(0,300,100,5).mesh,a=new b.StandardMaterial("myMaterial",n);return a.wireframe=!0,r.material=a,t.runRenderLoop((function(){n.render()})),{startExport:function(){x.STLExport.CreateSTL([r],!0,"export",!0)}}}()}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsx)(d.a,{container:!0,spacing:3,children:Object(o.jsxs)(d.a,{item:!0,xs:6,children:[Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:600,height:600}),Object(o.jsx)(j.a,{onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})]})})})}var He=n(533),Ue=n(534),Ye=n(538),Ke=n(156);function Ze(e){var t=e.getIndices(),n=e.getVerticesData(b.VertexBuffer.PositionKind);if(!n||!t)throw new Error("No positions or indices");for(var r=[],a=0;a<n.length;a+=3)r.push([n[a],n[a+1],n[a+2]]);for(var i=[],o=0;o<t.length;o+=3)i.push([t[o],t[o+1],t[o+2]]);var s=Ke.CSG.polyhedron({points:r,faces:i});return s=(s=(s=(s=s.rotateZ(e.rotation.z*(180/Math.PI))).rotateX(e.rotation.x*(180/Math.PI))).rotateY(e.rotation.y*(180/Math.PI))).translate([e.position.x,e.position.y,e.position.z])}function Xe(e,t){var n=[];e=e.fixTJunctions(e);var r,a=0,i=[],o=Object(fe.a)(e.toTriangles());try{for(o.s();!(r=o.n()).done;){r.value.vertices.forEach((function(e){n.push(e.pos.x,e.pos.y,e.pos.z),i.push(a),a++}))}}catch(h){o.e(h)}finally{o.f()}var s=new b.Mesh("custom",t),c=[];b.VertexData.ComputeNormals(n,i,c);var u=new b.VertexData;return u.positions=n,u.indices=i,u.normals=c,u.applyToMesh(s),s.flipFaces(),s}function qe(){var e=Object(s.useRef)(null),t=Object(s.useState)(!1),n=Object(l.a)(t,2),r=n[0],a=n[1];return Object(s.useEffect)((function(){console.log("running setup"),e.current=function(){var e=document.getElementById("renderCanvas"),t=new b.Engine(e,!0),n=N(t,e),r=[],a=[],i=[],o=b.MeshBuilder.CreateIcoSphere("m",{radius:150,subdivisions:1,flat:!1},n),s=b.Matrix.RotationAxis(Y.e.Right(),60/(180/Math.PI));o.bakeTransformIntoVertices(s);var c=o.getIndices(),u=o.getVerticesData(b.VertexBuffer.NormalKind),h=o.getVerticesData(b.VertexBuffer.PositionKind);if(!u||!h||!c)throw new Error("vertice data not available");for(var l=[],d=0;d<c.length;d+=3){var f=3*c[d],p=b.Vector3.FromArray(h,f),m=b.Vector3.FromArray(h,f+3),v=b.Vector3.FromArray(h,f+6),j=-100;p.y>j&&m.y>j&&v.y>j&&l.push([f,f+3,f+6])}l.forEach((function(e){var t=b.Vector3.FromArray(h,e[0]),n=b.Vector3.FromArray(h,e[1]),a=b.Vector3.FromArray(h,e[2]),o=b.Vector3.FromArray(u,e[0]),s=b.Vector3.FromArray(u,e[1]),c=b.Vector3.FromArray(u,e[2]),l=function(e,t,n,r,a,i,o){var s=[];s.push(Qe(e,t,n,r)),s.push(Qe(t,n,e,a)),s.push(Qe(n,e,t,i));var c=r.add(a).add(i).normalize().scale(5),u=s.map((function(e){return e.map((function(e){return e.add(c)}))})),h=b.RibbonBuilder.CreateRibbon("",{pathArray:u,closeArray:!0,closePath:!0});return h.convertToFlatShadedMesh(),h}(t,n,a,o,s,c);r.push(Ze(l)),l.dispose(),i.push(o.add(s).add(c).normalize())}));var g=new Map;l.forEach((function(e,t){var n=b.Vector3.FromArray(h,e[0]),r=b.Vector3.FromArray(h,e[1]),a=b.Vector3.FromArray(h,e[2]),i=b.Vector3.FromArray(u,e[0]),o=b.Vector3.FromArray(u,e[1]),s=b.Vector3.FromArray(u,e[2]);[[n,r,i,o],[r,a,o,s],[a,n,s,i]].forEach((function(e){var n=function(e,t){var n=e.getHashCode(),r=t.getHashCode();return n>r?"".concat(n,":").concat(r):"".concat(r,":").concat(n)}(e[0],e[1]),r=g.get(n);r?r.pieces.push(t):g.set(n,{pieces:[t],v1:e[0],v2:e[1],n1:e[2],n2:e[3]})}))})),g.forEach((function(e){2===e.pieces.length&&function(e,t,n,r,a,i,o){var s=t.subtract(e),c=n.add(r).normalize().cross(s.clone().normalize()),u=Je(e.add(s.scale(1/3)).subtract(c.scale(10)),c,s.clone().normalize()),h=Ze(u),l=Je(e.add(s.scale(2/3)).subtract(c.scale(10)),c,s.clone().normalize()),d=Ze(l);o[a]=o[a].subtract(h),o[a]=o[a].union(d),o[i]=o[i].union(h),o[i]=o[i].subtract(d),u.dispose(),l.dispose()}(e.v1,e.v2,e.n1,e.n2,e.pieces[0],e.pieces[1],r)})),r.forEach((function(e){var t=Xe(e);a.push(t)}));var O=new b.StandardMaterial("myMaterial",n);return O.wireframe=!0,o.material=O,t.runRenderLoop((function(){n.render()})),{startExport:function(){x.STLExport.CreateSTL(a,!0,"export",!0)},onUpdate:function(e){a.forEach((function(t,n){e.showPieces?t.position=i[n].scale(50):t.position=Y.e.Zero()}))}}}()}),[]),Object(s.useEffect)((function(){e.current.onUpdate({showPieces:r})})),Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)(d.a,{container:!0,spacing:3,children:[Object(o.jsxs)(d.a,{item:!0,xs:6,children:[Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:600,height:600}),Object(o.jsx)(j.a,{onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})]}),Object(o.jsxs)(d.a,{xs:6,children:["Toon stukjes",Object(o.jsx)(Ye.a,{onClick:function(){return a(!r)},checked:r})]})]})})}function Je(e,t,n){var r=e.add(t.scale(10)),a=(e.subtract(t.scale(10)),b.MeshBuilder.CreateBox("joint",{width:2,height:20,depth:2})),i=t,o=n,s=b.Vector3.Cross(o,i);return a.rotation=b.Vector3.RotationFromAxis(o,i,s),a.position=r,a.convertToFlatShadedMesh(),a}function Qe(e,t,n,r){var a=[],i=t.subtract(e),o=n.subtract(e),s=i.add(o).normalize();return a.push(e),a.push(e.add(s.scale(10))),a.push(e.add(s.scale(10)).subtract(r.scale(10))),a.push(e.subtract(r.scale(10))),a}function $e(){var e=Object(s.useRef)(null);return Object(s.useEffect)((function(){console.log("running setup"),e.current=function(){var e=document.getElementById("renderCanvas"),t=new b.Engine(e,!0),n=N(t,e),r=(new b.Vector3(0,50,50),new b.Vector3(0,0,0),new b.Vector3(0,50,0),new b.Vector3(0,100,0),new b.Vector3(20,90,0),function(e){var t=b.MeshBuilder.CreateBox("box",{size:100}),n=b.MeshBuilder.CreateIcoSphere("sphere",{radius:40});n.position.y=60,t.rotation.z=.1;var r=Ze(t),a=Ze(n);return t.dispose(),n.dispose(),Xe(r.subtract(a),e)}(n)),a=new b.StandardMaterial("myMaterial",n);return a.wireframe=!0,r.material=a,t.runRenderLoop((function(){n.render()})),{startExport:function(){x.STLExport.CreateSTL([r],!0,"export",!0)}}}()}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsx)(d.a,{container:!0,spacing:3,children:Object(o.jsxs)(d.a,{item:!0,xs:6,children:[Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:600,height:600}),Object(o.jsx)(j.a,{onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})]})})})}function et(e,t,n,r,a,i,o){if(!(a-r<=n)){var s=r+a>>1;tt(e,t,s,r,a,i,o),et(e,t,n,r,s-1,(1+i)%o,o),et(e,t,n,s+1,a,(1+i)%o,o)}}function tt(e,t,n,r,a,i,o){for(;a>r;){if(a-r>600){var s=a-r+1,c=n-r+1,u=Math.log(s),h=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*h*(s-h)/s)*(c-s/2<0?-1:1);tt(e,t,n,Math.max(r,Math.floor(n-c*h/s+l)),Math.min(a,Math.floor(n+(s-c)*h/s+l)),i,o)}var d=t[o*n+i],f=r,p=a;for(nt(e,t,r,n,o),t[o*a+i]>d&&nt(e,t,r,a,o);f<p;){for(nt(e,t,f,p,o),f++,p--;t[o*f+i]<d;)f++;for(;t[o*p+i]>d;)p--}t[o*r+i]===d?nt(e,t,r,p,o):nt(e,t,++p,a,o),p<=n&&(r=p+1),n<=p&&(a=p-1)}}function nt(e,t,n,r,a){rt(e,n,r),rt(t,a*n+0,a*r+0),rt(t,a*n+1,a*r+1),rt(t,a*n+2,a*r+2)}function rt(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function at(e,t,n,r,a,i){var o=e-r,s=t-a,c=n-i;return o*o+s*s+c*c}var it=function(){function e(t){var n=t.idList,r=t.points,a=t.getX,i=t.getY,o=t.getZ,s=t.nodeSize,c=t.ArrayType,u=t.axisCount;Object(B.a)(this,e),this.nodeSize=s,this.points=r,this.axisCount=u;var h=r.length<65536?Uint16Array:Uint32Array;this.ids=n?n.slice(0):new h(r.length),this.coords=new c(r.length*u);for(var l=0;l<r.length;l++)void 0===n&&(this.ids[l]=l),this.coords[u*l+0]=a(r[l]),this.coords[u*l+1]=i(r[l]),this.coords[u*l+2]=o(r[l]);et(this.ids,this.coords,s,0,this.ids.length-1,0,u)}return Object(W.a)(e,[{key:"range",value:function(e,t,n,r,a,i){return function(e,t,n,r,a,i,o,s,c,u){for(var h=[0,e.length-1,0],l=[];h.length;){var d=h.pop(),f=h.pop(),p=h.pop();if(f-p<=c)for(var m=p;m<=f;m++){var v=t[u*m+0],j=t[u*m+1],b=t[u*m+2];v>=n&&v<=i&&j>=r&&j<=o&&b>=a&&b<=s&&l.push(e[m])}else{var g=p+f>>1,x=t[u*g+0],O=t[u*g+1],y=t[u*g+2];x>=n&&x<=i&&O>=r&&O<=o&&y>=a&&y<=s&&l.push(e[g]);var w=(1+d)%u,M=void 0,C=void 0;switch(d){case 0:M=n<=x,C=i>=x;break;case 1:M=r<=O,C=o>=O;break;case 2:M=a<=y,C=s>=y}M&&(h.push(p),h.push(g-1),h.push(w)),C&&(h.push(g+1),h.push(f),h.push(w))}}return l}(this.ids,this.coords,e,t,n,r,a,i,this.nodeSize,this.axisCount)}},{key:"within",value:function(e,t,n,r){return function(e,t,n,r,a,i,o,s){for(var c=[0,e.length-1,0],u=[],h=i*i;c.length;){var l=c.pop(),d=c.pop(),f=c.pop();if(d-f<=o)for(var p=f;p<=d;p++)at(t[s*p+0],t[s*p+1],t[s*p+2],n,r,a)<=h&&u.push(e[p]);else{var m=f+d>>1,v=t[s*m+0],j=t[s*m+1],b=t[s*m+2];at(v,j,b,n,r,a)<=h&&u.push(e[m]);var g=(1+l)%s,x=void 0,O=void 0;switch(l){case 0:x=n-i<=v,O=n+i>=v;break;case 1:x=r-i<=j,O=r+i>=j;break;case 2:x=a-i<=b,O=a+i>=b}x&&(c.push(f),c.push(m-1),c.push(g)),O&&(c.push(m+1),c.push(d),c.push(g))}}return u}(this.ids,this.coords,e,t,n,r,this.nodeSize,this.axisCount)}}]),e}(),ot={excludeMeshes:[],samplePoints:1e4,thickness:0};function st(e,t){var n=Object(I.a)(Object(I.a)({},ot),t),r=e.getIndices(),a=e.getVerticesData(b.VertexBuffer.NormalKind),i=e.getVerticesData(b.VertexBuffer.PositionKind);if(!a||!i||!r)throw new Error("vertice data not available");for(var o=[],s=0;s<r.length;s+=3){var c=3*r[s],u=[Y.e.FromArray(i,c),Y.e.FromArray(i,c+3),Y.e.FromArray(i,c+6)],h=[Y.e.FromArray(a,c),Y.e.FromArray(a,c+3),Y.e.FromArray(a,c+6)];o.push({positions:u,normals:h})}for(var l=[],d=ct(l),f=function(e){var t=o[Math.floor(n.randomGenerator()*o.length)],r=n.randomGenerator(),a=n.randomGenerator(),i=t.positions[0],s=t.positions[1].subtract(i),c=t.positions[2].subtract(t.positions[1]),u=i.add(s.scale(r)).add(c.scale(r*a));if(n.thickness>0){var h=t.normals[0].add(t.normals[1]).add(t.normals[2]).normalize();u.subtractToRef(h.scale(n.randomGenerator()*n.thickness),u)}0===d.within(u.x,u.y,u.z,n.distance).length&&(n.excludeMeshes.some((function(e){return function(e,t){var n=e.getBoundingInfo(),r=n.maximum,a=n.minimum,i=2*n.boundingSphere.radius;if(t.x<a.x||t.x>r.x)return!1;if(t.y<a.y||t.y>r.y)return!1;if(t.z<a.z||t.z>r.z)return!1;var o,s=!1,c=0,u=new b.Ray(b.Vector3.Zero(),b.Axis.X,i),h=t.clone(),l=t.clone();for(c=0,u.origin=l,u.direction=h,u.length=i,o=u.intersectsMesh(e);o.hit;)o.pickedPoint&&(c++,o.pickedPoint.addToRef(h.scale(1e-8),l),u.origin=l,o=u.intersectsMesh(e));return c%2===1&&(s=!0),s}(e,u)}))||(l.push(u),d=ct(l)))},p=0;p<n.samplePoints;p++)f();return console.info("Found ".concat(l.length," attractors")),l.map((function(e){return{position:e,killed:!1,reached:!1}}))}function ct(e){return new it({points:e,getX:function(e){return e.x},getY:function(e){return e.y},getZ:function(e){return e.z},ArrayType:Array,axisCount:3,nodeSize:1})}function ut(){var e=Object(s.useRef)(null),t=Object(s.useState)(!1),n=Object(l.a)(t,2),r=n[0],a=n[1];return Object(s.useEffect)((function(){console.log("running setup"),e.current=function(){var e=document.getElementById("renderCanvas"),t=new b.Engine(e,!0),n=N(t,e),r=[],a=b.MeshBuilder.CreateBox("m",{size:150},n);a.convertToFlatShadedMesh();var i=b.MeshBuilder.CreateCylinder("c",{height:200,diameter:100}),o=new b.StandardMaterial("myMaterial",n),s=S()("123"),c=st(a,{distance:15,randomGenerator:s,excludeMeshes:[i],thickness:10});return o.wireframe=!0,a.material=o,i.dispose(),c.forEach((function(e){b.MeshBuilder.CreateSphere("",{diameter:5}).position=e.position})),t.runRenderLoop((function(){n.render()})),{startExport:function(){x.STLExport.CreateSTL(r,!0,"export",!0)},onUpdate:function(e){}}}()}),[]),Object(s.useEffect)((function(){e.current.onUpdate({showPieces:r})})),Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)(d.a,{container:!0,spacing:3,children:[Object(o.jsxs)(d.a,{item:!0,xs:8,children:[Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",style:{width:"100%",height:"100%"}}),Object(o.jsx)(j.a,{onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})]}),Object(o.jsxs)(d.a,{xs:4,children:["Toon stukjes",Object(o.jsx)(Ye.a,{onClick:function(){return a(!r)},checked:r})]})]})})}var ht=n(536),lt=n(530);function dt(e){return Object(o.jsxs)(ht.a,{my:1,children:[Object(o.jsxs)(d.a,{container:!0,children:[Object(o.jsx)(d.a,{xs:6,item:!0,children:Object(o.jsx)(f.a,{color:"textSecondary",children:e.label})}),Object(o.jsx)(d.a,{xs:6,item:!0,children:Object(o.jsx)(f.a,{align:"right",color:"textPrimary",children:e.percent?"".concat(100*e.value,"%"):"".concat(e.value).concat(e.units||"")})})]}),Object(o.jsx)(v.a,{min:e.min,max:e.max,step:e.percent?.1:1,value:e.value,onChange:function(t,n){e.setValue(n)},onChangeCommitted:e.onCommit})]})}var ft=n.p+"static/media/xyz-icon.c9e7a493.png";function pt(e){return Object(o.jsxs)(d.a,{item:!0,xs:9,style:{position:"relative",height:"100vh",cursor:"grab"},children:[Object(o.jsxs)("div",{style:{position:"absolute",bottom:"0",left:"0",color:"#aaa",padding:"20px"},children:[e.fps," fps"]}),Object(o.jsxs)("div",{style:{position:"absolute",right:"0",bottom:"0",textAlign:"center",color:"#aaa",padding:"20px"},children:[Object(o.jsx)("img",{src:ft,width:50,alt:"xyz coordinate system by b farias from the Noun Project"}),Object(o.jsx)("br",{}),"Use the mouse to interact with the model"]}),e.loading<1&&Object(o.jsxs)("div",{style:{position:"absolute",left:"0",top:"0",width:"100%",height:"100vh",backgroundColor:"#333333",color:"#ffffff",textAlign:"center",lineHeight:"100vh",opacity:.5,fontSize:"30px",pointerEvents:"none"},children:["Preparing ",Math.round(100*e.loading),"%"]}),Object(o.jsx)("canvas",{id:"renderCanvas",style:{width:"100%",height:"100vh"}})]})}n(230);var mt="bulb";var vt="fitting";var jt=500,bt="pendant";function gt(e,t,n,r){var a=C[i.BLACK_MATTE](t);return function(e,t,n){var r=e.getTransformNodeByName(mt);if(r)return console.log("bulb already loaded, changing position"),void(r.position=n);b.SceneLoader.ImportMesh(null,"/assets/","bulb.obj",e,(function(r,a,i){console.log("light bulb loaded");var o=new b.TransformNode(mt),s=new b.StandardMaterial("ledMaterial",e);s.diffuseColor=new b.Color3(1,1,0),s.specularColor=new b.Color3(1,1,0),s.emissiveColor=new b.Color3(1,1,0);var c=Object(l.a)(r,4),u=(c[0],c[1]),h=c[2];c[3],h.material=s,r.forEach((function(e){return e.parent=o})),o.scaling.setAll(.8),o.rotation.z=Math.PI,o.position=n,o.parent=t;var d=new b.PBRMaterial("glass",e);d.subSurface.isRefractionEnabled=!0,d.indexOfRefraction=.52,d.alpha=.5,d.directIntensity=0,d.environmentIntensity=.7,d.microSurface=1,d.reflectivityColor=new b.Color3(.2,.2,.2),d.albedoColor=new b.Color3(.95,.95,.95),u.material=d;var f=new b.PointLight("bulbLight",new Y.e(0,60,0),e);f.diffuse=new b.Color3(1,.9,.4),f.specular=new b.Color3(1,.9,.4),f.intensity=5e4,f.parent=o}))}(t,e,new b.Vector3(0,n-r-20,0)),function(e,t,n,r){var a=e.getMeshByName(vt);if(a)return console.log("fitting already loaded, changing position"),void(a.position=r);b.SceneLoader.ImportMesh(null,"/assets/","fitting.obj",e,(function(e,a,i){console.log("fitting loaded");var o=Object(l.a)(e,1)[0];o.name=vt,o.material=n,o.parent=t,o.rotation.x=Math.PI/2,o.position=r}))}(t,e,a,new b.Vector3(0,n-r,0)),function(e,t,n,r){var a=e.getTransformNodeByName(bt);a&&(console.log("pendant already loaded, recreating"),a.dispose());var i=new b.TransformNode(bt);i.parent=t;var o=b.MeshBuilder.CreateCylinder("wire",{diameter:6,height:jt-r.y});o.position.y=jt-(jt-r.y)/2,o.material=n,o.parent=i;var s=b.MeshBuilder.CreateCylinder("cap",{diameter:100,height:24});s.position.y=488,s.material=n,s.parent=i;var c=b.MeshBuilder.CreateCylinder("topRelief",{diameter:13,height:15});c.position.y=468.5,c.material=n,c.parent=i;var u=b.MeshBuilder.CreateCylinder("bottomRelief",{diameter:13,height:15});u.position.y=r.y+7.5,u.material=n,u.parent=i}(t,e,a,new b.Vector3(0,n,0)),e}function xt(e){var t=b.CubeTexture.CreateFromPrefilteredData("/assets/environment.dds",e);e.environmentTexture=t,console.log("environment texture loaded")}function Ot(e){var t,n=[],r=new Map,a=Object(fe.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;n.push.apply(n,Object(g.a)(yt(i,[],r)))}}catch(o){a.e(o)}finally{a.f()}return n}function yt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map;t.push(e);var r=n.get(e)||new Set;if(n.has(e)||n.set(e,r),t.length>1&&t[t.length-2].parents.includes(e)&&e.children.length>1)return[t];var a=e.children.concat(e.parents).filter((function(t){return!wt(t,e,n)})),i=a.reduce((function(t,n){var r=Math.abs(n.numBranches-e.numBranches);return(null===t||r<t.delta)&&(t={node:n,delta:r}),t}),null);if(null===i)return[t];r.add(i.node);var o=yt(i.node,t,n),s=a.filter((function(e){return e!==i.node})).map((function(t){return wt(t,e,n)?[]:(r.add(t),yt(t,[e],n))}));return o.concat.apply(o,Object(g.a)(s))}function wt(e,t,n){var r=n.get(e);if(r&&r.has(t))return!0;var a=n.get(t);return!(!a||!a.has(e))}var Mt=n(374);function Ct(e,t,n){var r=e.getVerticesData(b.VertexBuffer.UVKind);if(!r)throw new Error("No UV's found");var a=r.length;if(1!==t)for(var i=0;i<a;i+=2)r[i]*=t;if(1!==n)for(var o=1;o<a;o+=2)r[o]*=n;e.setVerticesData(b.VertexBuffer.UVKind,r)}var Et=function(){function e(t,n,r,a,i){Object(B.a)(this,e),this.spaceColonization=t,this.material=n,this.rootNode=r,this.startNodes=a,this.scene=i,this.numAttractors=0}return Object(W.a)(e,[{key:"drawAll",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=Ot(this.startNodes),r=[],a=Object(fe.a)(n);try{for(a.s();!(e=a.n()).done;){var i=e.value;if(!(i.length<2)){var o=i.map((function(e){return e.position})),s=this.createTube(o,i,t);this.scene.removeMesh(s),r.push(s)}}}catch(c){a.e(c)}finally{a.f()}return r}},{key:"draw",value:_.a.mark((function e(){var t,n,r,a,i,o,s,c,u,h;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.numAttractors=Math.floor(this.spaceColonization.getAttractors().length/this.startNodes.length),t=Ot(this.startNodes),n=t.map((function(e){return{mesh:void 0,isFinished:!1,path:e}})),r=!1,a=[],i=2;case 6:if(r){e.next=37;break}o=n.filter((function(e){return!e.isFinished})),s=Object(fe.a)(o),e.prev=9,s.s();case 11:if((c=s.n()).done){e.next=23;break}if(!((u=c.value).path.length<2)){e.next=15;break}return e.abrupt("continue",21);case 15:if(u.mesh&&u.mesh.dispose(),!((h=u.path.filter((function(e){return e.distance<=i})).map((function(e){return e.position}))).length<2)){e.next=19;break}return e.abrupt("continue",21);case 19:u.mesh=this.createTube(h,u.path,!1),h.length===u.path.length&&(a.push(u.mesh),u.isFinished=!0,a.length>=30&&(a.forEach((function(e){return e.parent=null})),K.a.MergeMeshes(a,!0).parent=this.rootNode,a=[]));case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),s.e(e.t0);case 28:return e.prev=28,s.f(),e.finish(28);case 31:return 0===o.length&&(console.log("done drawing animated"),r=!0),i++,void(e.next=35);case 35:e.next=6;break;case 37:return e.abrupt("return");case 38:case"end":return e.stop()}}),e,this,[[9,25,28,31]])}))},{key:"createTube",value:function(e,t,n){var r=this,a=0===t[t.length-1].children.length,i=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t.interpolatePoints||2,a=b.Curve3.CreateCatmullRomSpline(t.path,r,!1).getPoints(),i=t.path.map((function(e,n){return[n,t.radiusFunction(n)]})),o=new Mt.CurveInterpolator(i,{tension:.5}),s=a.map((function(e,t){return o.getPointAt(t/a.length)[1]}));if(t.isLeaf){var c=a[a.length-1],u=a[a.length-2],h=s[a.length-1];a.pop(),i.pop();for(var l=c.subtract(u),d=0;d<=5;d++){var f=Math.PI/2*(d/5),p=Math.sin(f),m=Math.cos(f),v=u.add(l.scale(p)),j=m*h;a.push(v),s.push(j)}}var g=function(e){return s[e]},x=b.MeshBuilder.CreateTube("tube",Object(I.a)(Object(I.a)({},t),{},{path:a,radiusFunction:g,frontUVs:new Y.f(0,0,10,1)}),n);return Ct(x,1,t.path.length/5),x}("tube",{path:e,radiusFunction:function(e){return function(e,t){var n=q(Math.max(Math.min(e,t),1),1,t,0,1);return q(Math.pow(n,.35),0,1,2.5,15)}(e>t.length-3?0:t[e+1].numBranches,r.numAttractors)},cap:K.a.CAP_ALL,tessellation:n?32:5,interpolatePoints:n?8:4,updatable:!0,isLeaf:a},this.scene);return i.material=this.material,i.parent=this.rootNode,i.cullingStrategy=b.AbstractMesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,i}}]),e}();var Tt;function St(e,t,n,r,a,o){var s=Tt.ATTRACTORS,c=new b.TransformNode("modelRoot"),u=new b.TransformNode("extrasRoot"),h=C[e.material](t),l=C[i.WIRE](t),d=0;xt(t);var f=function(){c.getChildMeshes().forEach((function(e){e.dispose()}));var n=o(e,t);n.mesh.material=l,n.mesh.parent=c;var i=function(e,t){var n=ke("holder",{innerRadius:5.5,outerRadius:15,height:e,tesselation:360});return n.convertToFlatShadedMesh(),n.position=t,n.position.y=n.position.y-e,n}(n.holderHeight,new Y.e(0,n.holderPosition,0));i.material=h,i.parent=c,0===u.getChildMeshes().length&&gt(u,t,n.holderPosition,n.holderHeight);var s=new Et(n.spaceColonization,h,c,n.startNodes,t);c.rotation.y=0,u.rotation.y=0;var d=c.getHierarchyBoundingVectors(),f=d.max.subtract(d.min),p=f.x*f.y*f.z/1e3;return r(0+.014*p),a(f),console.time("grow"),{spaceColonization:n.spaceColonization,tubeDrawer:s,mesh:n.mesh,excludeMeshes:n.excludeMeshes}},p=f(),m=p.spaceColonization,v=p.tubeDrawer,j=p.mesh,g=p.excludeMeshes,O=void 0,y=0;t.beforeRender=function(){if(y++,s===Tt.ATTRACTORS){var t=S()(e.seed),r=5+10*(1-e.fill);console.time("attractors");var a=st(j,{distance:r,randomGenerator:t,excludeMeshes:g,thickness:0});console.timeEnd("attractors"),m.setAttractors(a),g.forEach((function(e){return e.dispose()})),s=Tt.GROWING}s===Tt.DRAWING&&O&&y%5===0&&(O.next().done&&(console.log("done drawing"),console.timeEnd("draw"),O=void 0,s=Tt.DONE));if(s===Tt.GROWING){var i=m.stepFunction(),o=m.getAttractors(),h=o.filter((function(e){return e.killed}));n(h.length/o.length),i&&(O=v.draw(),console.timeEnd("grow"),console.time("draw"),s=Tt.DRAWING,j.dispose())}d+=.001,c.rotation.y=d,u.rotation.y=d};return{onUpdate:function(r){var a=J(e,r);if(console.log(a,"changed"),e=r,a.includes("material"))console.log("material changed"),h=C[e.material](t),c.getChildMeshes().forEach((function(e){e.material=h}));else if(a.includes("seed")){n(1),s=Tt.ATTRACTORS;var i=f();m=i.spaceColonization,v=i.tubeDrawer,j=i.mesh,g=i.excludeMeshes}else{n(1),s=Tt.WAITING_FOR_CHANGE;var o=f();m=o.spaceColonization,v=o.tubeDrawer,j=o.mesh,g=o.excludeMeshes}},startExport:function(){var e=v.drawAll(),n=t.getMeshByName("holder");n&&e.push(n),c.rotation.y=0,u.rotation.y=0,x.STLExport.CreateSTL(e,!0,"export",!0)},commitChanges:function(){s===Tt.WAITING_FOR_CHANGE&&(s=Tt.ATTRACTORS)}}}function Rt(e,t,n,r,a,i){var o=Object(s.useRef)(null);return Object(s.useEffect)((function(){console.log("running setup");var s=document.getElementById("renderCanvas"),c=new b.Engine(s,!0,{}),u=N(c,s);o.current=St(e,u,n,r,a,i),c.runRenderLoop((function(){u.render(),t(Math.round(c.getFps()))})),window.addEventListener("resize",(function(){c.resize()}))}),[]),o.current}function Lt(e){return Object(o.jsxs)(Se.a,{fullWidth:!0,select:!0,margin:"normal",label:"Color",value:e.material,onChange:function(t){e.setMaterial(t.target.value)},children:[Object(o.jsx)(m.a,{value:i.BLACK,children:"Black"}),Object(o.jsx)(m.a,{value:i.PLYWOOD,children:"Wood"}),!e.onlyWood&&Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(m.a,{value:i.WHITE,children:"White"}),Object(o.jsx)(m.a,{value:i.GRAY,children:"Grey"}),Object(o.jsx)(m.a,{value:i.DARK_BLUE,children:"Dark blue"}),Object(o.jsx)(m.a,{value:i.LIGHT_BLUE,children:"Light blue"}),Object(o.jsx)(m.a,{value:i.GREEN,children:"Green"}),Object(o.jsx)(m.a,{value:i.ORANGE,children:"Orange"}),Object(o.jsx)(m.a,{value:i.YELLOW,children:"Yellow"}),Object(o.jsx)(m.a,{value:i.RED,children:"Red"}),Object(o.jsx)(m.a,{value:i.REDWOOD,children:"Wood Red"}),Object(o.jsx)(m.a,{value:i.BLACK_GLOSSY,children:"Black high gloss (+100%)"}),Object(o.jsx)(m.a,{value:i.GOLD,children:"Gold (+200%)"})]})]})}!function(e){e[e.WAITING_FOR_CHANGE=0]="WAITING_FOR_CHANGE",e[e.ATTRACTORS=1]="ATTRACTORS",e[e.GROWING=2]="GROWING",e[e.DRAWING=3]="DRAWING",e[e.DONE=4]="DONE"}(Tt||(Tt={}));var At=n(539),Nt=n(527),kt=n(528),Pt=n(529);function It(e){var t=Object(s.useState)(!1),n=Object(l.a)(t,2),r=n[0],a=n[1];return Object(o.jsxs)(ht.a,{my:2,children:[Object(o.jsxs)(d.a,{container:!0,children:[Object(o.jsx)(d.a,{item:!0,xs:4,children:Object(o.jsx)(j.a,{color:"primary",variant:"contained",fullWidth:!0,onClick:function(){return a(!0)},children:"Buy now"})}),Object(o.jsx)(d.a,{item:!0,xs:8,children:Object(o.jsxs)(ht.a,{textAlign:"right",children:[Object(o.jsxs)(f.a,{variant:"h5",children:["\u20ac ",e.price.toFixed(2)]}),Object(o.jsxs)(f.a,{color:"textSecondary",variant:"body2",children:[e.dimensions&&Object(o.jsxs)(o.Fragment,{children:["Dimensions are"," ","".concat(Math.round(e.dimensions.x/10)," x ").concat(Math.round(e.dimensions.z/10)," x ").concat(Math.round(e.dimensions.y/10)," cm"),"."," "]}),"Price includes VAT, pendant and shipping"]})]})})]}),Object(o.jsxs)(At.a,{open:r,onClose:function(){return a(!1)},children:[Object(o.jsx)(Nt.a,{children:"Interested in ordering this piece?"}),Object(o.jsxs)(kt.a,{children:["I'm working on this art project in my spare time and this lamp is not (yet) commercially available.",Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),"However, if you like the design and would consider buying it please contact me on"," ",Object(o.jsx)("a",{href:"mailto:3d-art@wouterdewinter.nl",children:"3d@wouterdewinter.nl"})," ","and include the specifications of the model below:",Object(o.jsx)("pre",{children:JSON.stringify(e.modelProps,void 0,2)})]}),Object(o.jsxs)(Pt.a,{children:[Object(o.jsx)(j.a,{onClick:function(){a(!1)},children:"Close"}),Object(o.jsx)(j.a,{color:"primary",onClick:function(){e.onExport()},children:"Download model"})]})]})]})}var Bt=n(107),Wt=n.n(Bt),zt={killDistance:30,segmentLength:10,attractionDistance:300,maxIterations:1e3,openVenation:!1,averageJitter:.005,rotation:0,rotationAxis:Y.e.Up(),seed:"123",distanceWeightFunction:function(e){return 1},drawSingleLeafs:!1,branchNthNode:1},Dt=function(){function e(t){Object(B.a)(this,e),this.settings=void 0,this.randomGenerator=void 0,this.nodes=[],this.attractors=[],this.directionRotationMatrix=void 0,this.numStep=0,this.settings=Object(I.a)(Object(I.a)({},zt),t),this.randomGenerator=S()(this.settings.seed),this.settings.rotation>0&&(this.directionRotationMatrix=Y.a.RotationAxis(this.settings.rotationAxis,this.settings.rotation))}return Object(W.a)(e,[{key:"getNodes",value:function(){return this.nodes}},{key:"getAttractors",value:function(){return this.attractors}},{key:"setAttractors",value:function(e){this.attractors=e}},{key:"getAttractionDistance",value:function(){return"function"===typeof this.settings.attractionDistance?this.settings.attractionDistance(this.numStep):this.settings.attractionDistance}},{key:"stepFunction",value:function(){var e=this;this.numStep++;var t=this.nodes.filter((function(e){return!e.inactive})),n=new it({points:t,getX:function(e){return e.position.x},getY:function(e){return e.position.y},getZ:function(e){return e.position.z},ArrayType:Array,axisCount:3,nodeSize:1}),r=[],a=this.attractors.filter((function(e){return!e.killed})).reduce((function(t,a){var i=e.settings.openVenation?e.findNearest(n,a):e.findRelativeNeighbors(n,a),o=Object(l.a)(i,2),s=o[0],c=o[1];return r.push.apply(r,Object(g.a)(c)),s.forEach((function(e){var n=t.get(e);n?n.push(a):t.set(e,[a])})),t}),new Map);return n.points.forEach((function(t,n){if(r.includes(n)){if(a.has(n)){var i=a.get(n);if(i&&i.length>0){if(2===i.length){var o=Wt.a.minBy(i,(function(e){return e.position.subtract(t.position).length()}));o&&(i=[o])}var s=e.getAverageDirection(t,i),c="number"===typeof e.settings.segmentLength?e.settings.segmentLength:e.settings.segmentLength(t),u=t.position.add(s.scale(c));e.addNode(u,[t])}}}else t.inactive=!0})),0===a.size?(console.log("Done"),!0):this.numStep>this.settings.maxIterations&&(console.log("Stopping due to max iterations reached"),!0)}},{key:"findNearest",value:function(e,t){var n=this,r=e.within(t.position.x,t.position.y,t.position.z,this.getAttractionDistance()),a=null,i=Number.MAX_VALUE;return r.forEach((function(r){var o=e.points[r],s=o.position.subtract(t.position).length();if(s<n.settings.killDistance)return n.createLeaf([o],t),t.killed=!0,Vt(o,1),[[],[]];s<i&&(a=r,i=s)})),null===a?[[],[]]:[[a],[a]]}},{key:"findRelativeNeighbors",value:function(e,t){var n,r,a=this,i=e.within(t.position.x,t.position.y,t.position.z,this.getAttractionDistance()),o=[],s=[],c=i.map((function(n){return a.distance(e.points[n].position,t.position)})),u=Object(fe.a)(i.entries());try{for(u.s();!(r=u.n()).done;){var h=Object(l.a)(r.value,2),d=h[0],f=h[1],p=e.points[f];n=!1;var m,v=c[d],j=Object(fe.a)(i.entries());try{for(j.s();!(m=j.n()).done;){var b=Object(l.a)(m.value,2),g=b[0],x=b[1];if(f!==x){var O=e.points[x];if(!(c[g]>v))if(v>this.distance(p.position,O.position)){n=!0;break}}}}catch(M){j.e(M)}finally{j.f()}n||(v<this.settings.killDistance?s.push(f):o.push(f))}}catch(M){u.e(M)}finally{u.f()}if(s.length>0&&0===o.length){t.killed=!0;var y=s.map((function(t){return e.points[t]}));if(y.forEach((function(e){return Vt(e,1/s.length)})),s.length>1||this.settings.drawSingleLeafs){var w=this.createLeaf(y,t);y.forEach((function(e){return e.children.push(w)}))}}return[o,i]}},{key:"distance",value:function(e,t){return e.subtract(t).length()}},{key:"getAverageDirection",value:function(e,t){var n,r,a,i=this,o=t.reduce((function(t,n){var r=n.position.subtract(e.position),a=i.getAttractionDistance(),o=(a-r.length())/a,s=i.settings.distanceWeightFunction(o);return t.add(r.normalize().scale(s))}),Y.e.Zero()).normalize();return this.settings.adjustAverageDirectionFunction&&(o=this.settings.adjustAverageDirectionFunction(o,e)),this.directionRotationMatrix&&Y.e.TransformCoordinatesToRef(o,this.directionRotationMatrix,o),n=o,r=this.settings.averageJitter,a=this.randomGenerator,n.x=n.x+Z(-r,r,a),n.y=n.y+Z(-r,r,a),n.z=n.z+Z(-r,r,a),o=n}},{key:"createLeaf",value:function(e,t){var n=this.addNode(t.position.clone(),e);return n.inactive=!0,t.reached=!0,n}},{key:"addNode",value:function(e,t){var n={position:e,inactive:!1,children:[],parents:t||[],numBranches:0,branchOrder:0,distance:0};return t&&t.length>0&&(n.branchOrder=t[0].children.length>0?t[0].branchOrder+1:t[0].branchOrder,n.direction=n.position.subtract(t[0].position).normalize(),n.distance=t[0].distance+1,1===t.length&&t[0].children.push(n)),this.nodes.push(n),n}}]),e}();function Vt(e,t){e.numBranches+=t,e.parents.forEach((function(e){return Vt(e,t)}))}function Ft(e,t,n,r,a,i){for(var o=[],s=360/r,c=0;c<360;c+=s){var u=e-c/360*a,h=Math.sin(c*Math.PI/180)*t,l=Math.cos(c*Math.PI/180)*t,d=i.addNode(new Y.e(h,u,l));d.inactive=!0;var f=Math.sin(c*Math.PI/180)*n,p=Math.cos(c*Math.PI/180)*n;i.addNode(new Y.e(f,u,p),[d]),o.push(d)}return o}function Gt(e,t){var n=new Dt({openVenation:!1,killDistance:10,segmentLength:5,attractionDistance:function(e){return Math.max(80,120-5*e)},rotation:0,seed:e.seed,adjustAverageDirectionFunction:function(e,t){if(t.direction&&0===t.children.length){var n=Math.max(0,20-t.distance)/5;e=e.add(t.direction.scale(5*n)).normalize()}return e},distanceWeightFunction:function(e){return Math.pow(e,.1)}}),r=Ge(0,10*e.cubeWidth,10*e.cubeHeight,e.numBoxes),a=r.mesh,i=r.excludeMeshes;return{spaceColonization:n,startNodes:Ft(62.5,6,20,3,0,n),mesh:a,excludeMeshes:i,holderPosition:80,holderHeight:35}}function _t(){return Object(o.jsxs)(ht.a,{my:2,children:[Object(o.jsx)(f.a,{component:"h2",variant:"h6",children:"About the Babylon Series"}),Object(o.jsxs)(f.a,{color:"textSecondary",variant:"body2",children:["The generative designs of the Babylon pendants are bring art, nature and math together in a whole new way.",Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),"The shapes are primitive and mathematical but are overgrown by algorithmic veins that are similar to the way plants create a venation system in their leaves to distribute water and nutrients.",Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),"Like so many things in nature, this algorithm is based on very simple rules. When these simple rules interact, very complex and inspiring shapes emerge.",Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),'In many ways these designs are unique. First, they grow from a single "seed" defined by letters and numbers and that is different each time. You can even specify your own seed by entering your own name for example.',Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),"Second, these organic shapes are so complex that they cannot be produced with traditional mass production methods. You can only manufacture this by 3d printing them piece by piece."]})]})}var Ht=n(490);function Ut(e){var t=Object(s.useState)(e.value),n=Object(l.a)(t,2),r=n[0],a=n[1],i=Object(s.useRef)(Wt.a.debounce((function(t){return e.setValue(t)}),1e3)).current;return Object(o.jsx)(ht.a,{my:2,children:Object(o.jsxs)(Re.a,{children:[Object(o.jsx)(f.a,{color:"textSecondary",children:"Seed name"}),Object(o.jsxs)(d.a,{container:!0,spacing:2,children:[Object(o.jsx)(d.a,{item:!0,xs:8,children:Object(o.jsx)(Se.a,{value:r,fullWidth:!0,onChange:function(e){a(e.target.value),i(e.target.value)},margin:"dense"})}),Object(o.jsx)(d.a,{item:!0,xs:4,children:Object(o.jsx)(j.a,{variant:"contained",fullWidth:!0,onClick:function(){var t=Math.random().toString(36).substr(2,5);a(t),e.setValue(t)},children:"Shuffle"})})]}),Object(o.jsx)(Ht.a,{children:"Each seed creates a unique random growth pattern. Tip: name it after a person!"})]})})}function Yt(){var e=Object(s.useState)(0),t=Object(l.a)(e,2),n=t[0],r=t[1],a=Object(s.useState)(0),c=Object(l.a)(a,2),u=c[0],h=c[1],p=Object(s.useState)(void 0),m=Object(l.a)(p,2),v=m[0],j=m[1],b=Object(s.useState)(void 0),g=Object(l.a)(b,2),x=g[0],O=g[1],y=Object(s.useState)(i.PLYWOOD),w=Object(l.a)(y,2),M=w[0],C=w[1],E=Object(s.useState)(Math.random().toString(36).substr(2,5)),T=Object(l.a)(E,2),S=T[0],R=T[1],L=Object(s.useState)(15),A=Object(l.a)(L,2),N=A[0],k=A[1],P=Object(s.useState)(15),I=Object(l.a)(P,2),B=I[0],W=I[1],z=Object(s.useState)(0),D=Object(l.a)(z,2),V=D[0],F=D[1],G=Object(s.useState)(5),_=Object(l.a)(G,2),H=_[0],U=_[1],Y={cubeWidth:N,cubeHeight:B,material:M,fill:V,seed:S,numBoxes:H},K=Rt(Y,r,h,j,O,Gt);Object(s.useEffect)((function(){K&&K.onUpdate(Y)}),[N,B,M,V,S,H]);var Z=function(){K&&K.commitChanges()};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(pt,{fps:n,loading:u}),Object(o.jsx)(d.a,{item:!0,xs:3,style:{height:"100vh",overflow:"auto"},children:Object(o.jsxs)(ht.a,{p:4,children:[Object(o.jsx)(f.a,{component:"h2",variant:"h6",children:"Babylon Series"}),Object(o.jsx)(f.a,{component:"h1",variant:"h4",children:'"Cubism"'}),Object(o.jsx)(Ut,{value:S,setValue:R}),Object(o.jsx)(Lt,{material:M,setMaterial:C}),Object(o.jsx)(dt,{label:"Cube width",value:N,min:10,max:15,units:"cm",setValue:k,onCommit:Z}),Object(o.jsx)(dt,{label:"Cube height",value:B,min:10,max:30,units:"cm",setValue:W,onCommit:Z}),Object(o.jsx)(dt,{label:"Density",value:V,min:0,max:1,percent:!0,setValue:F,onCommit:Z}),Object(o.jsx)(dt,{label:"Number of boxes",value:H,min:4,max:6,setValue:U,onCommit:Z}),v&&x&&Object(o.jsx)(It,{onExport:function(){return K&&K.startExport()},price:v,dimensions:x,modelProps:Y}),Object(o.jsx)(lt.a,{}),Object(o.jsx)(ht.a,{my:2,children:Object(o.jsx)(f.a,{color:"textSecondary",variant:"body2",children:"What is the most common geometric shape you can think of? Right, a box. In this model, boxes are placed in the sides of what mathematicians call a polygon. And then nature takes over ..."})}),Object(o.jsx)(_t,{})]})})]})}function Kt(e,t){var n=new Dt({openVenation:!1,killDistance:10,segmentLength:3,attractionDistance:function(t){return Math.max(.6*e.size,120-5*t)},rotation:0,seed:e.seed,adjustAverageDirectionFunction:function(e,t){if(t.direction&&0===t.children.length){var n=Math.max(1,(10-t.distance)/10);e=e.add(t.direction.scale(n)).normalize()}return e},distanceWeightFunction:function(e){return Math.pow(e,3)}}),r=function(e,t,n,r){var a=b.MeshBuilder.CreateTorusKnot("torusKnot",{tube:.35,radialSegments:128,p:n,q:r});return a.rotation.x=Math.PI/2,a.scaling.x=t,a.scaling.y=t,a.scaling.z=t,a.bakeCurrentTransformIntoVertices(),a.convertToFlatShadedMesh(),{mesh:a,excludeMeshes:[]}}(0,e.size,e.p,e.q),a=r.mesh,i=r.excludeMeshes;return{spaceColonization:n,startNodes:Ft(70,6,40,2,5,n),mesh:a,excludeMeshes:i,holderPosition:80,holderHeight:25}}function Zt(){var e=Object(s.useState)(0),t=Object(l.a)(e,2),n=t[0],r=t[1],a=Object(s.useState)(0),c=Object(l.a)(a,2),u=c[0],h=c[1],p=Object(s.useState)(void 0),m=Object(l.a)(p,2),v=m[0],j=m[1],b=Object(s.useState)(void 0),g=Object(l.a)(b,2),x=g[0],O=g[1],y=Object(s.useState)(i.PLYWOOD),w=Object(l.a)(y,2),M=w[0],C=w[1],E=Object(s.useState)("1234567"),T=Object(l.a)(E,2),S=T[0],R=T[1],L=Object(s.useState)(50),A=Object(l.a)(L,2),N=A[0],k=A[1],P=Object(s.useState)(3),I=Object(l.a)(P,2),B=I[0],W=I[1],z=Object(s.useState)(2),D=Object(l.a)(z,2),V=D[0],F=D[1],G={size:N,material:M,fill:1,seed:S,p:B,q:V},_=Rt(G,r,h,j,O,Kt);Object(s.useEffect)((function(){_&&_.onUpdate(G)}),[N,M,S,B,V]);var H=function(){_&&_.commitChanges()};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(pt,{fps:n,loading:u}),Object(o.jsx)(d.a,{item:!0,xs:3,style:{height:"100vh",overflow:"auto"},children:Object(o.jsxs)(ht.a,{p:4,children:[Object(o.jsx)(f.a,{component:"h2",variant:"h6",children:"Babylon Series"}),Object(o.jsx)(f.a,{component:"h1",variant:"h4",children:'"Infinity"'}),Object(o.jsx)(Ut,{value:S,setValue:R}),Object(o.jsx)(Lt,{material:M,setMaterial:C}),Object(o.jsx)(dt,{label:"Width",value:N,min:50,max:80,setValue:k,onCommit:H}),Object(o.jsx)(dt,{label:"P",value:B,min:0,max:5,setValue:W,onCommit:H}),Object(o.jsx)(dt,{label:"Q",value:V,min:0,max:5,setValue:F,onCommit:H}),v&&x&&Object(o.jsx)(It,{onExport:function(){return _&&_.startExport()},price:v,dimensions:x,modelProps:G}),Object(o.jsx)(lt.a,{}),Object(o.jsx)(ht.a,{my:2,children:Object(o.jsx)(f.a,{color:"textSecondary",variant:"body2",children:"The torus knot shape is well known in mathematics. It has just two parameters: P and Q. These two numbers interact together to create this beautiful shape."})}),Object(o.jsx)(_t,{})]})})]})}function Xt(){return Object(o.jsx)(o.Fragment,{children:"Home"})}function qt(e,t,n,r){for(var a=10*t/2,i=10*n/2,o=[],s=Math.asin(50/a),c=(Math.PI-2*s)*r,u=s+c,h=Math.abs(Math.cos(s)-Math.cos(u))*i,l=0;l<=10;l++){var d=s+l/10*c;o.push(new b.Vector3(Math.sin(d),Math.cos(d),0))}var f=b.Curve3.CreateCatmullRomSpline(o,1,!1),p=b.MeshBuilder.CreateLathe("lathe",{shape:f.getPoints(),radius:1,tessellation:60,sideOrientation:b.Mesh.DOUBLESIDE});p.scaling.x=a,p.scaling.y=i*(i/(h/2)),p.scaling.z=a,p.bakeCurrentTransformIntoVertices();var m=p.getBoundingInfo(),v=(m.maximum.y+m.minimum.y)/2;return p.position.y=-v,p.bakeCurrentTransformIntoVertices(),p.convertToFlatShadedMesh(),{mesh:p,excludeMeshes:[]}}function Jt(e,t){var n=new Dt({openVenation:!1,killDistance:10,segmentLength:5,attractionDistance:function(e){return Math.max(130,150-5*e)},rotation:e.rotation/2,seed:e.seed,adjustAverageDirectionFunction:function(e,t){if(t.direction&&0===t.children.length){var n=Math.max(0,5-t.distance);e=e.add(t.direction.scale(5*n)).normalize()}return e},distanceWeightFunction:function(t){return Math.pow(t,.01+10*Math.pow(1-e.insideGrowth,3))}}),r=qt(0,e.width,e.height,e.arc),a=r.mesh,i=r.excludeMeshes;return{spaceColonization:n,startNodes:Ft(70,6,20,3,5,n),mesh:a,excludeMeshes:i,holderPosition:80,holderHeight:25}}function Qt(){var e=Object(s.useState)(0),t=Object(l.a)(e,2),n=t[0],r=t[1],a=Object(s.useState)(0),c=Object(l.a)(a,2),u=c[0],h=c[1],p=Object(s.useState)(void 0),m=Object(l.a)(p,2),v=m[0],j=m[1],b=Object(s.useState)(void 0),g=Object(l.a)(b,2),x=g[0],O=g[1],y=Object(s.useState)(i.PLYWOOD),w=Object(l.a)(y,2),M=w[0],C=w[1],E=Object(s.useState)(Math.random().toString(36).substr(2,5)),T=Object(l.a)(E,2),S=T[0],R=T[1],L=Object(s.useState)(25),A=Object(l.a)(L,2),N=A[0],k=A[1],P=Object(s.useState)(15),I=Object(l.a)(P,2),B=I[0],W=I[1],z=Object(s.useState)(1),D=Object(l.a)(z,2),V=D[0],F=D[1],G=Object(s.useState)(.5),_=Object(l.a)(G,2),H=_[0],U=_[1],Y=Object(s.useState)(0),K=Object(l.a)(Y,2),Z=K[0],X=K[1],q=Object(s.useState)(0),J=Object(l.a)(q,2),Q=J[0],$=J[1],ee={width:N,height:B,arc:V,rotation:Z,insideGrowth:Q,material:M,fill:H,seed:S},te=Rt(ee,r,h,j,O,Jt);Object(s.useEffect)((function(){te&&te.onUpdate(ee)}),[N,B,V,M,Q,H,S,Z]);var ne=function(){te&&te.commitChanges()};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(pt,{fps:n,loading:u}),Object(o.jsx)(d.a,{item:!0,xs:3,style:{height:"100vh",overflow:"auto"},children:Object(o.jsxs)(ht.a,{p:4,children:[Object(o.jsx)(f.a,{component:"h2",variant:"h6",children:"Babylon Series"}),Object(o.jsx)(f.a,{component:"h1",variant:"h4",children:'"Atmosphere"'}),Object(o.jsx)(Ut,{value:S,setValue:R}),Object(o.jsx)(Lt,{material:M,setMaterial:C}),Object(o.jsx)(dt,{label:"Width",value:N,min:15,max:40,units:"cm",setValue:k,onCommit:ne}),Object(o.jsx)(dt,{label:"Height",value:B,min:15,max:40,units:"cm",setValue:W,onCommit:ne}),Object(o.jsx)(dt,{label:"Arc",value:V,min:.3,max:1,percent:!0,setValue:F,onCommit:ne}),Object(o.jsx)(dt,{label:"Density",value:H,min:0,max:1,percent:!0,setValue:U,onCommit:ne}),Object(o.jsx)(dt,{label:"Twist",value:Z,min:0,max:1,percent:!0,setValue:X,onCommit:ne}),Object(o.jsx)(dt,{label:"Inside growth",value:Q,min:0,max:1,percent:!0,setValue:$,onCommit:ne}),v&&x&&Object(o.jsx)(It,{onExport:function(){return te&&te.startExport()},price:v,dimensions:x,modelProps:ee}),Object(o.jsx)(lt.a,{}),Object(o.jsx)(ht.a,{my:2,children:Object(o.jsx)(f.a,{color:"textSecondary",variant:"body2",children:"The sphere is the most basic three-dimensional shape in the universe. But as you zoom in further and further, complex shapes take the upper hand."})}),Object(o.jsx)(_t,{})]})})]})}var $t=n(119),en=n.n($t);function tn(){var e=Object(s.useRef)(null);return Object(s.useEffect)((function(){console.log("running setup"),e.current=function(){var e=document.getElementById("renderCanvas"),t=new b.Engine(e,!0),n=N(t,e),r=(new b.HemisphericLight("light",new b.Vector3(1,.7,1),n),[[[10,10],[110,10],[110,110],[10,110]],[[20,20],[20,100],[100,100],[100,20]]]),a=[[[50,50],[150,50],[150,150],[50,150]],[[60,60],[60,140],[140,140],[140,60]]],i=$t.union(r,a),o=i[0][0].map((function(e){return new Y.e(e[0],0,e[1])})),s=i[0][1].map((function(e){return new Y.e(e[0],0,e[1])})),c=i[0][2].map((function(e){return new Y.e(e[0],0,e[1])})),u=i[0][3].map((function(e){return new Y.e(e[0],0,e[1])})),h=b.MeshBuilder.ExtrudePolygon("polygon",{shape:o,holes:[s,c,u],depth:20,sideOrientation:b.Mesh.DOUBLESIDE}),l=new b.StandardMaterial("myMaterial",n);return h.material=l,t.runRenderLoop((function(){n.render()})),{startExport:function(){x.STLExport.CreateSTL([h],!0,"export",!0)}}}()}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsx)(d.a,{container:!0,spacing:3,children:Object(o.jsxs)(d.a,{item:!0,xs:6,children:[Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:600,height:600}),Object(o.jsx)(j.a,{onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})]})})})}function nn(e,t){var n=function(e,n,r){var a=new b.DynamicTexture("DynamicTexture",50,t,!0);a.hasAlpha=!0,a.drawText(e,5,40,"bold 36px Arial",n,"transparent",!0);var i=b.Mesh.CreatePlane("TextPlane",r,t,!0);return i.material=new b.StandardMaterial("TextPlaneMaterial",t),i.material.backFaceCulling=!1,i.material.specularColor=new b.Color3(0,0,0),i.material.diffuseTexture=a,i};b.Mesh.CreateLines("axisX",[b.Vector3.Zero(),new b.Vector3(e,0,0),new b.Vector3(.95*e,.05*e,0),new b.Vector3(e,0,0),new b.Vector3(.95*e,-.05*e,0)],t).color=new b.Color3(1,0,0),n("X","red",e/10).position=new b.Vector3(.9*e,-.05*e,0),b.Mesh.CreateLines("axisY",[b.Vector3.Zero(),new b.Vector3(0,e,0),new b.Vector3(-.05*e,.95*e,0),new b.Vector3(0,e,0),new b.Vector3(.05*e,.95*e,0)],t).color=new b.Color3(0,1,0),n("Y","green",e/10).position=new b.Vector3(0,.9*e,-.05*e),b.Mesh.CreateLines("axisZ",[b.Vector3.Zero(),new b.Vector3(0,0,e),new b.Vector3(0,-.05*e,.95*e),new b.Vector3(0,0,e),new b.Vector3(0,.05*e,.95*e)],t).color=new b.Color3(0,0,1),n("Z","blue",e/10).position=new b.Vector3(0,.05*e,.9*e)}var rn=n(103),an=n.n(rn);var on=n(449);function sn(e,t){if(e.length<2)return console.log("path should be at least one long"),[];var n=new on,r=e.map((function(e){return[e.x,e.y]}));return n.data(r).arcSegments(7).offsetLines(t)[0].map((function(e){return new Y.d(e[0],e[1])}))}function cn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];try{return en.a.intersection.apply(en.a,[e].concat(n))}catch(a){return console.warn("intersection failed, trying again with slightly different values"),cn.apply(void 0,[hn(e)].concat(Object(g.a)(n.map((function(e){return hn(e)})))))}}function un(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];try{return en.a.union.apply(en.a,[e].concat(n))}catch(a){return console.warn("union failed, trying again with slightly different values"),un.apply(void 0,[hn(e)].concat(Object(g.a)(n.map((function(e){return hn(e)})))))}}function hn(e){var t=1e-4;return e.map((function(e){return e.map((function(e){return e.map((function(e){return[e[0]+Math.random()*t,e[1]+Math.random()*t]}))}))}))}var ln=n(264),dn=n(108),fn=n(204),pn=n(262),mn=n(25);function vn(e){var t=[],n=[0,0],r=[];return e.commands.forEach((function(e){if("M"===e.type)n=[e.x,e.y];else if("L"===e.type)r.push([e.x,e.y]),n=[e.x,e.y];else if("C"===e.type)!function(e,t,n,r,a,i,o,s){for(var c=new Y.e(e[0],e[1],0),u=new Y.e(n,r,0),h=new Y.e(a,i,0),l=new Y.e(o,s,0),d=b.Curve3.CreateCubicBezier(c,u,h,l,5).getPoints(),f=1;f<d.length;f++)t.push([d[f].x,d[f].y]);e[0]=l.x,e[1]=l.y}(n,r,e.x,e.y,e.x1,e.y1,e.x2,e.y2);else if("Q"===e.type)!function(e,t,n,r,a,i){for(var o=new Y.e(e[0],e[1],0),s=new Y.e(a,i,0),c=new Y.e(n,r,0),u=b.Curve3.CreateQuadraticBezier(o,s,c,5).getPoints(),h=1;h<u.length;h++)t.push([u[h].x,u[h].y]);e[0]=c.x,e[1]=c.y}(n,r,e.x,e.y,e.x1,e.y1);else{if("Z"!==e.type)throw Error("Unknown command ".concat(e.type));t.push(r),r=[]}})),Object(mn.lineStrings)(t)}function jn(e,t,n){var r=Object(mn.lineStrings)([]);return e.edges.forEach((function(a,i){if(!(a.pieces.length<2)){var o=function(e,t){if(t>=e.verticesLocal.length)throw Error("Unknown edge number");var n=t===e.verticesLocal.length-1;return[e.verticesLocal[t],n?e.verticesLocal[0]:e.verticesLocal[t+1]]}(e,i),s=Object(l.a)(o,2),c=s[0],u=s[1],h=u.subtract(c),d=bn(t,"".concat(a.id),2.3),f=function(e){var t=Object(pn.a)(e);return[(t[0]+t[2])/2,(t[1]+t[3])/2]}(d);Object(dn.a)(d,(function(e){e[0]-=f[0],e[1]-=f[1]}));var p=me(h.x,h.z),m=Object(ln.a)(d,-p,{pivot:[0,0]}),v=(p+90)%360,j=5.2*Math.cos(v*Math.PI/180),b=5.2*Math.sin(v*Math.PI/180);Object(dn.a)(m,(function(e){e[0]+=j,e[1]+=b}));var x=[];if(h.length()>Rn?(x.push(c.add(h.scale(1/4))),x.push(c.add(h.scale(3/4)))):x.push(c.add(h.scale(.5))),x.forEach((function(e){var t,n=Object(fn.a)(m);Object(dn.a)(n,(function(t){t[0]+=e.x,t[1]+=e.z})),(t=r.features).push.apply(t,Object(g.a)(n.features))})),1===a.id&&0===e.id){var O,y=function(e,t,n,r,a){var i=t.add(n).scale(.5),o=bn(e,a,4),s=Object(pn.a)(o),c=s[2]-s[0];Object(dn.a)(o,(function(e){e[0]-=c/2,e[1]=-e[1]}));var u=me(r.x,r.z),h=Object(ln.a)(o,-u,{pivot:[0,0]}),l=(u+90)%360,d=7*Math.cos(l*Math.PI/180),f=7*Math.sin(l*Math.PI/180);return Object(dn.a)(h,(function(e){e[0]+=d,e[1]+=f})),Object(dn.a)(h,(function(e){e[0]+=i.x,e[1]+=i.z})),h}(t,c,u,h,n);(O=r.features).push.apply(O,Object(g.a)(y.features))}}})),r}function bn(e,t,n){return vn(e.getPath(t,0,0,n))}function gn(e,t){var n=e.getVerticesData(b.VertexBuffer.PositionKind);if(!n)throw new Error("vertice data not available");for(var r=0;r<n.length;r+=3){var a=t(Y.e.FromArray(n,r));n[r]=a.x,n[r+1]=a.y,n[r+2]=a.z}return e.setVerticesData(b.VertexBuffer.PositionKind,n),e.createNormals(!0),e}function xn(){var e=4.5,t=gn(b.MeshBuilder.CreateCylinder("jointPin",{diameter:3.75,height:e,subdivisions:32,tessellation:32}),(function(t){var n=t.y+2.25;if(t.x<.6)t.x=.6;else if(n>3.25){var r=q(n,3.25,e,1.4,.8);t.x=t.x*r}return t}));return t.position.y=2.25,t}function On(e,t){var n=t.steps||32,r=t.height/2,a=t.aspectRatio||1,i=[];i.push(new Y.e(-t.length,0,r));for(var o=0;o<n;o++){var s=o/n*Math.PI,c=new Y.e(Math.sin(s)*r*a,0,Math.cos(s)*r);i.push(c)}i.push(new Y.e(-t.length,0,-r)),i.push(new Y.e(-t.length,0,r));var u=[];if(t.holeRadius)for(var h=0;h<n;h++){var l=h/n*2*Math.PI,d=new Y.e(Math.sin(l)*t.holeRadius,0,Math.cos(l)*t.holeRadius);u.push(d)}return b.MeshBuilder.ExtrudePolygon(e,{shape:i.reverse(),holes:u.length>0?[u.reverse()]:void 0,depth:t.depth})}function yn(e){var t=On("jointClip",{height:e.clipWidth,length:e.clipLength,depth:e.clipThickness}),n=function(){var e=xn(),t=xn();t.rotation.y=Math.PI;var n=K.a.MergeMeshes([e,t]);if(!n)throw new Error("Merging meshes failed");return n}();n.position.x=1;var r=K.a.MergeMeshes([t,n]);if(!r)throw new Error("Merging meshes failed");return r}var wn={pinDiameter:3,clipWidth:8,pieceThickness:3,jointTolerance:.3,clipThickness:1.5,bodyWidth:1.5,clipLength:5,pieceClipClearance:.1,stripWidth:2.5,yOffset:0};function Mn(){var e=function(e){var t=yn({clipThickness:e.clipThickness,clipWidth:e.clipWidth,clipLength:e.clipLength});t.position.y=e.pieceThickness/2,t.rotation.x=Math.PI,t.position.x=e.stripWidth+e.clipLength;var n=b.MeshBuilder.CreateBox("body",{width:e.bodyWidth,depth:e.clipWidth,height:e.pieceThickness+.1});n.position.x=e.stripWidth+e.bodyWidth/2;var r=b.MeshBuilder.CreateBox("strip",{width:wn.stripWidth,depth:e.clipWidth,height:.8});r.position.x=e.stripWidth/2,r.position.y=e.pieceThickness-.4;var a=K.a.MergeMeshes([t,n,r]);if(!a)throw new Error("Merging meshes failed");return a}(wn);e.rotation.z=Math.PI,e.rotation.x=Math.PI,e.position.y=-1.5,e.bakeCurrentTransformIntoVertices();var t=function(e){var t=yn({clipThickness:e.clipThickness,clipWidth:e.clipWidth,clipLength:e.clipLength});t.position.y=-e.pieceThickness/2,t.position.x=e.stripWidth+e.clipLength;var n=b.MeshBuilder.CreateBox("body",{width:e.bodyWidth,depth:e.clipWidth,height:e.pieceThickness+.1});n.position.x=e.stripWidth+e.bodyWidth/2;var r=b.MeshBuilder.CreateBox("strip",{width:e.stripWidth,depth:e.clipWidth,height:.8});r.position.x=e.stripWidth/2,r.position.y=.4-e.pieceThickness;var a=K.a.MergeMeshes([t,n,r]);if(!a)throw new Error("Merging meshes failed");return a}(wn);return t.rotation.x=Math.PI,t.position.y=-1.5,t.bakeCurrentTransformIntoVertices(),{left:e,right:t}}function Cn(){return wn.bodyWidth+wn.stripWidth}var En=n(318);function Tn(e,t,n){var r=e.properties||{},a="Feature"===e.type?e.geometry:e,i=(new En.GeoJSONReader).read(a),o=t,s=En.BufferOp.bufferOp(i,o,n);return s=(new En.GeoJSONWriter).write(s),Object(mn.feature)(s,r)}function Sn(e,t,n){return e.features.map((function(e){var r=Tn(e,.1,8),a=r.geometry.coordinates[0].map((function(e){return new Y.e(e[0],0,e[1])})),i=r.geometry.coordinates.slice(1).map((function(e){return e.map((function(e){return new Y.e(e[0],0,e[1])}))})),o=b.MeshBuilder.CreatePolygon("engravingShape",{shape:a,holes:i});return o.position.y=wn.yOffset+.1,o.bakeCurrentTransformIntoVertices(),o.setPreTransformMatrix(t),o.material=n,o}))}var Rn=80,Ln=function(){function e(t,n,r,a,o,s,c){Object(B.a)(this,e),this.spaceColonization=t,this.scene=n,this.material=r,this.randomGenerator=a,this.pieces=o,this.font=s,this.brandingText=c,this.textureMaterial=void 0,this.textureMaterial=C[i.BLACK_MATTE](n)}return Object(W.a)(e,[{key:"draw",value:function(){var e=this,t=[],n=[];this.pieces.forEach((function(r){var a=e.drawPiece(r);t.push(a.mesh),n.push.apply(n,Object(g.a)(a.engravingMeshes))}));var r=b.Mesh.MergeMeshes(t,!0,!0);if(!r)throw new Error("Merging meshes failed");var a=b.Mesh.MergeMeshes(n,!0,!0);if(!a)throw new Error("Merging meshes failed");return[r,a]}},{key:"drawPiece",value:function(e){var t=function(e,t){var n={paths:{}};e.forEach((function(t,r){var a=r===e.length-1?0:r+1,i=e[a],o=new an.a.paths.Line([t.x,t.z],[i.x,i.z]);n.paths["line".concat(r)]=o}));var r=Object.values(n.paths);r.forEach((function(e,a){var i=a===r.length-1?0:a+1,o=r[i],s=an.a.path.fillet(e,o,t);n.paths["arc".concat(a)]=s}));var a=an.a.model.findSingleChain(n);return an.a.chain.toKeyPoints(a,1).map((function(e){return new Y.e(e[0],0,e[1])}))}(e.verticesLocal.map((function(t,n){var r=0===n?e.verticesLocal.length-1:n-1,a=n===e.verticesLocal.length-1?0:n+1;return Nn(e.verticesLocal[r],t,e.verticesLocal[a],4)})),3),n=e.verticesLocal.map((function(t,n){var r=0===n?e.verticesLocal.length-1:n-1,a=n===e.verticesLocal.length-1?0:n+1;return Nn(e.verticesLocal[r],t,e.verticesLocal[a],12.8)})),r=e.isHolder?this.drawHolderInterior(e,t,n,this.randomGenerator):this.drawInterior(e,t,n,this.randomGenerator),a=r.shape,i=r.holes,o=function(e,t,n){var r=[];return e.edges.forEach((function(a,i){if(!(a.pieces.length<2)){var o=Pn(e,i),s=Object(l.a)(o,2),c=s[0],u=s[1],h=Y.e.TransformCoordinates(c,t),d=Y.e.TransformCoordinates(u,t);r.push.apply(r,Object(g.a)(function(e,t,n){var r=t.subtract(e),a=r.clone().normalize(),i=Y.a.RotationAxis(Y.e.Up(),-Math.PI/2),o=Y.e.TransformCoordinates(a,i);if(r.length()<Rn)return[An(e.add(r.scale(.5)).add(o.scale(n)),2)];var s=e.add(r.scale(1/4)).add(o.scale(n)),c=e.add(r.scale(3/4)).add(o.scale(n));return[An(s,2),An(c,2)]}(h,d,n)))}})),r}(e,e.inverseMatrix,8.4);i.push.apply(i,Object(g.a)(o));var s=b.MeshBuilder.ExtrudePolygon("piece",{shape:a,holes:i,depth:3});s.bakeCurrentTransformIntoVertices(),s.setPreTransformMatrix(e.matrix),s.material=this.material;var c=jn(e,this.font,this.brandingText),u=Sn(c,e.matrix,this.textureMaterial);return e.shape=se(a),e.holes=i.map(se),e.engraving=c,{mesh:s,engravingMeshes:u}}},{key:"drawInterior",value:function(e,t,n,a){var i=this,o=this.spaceColonization.getSegmentsByPiece().get(e);if(!o)throw Error("segments not found for piece");var s=o.map((function(t){return sn([oe(Y.e.TransformCoordinates(t[0].position,e.inverseMatrix)),oe(Y.e.TransformCoordinates(t[1].position,e.inverseMatrix))],(function(e){return function(e,t){var n=q(Math.max(Math.min(e,t),1),1,t,0,1);return q(Math.sqrt(n),0,1,2.5,100)}((0===e?t[0]:t[1]).numBranches,i.spaceColonization.getAttractors().length)/2}))})).map((function(e){return[ae(e,[])]})),c=un.apply(r,[s[0]].concat(Object(g.a)(s.slice(1)))),u=cn([ne(t,[])],c);return $(un([ne(t,[n])],u)[0])}},{key:"drawHolderInterior",value:function(e,t,n,r){return $(ne(t,[An(e.verticesLocal.reduce((function(e,t){return e.add(t)}),Y.e.Zero()).scale(1/e.verticesLocal.length),5).reverse()]))}}]),e}();function An(e,t){for(var n=[],r=0;r<16;r++){var a=r/16*Math.PI*2,i=new Y.e(Math.sin(a)*t,0,Math.cos(a)*t);n.push(e.add(i))}return n.push(n[0]),n.reverse()}function Nn(e,t,n,r){var a=t.subtract(e).normalize(),i=t.subtract(n).normalize(),o=Y.e.GetAngleBetweenVectors(a,i,Y.e.Zero()),s=a.add(i).normalize(),c=r/Math.sin(o/2);return t.add(s.scale(c))}function kn(e){var t=[],n=0;e.forEach((function(e){if(!(e.pieces.length<2)){if(e.pieces.length>2)throw new Error("Edge cannot have more than two pieces attached");var r=function(e,t,n){var r=Pn(e,n),a=Object(l.a)(r,2),i=a[0],o=a[1].subtract(i).clone().normalize(),s=new Y.a,c=e.normal,u=Y.e.Cross(c,o);Y.a.FromXYZAxesToRef(u,c,o,s);var h=new Y.a,d=t.normal,f=Y.e.Cross(d,o);return Y.a.FromXYZAxesToRef(f,d,o,h),{matrix1:s,matrix2:h}}(e.pieces[0],e.pieces[1],e.edgeNumbers[0]),a=r.matrix1,i=r.matrix2,o=function(e,t,n,r){var a=Pn(e,t),i=Object(l.a)(a,2),o=i[0],s=i[1].subtract(o),c=[];s.length()>Rn?(c.push(o.add(s.scale(1/4))),c.push(o.add(s.scale(3/4)))):c.push(o.add(s.scale(.5)));return Object(Bt.flatten)(c.map((function(e){return function(e,t,n){var r=Mn(),a=r.left,i=r.right;return a.position=e,i.position=e,a.setPreTransformMatrix(t),i.setPreTransformMatrix(n),[a,i]}(e,n,r)})))}(e.pieces[0],e.edgeNumbers[0],a,i);t.push.apply(t,Object(g.a)(o)),n+=o.length}})),console.log("Created ".concat(n," connectors"));var r=K.a.MergeMeshes(t,!0,!0);if(!r)throw new Error("Merging meshes failed");return r}function Pn(e,t){if(t>=e.vertices.length)throw Error("Unknown edge number");var n=t===e.vertices.length-1;return[e.vertices[t],n?e.vertices[0]:e.vertices[t+1]]}var In=2*(Cn()+wn.clipLength-wn.bodyWidth-wn.pieceClipClearance+1-Cn());function Bn(e,t,n,r,a,i){var o=e.map((function(e,r){var o,s,c;return(function(e,t,n,r){var a=new b.DynamicTexture("DynamicTexture",50,r,!0);a.hasAlpha=!0,a.drawText(e,5,40,"bold 36px Arial",t,"transparent",!0);var i=b.Mesh.CreatePlane("TextPlane",n,r,!0),o=new b.StandardMaterial("TextPlaneMaterial",r);return o.backFaceCulling=!1,o.specularColor=new b.Color3(0,0,0),o.diffuseTexture=a,i.material=o,i}(r+"","red",10,t)).position=e.center,o=e.center,s=e.normal,c=b.Color3.Blue(),K.a.CreateLines("axis",[o,o.add(s.scale(10))]).color=c,function(e,t,n,r,a,i){var o=e.verticesLocal.map((function(t,n){var r=0===n?e.verticesLocal.length-1:n-1,a=n===e.verticesLocal.length-1?0:n+1;return Wn(e.verticesLocal[r],t,e.verticesLocal[a],Cn())}));o.push(o[0]);var s=e.verticesLocal.map((function(t,n){var r=0===n?e.verticesLocal.length-1:n-1,a=n===e.verticesLocal.length-1?0:n+1;return Wn(e.verticesLocal[r],t,e.verticesLocal[a],Cn()+In)}));s.push(s[0]);var c=b.MeshBuilder.ExtrudePolygon("piece",{shape:o,holes:[s],depth:wn.pieceThickness});c.material=n,c.position.y=wn.yOffset,c.bakeCurrentTransformIntoVertices(),c.setPreTransformMatrix(e.matrix);var u=jn(e,a,"ICO-N / 366ba4");return Sn(u,e.matrix,i),e.shape=se(o),e.holes=[se(s)],e.engraving=u,c}(e,0,n,0,a,i)})),s=b.Mesh.MergeMeshes(o,!0,!0);if(!s)throw new Error("Merging meshes failed");return s}function Wn(e,t,n,r){var a=t.subtract(e).normalize(),i=t.subtract(n).normalize(),o=Y.e.GetAngleBetweenVectors(a,i,Y.e.Zero()),s=a.add(i).normalize(),c=r/Math.sin(o/2);return t.add(s.scale(c))}var zn=n(315);function Dn(){return Vn.apply(this,arguments)}function Vn(){return(Vn=Object(H.a)(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("loading font"),e.abrupt("return",new Promise((function(e,t){zn.a.load("/assets/fonts/machtgth.ttf",(function(n,r){n||!r?t(n):(console.log("font loaded"),e(r))}))})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Fn=n(319),Gn=n.n(Fn);function _n(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function Hn(e,t,n){var r=new Gn.a;r.setUnits("Millimeters");var a,i=Object(fe.a)(e);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.drawPolyline(o.map((function(e){return[e.x,e.y]})))}}catch(f){i.e(f)}finally{i.f()}r.addLayer("engravings",Gn.a.ACI.RED,"CONTINUOUS"),r.setActiveLayer("engravings");var s,c=Object(fe.a)(t.features);try{for(c.s();!(s=c.n()).done;){var u=s.value;r.drawPolyline(u.geometry.coordinates.map((function(e){return[e[0],e[1]]})))}}catch(f){c.e(f)}finally{c.f()}r.addLayer("panels",Gn.a.ACI.BLUE,"CONTINUOUS"),r.setActiveLayer("panels");var h,l=Object(fe.a)(n);try{for(l.s();!(h=l.n()).done;){var d=h.value;r.drawPolyline(d.map((function(e){return[e.x,e.y]})))}}catch(f){l.e(f)}finally{l.f()}_n("export.dxf",r.toDxfString())}function Un(e){var t=ke("ring",{innerRadius:5.5,outerRadius:8.5,height:70,tesselation:360});return t.convertToFlatShadedMesh(),t.position.y=e,t}function Yn(e,t){e.convertToFlatShadedMesh(),e.optimizeIndices();var n=e.getIndices(),r=e.getVerticesData(b.VertexBuffer.PositionKind);if(!r||!n)throw new Error("vertice data not available");for(var a=[],i=0,o=0;o<n.length;o+=3){var s=3*n[o],c=b.Vector3.FromArray(r,s),u=b.Vector3.FromArray(r,s+3),h=b.Vector3.FromArray(r,s+6),l=qn(i++,[c,u,h]);Kn(c,u,h)>0&&(!t||t(c,u,h))&&a.push(l)}return{pieces:a,edges:Zn(a)}}function Kn(e,t,n){var r=t.subtract(e),a=n.subtract(e);return r.cross(a).length()}function Zn(e){var t=new Map,n=[],r=0;return e.forEach((function(e,a){e.vertices.forEach((function(a,i){var o=Pn(e,i),s=function(e,t,n){var r=Xn(e,t),a=Xn(e,n);return r>a?"".concat(r,":").concat(a):"".concat(a,":").concat(r)}(n,o[0],o[1]),c=t.get(s);if(c)c.pieces.push(e),c.edgeNumbers.push(i),e.edges.push(c);else{var u={id:r++,pieces:[e],edgeNumbers:[i]};t.set(s,u),e.edges.push(u)}}))})),t}function Xn(e,t){var n=e.findIndex((function(e){return e.subtract(t).length()<.001}));return-1!==n?n:(e.push(t),e.length-1)}function qn(e,t){if(0===t.length)throw new Error("Cannot make a piece from 0 vertices");var n=t.slice(1).reduce((function(e,t){return e[e.length-1].equals(t)||e.push(t),e}),t.slice(0,1)),r=b.Plane.FromPoints(n[0],n[1],n[2]).normal.negate(),a=n.slice(1).reduce((function(e,t){return e.add(t)}),n[0]).scale(1/n.length),i=n[0].subtract(n[1]).normalize(),o=r,s=b.Vector3.Cross(i,o),c=Y.a.Zero();Y.a.FromXYZAxesToRef(i,o,s,c),c.setTranslation(n[0]);var u=new Y.a;c.invertToRef(u);var h=n.map((function(e){return Y.e.TransformCoordinates(e,u)}));return{id:e,vertices:n,verticesLocal:h,normal:r,center:a,matrix:c,inverseMatrix:u,edges:[],isHolder:!1}}var Jn={name:"Icosahedron",category:["Platonic Solid"],vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]};function Qn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:150;return e.face.map((function(n,r){return qn(r++,n.map((function(n){var r=e.vertex[n];if(!r)throw new Error("vertex not found");return new Y.e(r[0]*t,r[1]*t,r[2]*t)})).reverse())}))}function $n(e,t){var n=e.face[t].map((function(t){var n=e.vertex[t];if(!n)throw new Error("vertex not found");return new Y.e(n[0],n[1],n[2])})),r=b.Plane.FromPoints(n[0],n[1],n[2]).normal,a=n[0].subtract(n[1]).normalize(),i=r,o=b.Vector3.Cross(a,i),s=Y.a.Zero();return Y.a.FromXYZAxesToRef(a,i,o,s),s.invert(),e.vertex=e.vertex.map((function(e){var t=new Y.e(e[0],e[1],e[2]),n=Y.e.TransformCoordinates(t,s);return[n.x,n.y,n.z]})),e}function er(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:150,t=nr(Jn);$n(t=tr(t),t.face.length-1);var n=Qn(t,e),r=Zn(n),a=b.MeshBuilder.CreatePolyhedron(t.name,{custom:t,size:e});return n[n.length-1].isHolder=!0,{pieces:n,edges:r,mesh:a}}function tr(e){return rr(e,0,[[0,1],[1,1],[2,1],[3,1],[4,1]],!0)}function nr(e){return rr(e,11,[[16,2],[15,0],[17,0],[19,2],[18,2]],!1)}function rr(e,t,n,r){var a=Object(Ae.a)(Y.e,Object(g.a)(e.vertex[t])),i=n.map((function(t){var n=e.face[t[0]][t[1]],r=Object(Ae.a)(Y.e,Object(g.a)(e.vertex[n]));return a.add(r.subtract(a).scale(1/4))})).map((function(t){return e.vertex.push(t.asArray())-1}));return n.forEach((function(t,n){var r=t[0],a=i[n],o=i[(n+1)%i.length];e.face[r].splice(t[1]-1,1,o,a)})),r&&e.face.push(i),e}var ar=n(263),ir=n(377),or=1050,sr=10;function cr(e){if(0===e.length)throw Error("No pieces to pack");e.sort((function(e,t){return e.vertices.length>t.vertices.length?1:-1}));var t=0,n=S()("42"),r=Object(mn.multiPolygon)([]),a=Object(mn.multiPolygon)([]),i=Object(mn.lineStrings)([]),o=Object(mn.multiPolygon)([]),s=[Y.d.Zero(),Y.d.Zero()];return br(0,o),e.forEach((function(e){if(console.log("packing piece",e.id),!e.shape||!e.holes)throw new Error("No piece shape or holes");var c=void 0,u=se(e.verticesLocal);u.push(oe(e.verticesLocal[0]));do{for(var h=0;h<1e4;h++){var l=1-h/1e4,d=c?hr(c,n,l,u,t,s):dr(n,l,u,t,s),f=Tn(Object(mn.polygon)([pr(d.transformedShape)]),1,3);(!c||c.loss>d.loss)&&!Object(ir.a)(f,r)&&(c=d)}if(!c&&(br(++t,o),s=[Y.d.Zero(),Y.d.Zero()],console.log("adding another panel"),t>10))throw new Error("maximum number of panels reached")}while(!c);var p=c,m=e.shape.map((function(e){return Y.d.Transform(e,p.matrix)})),v=e.holes.map((function(e){return e.map((function(e){return Y.d.Transform(e,p.matrix)}))})).map((function(e){return pr(e)})),j=Object(mn.polygon)([pr(m)].concat(Object(g.a)(v)));if(e.engraving){var b,x=function(e,t){var n=Object(fn.a)(e);return Object(dn.a)(n,(function(e){var n=new Y.d(e[0],e[1]),r=Y.d.Transform(n,t);e[0]=r.x,e[1]=r.y})),n}(e.engraving,c.matrix);(b=i.features).push.apply(b,Object(g.a)(x.features))}var O=Object(ar.a)(a,j);if(!O)throw new Error("Union failed");a=O,s=jr(s,vr(m));var y=Object(mn.polygon)([pr(p.transformedShape)]),w=Object(ar.a)(r,y);if(!w)throw new Error("Union on test panel failed");r=w})),{shapes:mr(a),engravings:i,panels:mr(o)}}function ur(e,t,n,r){var a=e.x+(n.x-t.x),i=e.y+(n.y-t.y),o=(r[1].x-r[0].x)*(r[1].y-r[0].y),s=o/1e3+(a+i);return Math.random()<.001&&console.log(o,a,i,s),s}function hr(e,t,n,r,a,i){var o=e.rotation+(t()-.5)*n*.1,s=Y.a.RotationAxis(Y.e.Forward(),o),c=r.map((function(e){return Y.d.Transform(e,s)})),u=vr(c),h=Object(l.a)(u,2),d=h[0],f=h[1],p=new Y.d(e.position.x+(t()-.5)*n*40-1*n,e.position.y+(t()-.5)*n*40-1*n*.5),m=fr(a,d,f),v=new Y.d(lr(p.x,m[0].x,m[1].x),lr(p.y,m[0].y,m[1].y)),j=c.map((function(e){return e.add(v)})),b=jr(i,vr(j));return{loss:ur(v,d,f,b),transformedShape:j,rotation:o,position:v,matrix:s.clone().setTranslation(new Y.e(v.x,v.y,0))}}function lr(e,t,n){return Math.min(Math.max(e,t),n)}function dr(e,t,n,r,a){var i=e()*Math.PI,o=Y.a.RotationAxis(Y.e.Forward(),i),s=n.map((function(e){return Y.d.Transform(e,o)})),c=vr(s),u=Object(l.a)(c,2),h=u[0],d=u[1],f=fr(r,h,d),p=new Y.d(Z(f[0].x,f[1].x,e),Z(f[0].y,f[1].y,e)),m=s.map((function(e){return e.add(p)})),v=jr(a,vr(m));return{loss:ur(p,h,d,v),transformedShape:m,rotation:i,position:p,matrix:o.clone().setTranslation(new Y.e(p.x,p.y,0))}}function fr(e,t,n){return[new Y.d(660*e-t.x+0,0-t.y+0),new Y.d(660*(e+1)-sr-n.x-0,or-n.y-0)]}function pr(e){var t=e.map((function(e){return[e.x,e.y]}));return t.push(t[0]),t}function mr(e){return e.geometry.coordinates.reduce((function(e,t){var n=t.map((function(e){return e.map((function(e){return new Y.d(e[0],e[1])}))}));return e.push.apply(e,Object(g.a)(n)),e}),[])}function vr(e){if(0===e.length)throw new Error("Cannot calculate bounding box for empty array");var t=[e[0],e[0]];return e.reduce((function(e,t){return[Y.d.Minimize(e[0],t),Y.d.Maximize(e[1],t)]}),t)}function jr(e,t){return[Y.d.Minimize(e[0],t[0]),Y.d.Maximize(e[1],t[1])]}function br(e,t){var n=[[660*e,0],[660*(e+1)-sr,0],[660*(e+1)-sr,or],[660*e,or],[660*e,0]];t.geometry.coordinates.push([n])}function gr(){var e=Object(s.useRef)(null);return Object(s.useEffect)((function(){Object(H.a)(_.a.mark((function t(){return _.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,xr();case 2:e.current=t.sent;case 3:case"end":return t.stop()}}),t)})))()}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)(d.a,{container:!0,spacing:3,children:[Object(o.jsxs)(d.a,{item:!0,xs:6,children:[Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:800,height:800}),Object(o.jsx)(j.a,{onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})]}),Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)("svg",{id:"svg",style:{border:"solid 1px #aaa"},width:600,height:450})})]})})}function xr(){return Or.apply(this,arguments)}function Or(){return(Or=Object(H.a)(_.a.mark((function e(){var t,n,r,a,o,s,c,u,h,l,d,f,p,m,v,j,g,x;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dn();case 2:return t=e.sent,n=document.getElementById("renderCanvas"),r=new b.Engine(n,!0),a=N(r,n),new b.HemisphericLight("light",new b.Vector3(1,.7,1),a),(o=new b.StandardMaterial("wireframe",a)).wireframe=!0,nn(30,a),(s=C[i.GRAY](a)).wireframe=!0,200,Un(130).material=s,c=C[i.PLYWOOD](a),u=C[i.BLACK_MATTE](a),h=er(200),l=h.pieces,d=h.edges,f=h.mesh,S()("1234"),Bn(l,a,c,0,t,u),kn(d).material=s,p=cr(l),m=p.shapes,v=p.engravings,j=p.panels,yr(m,v,j),g=Mr(l),console.log("Total cutting length in mm",g),f.material=o,r.runRenderLoop((function(){a.render()})),x=function(){Hn(m,v,j)},e.abrupt("return",{startExport:x});case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yr(e,t,n){var r='\n  <svg xmlns="http://www.w3.org/2000/svg" viewBox="-10 -10 1330 1070">\n    '.concat(e.map((function(e){return wr(e,"#000")})).join("\n"),"\n    ").concat(n.map((function(e){return wr(e,"#00f")})).join("\n"),"\n  </svg>");document.getElementById("svg").innerHTML=r}function wr(e,t){var n=e.map((function(e){return"".concat(e.x,",").concat(e.y)}));return'<polygon stroke="'.concat(t,'" fill="none" points="').concat(n.join(" "),'" />')}function Mr(e){var t,n=0,r=Object(fe.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a.shape&&a.holes){n+=Cr(a.shape);var i,o=Object(fe.a)(a.holes);try{for(o.s();!(i=o.n()).done;){n+=Cr(i.value)}}catch(s){o.e(s)}finally{o.f()}}}}catch(s){r.e(s)}finally{r.f()}return n}function Cr(e){return e.reduce((function(t,n,r){return r<e.length-1&&(t+=e[r+1].subtract(n).length()),t}),0)}function Er(e){var t=[],n=ke("ring",{innerRadius:5.5,outerRadius:8.5,height:70,tesselation:360});n.convertToFlatShadedMesh(),n.position.y=e,t.push(n);var r=b.Polygon.Circle(4,void 0,void 0,5);r.push(r[0]);var a=r.map((function(e){return new Y.e(e.x-25,e.y)})),i=e+70-30,o=b.MeshBuilder.CreateLathe("holderOuterRing",{shape:a,closed:!0,tessellation:5});o.position.y=i,o.rotation.y=Math.PI/5,t.push(o);for(var s=0;s<5;s++){var c=s*Math.PI*2/5,u=[new Y.e(6*Math.cos(c),0,6*Math.sin(c)),new Y.e(25*Math.cos(c),0,25*Math.sin(c))],h=b.MeshBuilder.CreateTube("spoke",{radius:3,path:u,cap:b.Mesh.CAP_ALL,tessellation:32});h.position.y=i,t.push(h)}var l=b.Mesh.MergeMeshes(t,!0);if(!l)throw new Error("Merging meshes failed");return l.convertToFlatShadedMesh(),l.rotation.y=Math.PI/180*20,l}function Tr(e,t){var n=b.MeshBuilder.CreateIcoSphere("m",{radius:e,subdivisions:1},t),r=b.Matrix.RotationX(Math.PI/180*58);return n.bakeTransformIntoVertices(r),n}function Sr(e){var t=On("jointClip",{height:e.clipWidth,length:e.clipLength,depth:e.clipThickness}),n=gn(b.MeshBuilder.CreateCylinder("jointPin",{diameter:3.5,height:2,subdivisions:2,tessellation:32}),(function(e){return e.x>.5&&e.y>0&&(e.x=.5),e}));n.position.x=1;var r=K.a.MergeMeshes([t,n]);if(!r)throw new Error("Merging meshes failed");return r}var Rr={pinDiameter:3,clipWidth:8,pieceThickness:3,jointTolerance:.3,clipThickness:1.5,bodyWidth:1.5,clipLength:5,pieceClipClearance:.1};function Lr(){return{left:function(e){var t=(e.clipWidth-2*e.jointTolerance)/3,n=2*e.clipThickness+e.pieceThickness,r=n/2+e.jointTolerance,a=On("jointRight1",{height:n,length:r+.1,depth:t});a.rotation.x=Math.PI/2,a.rotation.y=Math.PI,a.position.z=-t/2;var i=b.MeshBuilder.CreateCylinder("jointPin",{diameter:e.pinDiameter,height:e.clipWidth});i.rotation.x=Math.PI/2;var o=Sr({clipThickness:e.clipThickness,clipWidth:e.clipWidth,clipLength:e.clipLength}),s=Sr({clipThickness:e.clipThickness,clipWidth:e.clipWidth,clipLength:e.clipLength});o.position.y=-e.pieceThickness/2,o.position.x=r+e.clipLength,s.position.y=e.pieceThickness/2,s.rotation.x=Math.PI,s.position.x=r+e.clipLength;var c=b.MeshBuilder.CreateBox("body",{width:e.bodyWidth,depth:e.clipWidth,height:e.pieceThickness+.1});c.position.x=r+e.bodyWidth/2;var u=K.a.MergeMeshes([o,s,c,a,i]);if(!u)throw new Error("Merging meshes failed");return u}(Rr),right:function(e){var t=(e.clipWidth-2*e.jointTolerance)/3,n=2*e.clipThickness+e.pieceThickness,r=n/2+e.jointTolerance,a=On("jointRight1",{height:n,holeRadius:e.pinDiameter/2+e.jointTolerance,length:r+.1,depth:t});a.rotation.x=Math.PI/2,a.rotation.y=Math.PI,a.position.z=t/2+e.jointTolerance;var i=On("jointRight2",{height:n,holeRadius:e.pinDiameter/2+e.jointTolerance,length:r+.1,depth:t});i.rotation.x=Math.PI/2,i.rotation.y=Math.PI,i.position.z=-e.clipWidth/2;var o=Sr({clipThickness:e.clipThickness,clipWidth:e.clipWidth,clipLength:e.clipLength}),s=Sr({clipThickness:e.clipThickness,clipWidth:e.clipWidth,clipLength:e.clipLength});o.position.y=-e.pieceThickness/2,o.position.x=r+e.clipLength,s.position.y=e.pieceThickness/2,s.position.x=r+e.clipLength,s.rotation.x=Math.PI;var c=b.MeshBuilder.CreateBox("body",{width:e.bodyWidth,depth:e.clipWidth,height:e.pieceThickness+.1});c.position.x=r+e.bodyWidth/2;var u=K.a.MergeMeshes([o,s,c,a,i]);if(!u)throw new Error("Merging meshes failed");return u}(Rr)}}function Ar(){return(2*Rr.clipThickness+Rr.pieceThickness)/2+Rr.jointTolerance+Rr.bodyWidth+Rr.pieceClipClearance}function Nr(){return Ar()+Rr.clipLength-Rr.bodyWidth-Rr.pieceClipClearance+1}function kr(e,t,n,r){var a=function(e,t,n,r,a){for(var i=[],o=Br(i),s=0;s<200;s++){var c=Ir(e,t,n,r);0===o.within(c.x,c.y,a).length&&(i.push(c),o=Br(i))}for(var u=0;u<1e3;u++){var h=Pr(e,t,n,r);0===o.within(h.x,h.y,a).length&&(i.push(h),o=Br(i))}return i.map((function(e){return{position:e,killed:!1,reached:!1}}))}(e,t,n,r,10),i=new je({openVenation:!1,killDistance:6,segmentLength:3,attractionDistance:150,rotation:0,averageJitter:.2,distanceMethod:"weight"});i.setAttractors(a);var o=[i.addNode(Pr(e,t,n,r))],s=!1;do{s=i.stepFunction()}while(!s);var c=we(o);console.log("num paths",c.length);var u=c.map((function(e){return function(e,t){var n=function(n){return function(e,t){var n=q(Math.max(Math.min(e,t),1),1,t,0,1);return q(Math.sqrt(n),0,1,2,20)}(n>e.length-3?0:e[n+1].numBranches,t)/2};return sn(e.map((function(e){return e.position})),n)}(e,a.length)})).map((function(e){return ae(e,[])}));return en.a.union.apply(en.a,Object(g.a)(u))}function Pr(e,t,n,r){var a=r(),i=r(),o=t.subtract(e),s=n.subtract(t);return e.add(o.scale(a)).add(s.scale(a*i))}function Ir(e,t,n,r){var a=[[e,t],[t,n],[n,e]][Math.floor(Z(0,2,r))],i=r(),o=a[1].subtract(a[0]);return a[0].add(o.scale(i))}function Br(e){return new pe.a(e,(function(e){return e.x}),(function(e){return e.y}))}var Wr=2*(Nr()-Ar());function zr(e,t,n,r){var a=e.map((function(e){return function(e,t,n,r){var a=Y.e.TransformCoordinates(e.vertices[0],e.inverseMatrix),i=Y.e.TransformCoordinates(e.vertices[1],e.inverseMatrix),o=Y.e.TransformCoordinates(e.vertices[2],e.inverseMatrix),s=Ar(),c=Vr(o,a,i,s),u=Vr(a,i,o,s),h=Vr(i,o,a,s),d=function(e,t,n,r){var a={paths:{line1:new an.a.paths.Line([e.x,e.z],[t.x,t.z]),line2:new an.a.paths.Line([t.x,t.z],[n.x,n.z]),line3:new an.a.paths.Line([n.x,n.z],[e.x,e.z])}},i=an.a.path.fillet(a.paths.line1,a.paths.line2,r),o=an.a.path.fillet(a.paths.line2,a.paths.line3,r),s=an.a.path.fillet(a.paths.line3,a.paths.line1,r);a.paths.arc=i,a.paths.arc2=o,a.paths.arc3=s;var c=an.a.model.findSingleChain(a);return an.a.chain.toKeyPoints(c,1).map((function(e){return new Y.e(e[0],0,e[1])}))}(c,u,h,3),f=s+Wr,p=Vr(o,a,i,f),m=Vr(a,i,o,f),v=Vr(i,o,a,f),j=[];j.push(p,m,v,p);var x=f-3,O=Vr(o,a,i,x),y=Vr(a,i,o,x),w=Vr(i,o,a,x),M=function(e,t,n,r,a,i){var o=kr(oe(e),oe(t),oe(n),i),s=ne(r,[]),c=en.a.intersection(s,o),u=ne(r,[a]);return $(en.a.union(u,c)[0])}(O,y,w,d,j,r),C=M.shape,E=M.holes,T=function(e,t,n){var r=[];return e.edges.forEach((function(a,i){if(!(a.pieces.length<2)){var o=Pn(e,i),s=Object(l.a)(o,2),c=s[0],u=s[1],h=Y.e.TransformCoordinates(c,t),d=Y.e.TransformCoordinates(u,t);r.push.apply(r,Object(g.a)(function(e,t,n){var r=t.subtract(e),a=r.clone().normalize(),i=Y.a.RotationAxis(Y.e.Up(),-Math.PI/2),o=Y.e.TransformCoordinates(a,i),s=e.add(r.scale(1/4)).add(o.scale(n)),c=e.add(r.scale(3/4)).add(o.scale(n));return[Dr(s,2),Dr(c,2)]}(h,d,n)))}})),r}(e,e.inverseMatrix,Nr());E.push.apply(E,Object(g.a)(T));var S=b.MeshBuilder.ExtrudePolygon("piece",{shape:C,holes:E,depth:Rr.pieceThickness});return S.position.y=Rr.pieceThickness/2,S.bakeCurrentTransformIntoVertices(),S.setPreTransformMatrix(e.matrix),S.material=n,e.shape=se(C),e.holes=E.map(se),S}(e,0,n,r)})),i=b.Mesh.MergeMeshes(a,!0,!0);if(!i)throw new Error("Merging meshes failed");return i}function Dr(e,t){for(var n=[],r=0;r<16;r++){var a=r/16*Math.PI*2,i=new Y.e(Math.sin(a)*t,0,Math.cos(a)*t);n.push(e.add(i))}return n.push(n[0]),n.reverse()}function Vr(e,t,n,r){var a=t.subtract(e).normalize(),i=t.subtract(n).normalize(),o=Y.e.GetAngleBetweenVectors(a,i,Y.e.Zero()),s=a.add(i).normalize(),c=r/Math.sin(o/2);return t.add(s.scale(c))}var Fr;function Gr(e,t,n,r,a,o){var c=Object(s.useRef)(null);return Object(s.useEffect)((function(){console.log("running setup");var o=document.getElementById("renderCanvas"),s=new b.Engine(o,!0,{}),u=N(s,o);c.current=function(e,t,n,r,a,o){var s=Fr.ATTRACTORS,c=new b.TransformNode("modelRoot"),u=new b.TransformNode("extrasRoot"),h=C[e.material](t),l=(C[i.WIRE](t),0);return xt(t),function(){c.getChildMeshes().forEach((function(e){e.dispose()}));var e=Er(130),n=C[i.PLYWOOD](t),o=C[i.BLACK](t),s=Tr(200,t),h=Yn(s),l=h.pieces,d=h.edges,f=zr(l,0,n,S()("1234")),p=kn(d);s.dispose(),f.parent=c,p.material=o,p.parent=c,e.material=o,e.parent=c,0===u.getChildMeshes().length&&gt(u,t,200,70),c.rotation.y=0,u.rotation.y=0;var m=c.getHierarchyBoundingVectors(),v=m.max.subtract(m.min),j=v.x*v.y*v.z/1e3;return r(12.99+.0201*j),a(v),console.time("grow"),{mesh:s}}().mesh,t.beforeRender=function(){s===Fr.ATTRACTORS&&(n(1),s=Fr.DONE),l+=.001,c.rotation.y=l,u.rotation.y=l},{onUpdate:function(r){var a=J(e,r);console.log(a,"changed"),e=r,a.includes("material")?(console.log("material changed"),h=C[e.material](t),c.getChildMeshes().forEach((function(e){e.material=h}))):a.includes("seed")?(n(1),s=Fr.ATTRACTORS):(n(1),s=Fr.WAITING_FOR_CHANGE)},startExport:function(){},commitChanges:function(){s===Fr.WAITING_FOR_CHANGE&&(s=Fr.ATTRACTORS)}}}(e,u,n,r,a),s.runRenderLoop((function(){u.render(),t(Math.round(s.getFps()))})),window.addEventListener("resize",(function(){s.resize()}))}),[]),c.current}function _r(){var e=Object(s.useState)(0),t=Object(l.a)(e,2),n=t[0],r=t[1],a=Object(s.useState)(0),c=Object(l.a)(a,2),u=c[0],h=c[1],p=Object(s.useState)(void 0),m=Object(l.a)(p,2),v=m[0],j=m[1],b=Object(s.useState)(void 0),g=Object(l.a)(b,2),x=g[0],O=g[1],y=Object(s.useState)(i.BLACK),w=Object(l.a)(y,2),M=w[0],C=w[1],E=Object(s.useState)(Math.random().toString(36).substr(2,5)),T=Object(l.a)(E,2),S=T[0],R=T[1],L=Object(s.useState)(10),A=Object(l.a)(L,2),N=A[0],k=A[1],P=Object(s.useState)(10),I=Object(l.a)(P,2),B=I[0],W=I[1],z=Object(s.useState)(.5),D=Object(l.a)(z,2),V=D[0],F=D[1],G=Object(s.useState)(4),_=Object(l.a)(G,2),H=_[0],U=_[1],Y={cubeWidth:N,cubeHeight:B,material:M,fill:V,seed:S,numBoxes:H},K=Gr(Y,r,h,j,O);Object(s.useEffect)((function(){K&&K.onUpdate(Y)}),[N,B,M,V,S,H]);var Z=function(){K&&K.commitChanges()};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(pt,{fps:n,loading:u}),Object(o.jsx)(d.a,{item:!0,xs:3,style:{height:"100vh",overflow:"auto"},children:Object(o.jsxs)(ht.a,{p:4,children:[Object(o.jsx)(f.a,{component:"h2",variant:"h6",children:"Origami Series"}),Object(o.jsx)(f.a,{component:"h1",variant:"h4",children:'"Ico"'}),Object(o.jsx)(Ut,{value:S,setValue:R}),Object(o.jsx)(Lt,{material:M,setMaterial:C}),Object(o.jsx)(dt,{label:"Cube width",value:N,min:10,max:15,units:"cm",setValue:k,onCommit:Z}),Object(o.jsx)(dt,{label:"Cube height",value:B,min:10,max:30,units:"cm",setValue:W,onCommit:Z}),Object(o.jsx)(dt,{label:"Density",value:V,min:0,max:1,percent:!0,setValue:F,onCommit:Z}),Object(o.jsx)(dt,{label:"Number of boxes",value:H,min:4,max:6,setValue:U,onCommit:Z}),v&&x&&Object(o.jsx)(It,{onExport:function(){return K&&K.startExport()},price:v,dimensions:x,modelProps:Y}),Object(o.jsx)(lt.a,{}),Object(o.jsx)(ht.a,{my:2,children:Object(o.jsx)(f.a,{color:"textSecondary",variant:"body2",children:"Made from laser cut wood"})}),Object(o.jsx)(_t,{})]})})]})}function Hr(){return Object(s.useEffect)((function(){setTimeout((function(){return function(){var e=[new Y.d(100,100),new Y.d(500,500),new Y.d(100,800)],t=[new Y.d(500,100),new Y.d(100,500),new Y.d(500,800)],n=ae(sn(e,(function(e){return 10+10*e})),[]),r=ae(sn(t,(function(e){return 10+10*e})),[]),a=(i=un([n],[r])[0],{shape:te(i[0]),holes:i.slice(1).map((function(e){return te(e).reverse()}))});var i;!function(e,t){var n='\n  <svg viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg">\n    '.concat(Ur(e),"\n    ").concat(t.map((function(e){return Ur(e)})).join("\n"),"\n  </svg>");console.log(n),document.getElementById("svg").innerHTML=n}(a.shape,a.holes)}()}),100)}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsx)(d.a,{container:!0,spacing:3,children:Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)("svg",{id:"svg",style:{border:"solid 1px #aaa"},width:800,height:800})})})})}function Ur(e){var t=e.map((function(e){return"".concat(e.x,",").concat(e.y)}));return'<polygon stroke="#000" fill="none" points="'.concat(t.join(" "),'" />')}function Yr(){var e=Object(s.useRef)(null);return Object(s.useEffect)((function(){e.current=function(){var e=document.getElementById("renderCanvas"),t=new b.Engine(e,!0),n=N(t,e);new b.HemisphericLight("light",new b.Vector3(1,.7,1),n),new b.StandardMaterial("myMaterial",n).wireframe=!0,nn(30,n);C[i.GRAY](n);var r=[],a=Er(0);return r.push(a),t.runRenderLoop((function(){n.render()})),{startExport:function(){x.STLExport.CreateSTL(r,!0,"export",!0)}}}()}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)(d.a,{container:!0,spacing:3,children:[Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:800,height:800})}),Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)(j.a,{variant:"contained",onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})})]})})}function Kr(){var e=Object(s.useRef)(null);return Object(s.useEffect)((function(){e.current=function(){var e=document.getElementById("renderCanvas"),t=new b.Engine(e,!0),n=N(t,e);new b.HemisphericLight("light",new b.Vector3(1,.7,1),n),new b.StandardMaterial("myMaterial",n).wireframe=!0,nn(30,n);C[i.GRAY](n);var r=function(){for(var e=8.7,t=25,n=7,r=[],a=0;a<2;a++)for(var i=0;i<7;i++)for(var o=0;o<4;o++)if(!(1===a&&o>=2)){var s=new Y.e(o*t,a*n,i*e),c=Lr(),u=c.left,h=c.right;u.rotation.z=Math.PI,u.position=s.clone(),h.position=s.clone(),r.push(u,h)}return r}();return t.runRenderLoop((function(){n.render()})),{startExport:function(){x.STLExport.CreateSTL(r,!0,"export",!0)}}}()}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)(d.a,{container:!0,spacing:3,children:[Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:800,height:800})}),Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)(j.a,{variant:"contained",onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})})]})})}function Zr(){var e=Object(s.useRef)(null);return Object(s.useEffect)((function(){e.current=function(){var e=document.getElementById("renderCanvas"),t=new b.Engine(e,!0),n=N(t,e);new b.HemisphericLight("light",new b.Vector3(1,.7,1),n);new b.StandardMaterial("myMaterial",n);nn(30,n);var r=C[i.WHITE](n),a=[],o=Xr(n);a.push(o),o.material=r;var s=Xr(n);a.push(s),s.material=r,s.rotation.z=Math.PI,s.position.x=-10;var c=b.MeshBuilder.CreateBox("hinge",{width:7,height:1,depth:4});return c.position.x=-5,a.push(c),c.material=r,t.runRenderLoop((function(){n.render()})),{startExport:function(){x.STLExport.CreateSTL(a,!0,"export",!0)}}}()}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)(d.a,{container:!0,spacing:3,children:[Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:800,height:800})}),Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)(j.a,{variant:"contained",onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})})]})})}function Xr(e){var t=Ke.CSG.cube({corner1:[-2,-2.5,-4],corner2:[8,2.5,4]}),n=Ke.CSG.cube({corner1:[-1,-1.5,-3],corner2:[8.5,1.5,3]}),r=Ke.CSG.cube({corner1:[2,-2.5,-.5],corner2:[8.5,2.5,.5]}),a=Ke.CSG.cube({corner1:[6,-1.5,-3.1],corner2:[7,1.5,-2]}),i=Ke.CSG.cube({corner1:[6,-1.5,2],corner2:[7,1.5,3.1]}),o=t;return Xe(o=(o=(o=(o=o.subtract(n)).subtract(r)).union(a)).union(i),e)}function qr(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:400,c=Object(s.useRef)(null);return Object(s.useEffect)((function(){Object(H.a)(_.a.mark((function s(){var u,h,l,d;return _.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return console.log("running setup"),u=document.getElementById("renderCanvas"),h=new b.Engine(u,!0,{}),l=N(h,u,o),d=new t(e,l,r,a,i),c.current=d,s.next=8,d.initAsync();case 8:d.start(),l.beforeRender=c.current.beforeRender,h.runRenderLoop((function(){l.render(),n(Math.round(h.getFps()))})),window.addEventListener("resize",(function(){h.resize()}));case 12:case"end":return s.stop()}}),s)})))()}),[]),c.current}!function(e){e[e.WAITING_FOR_CHANGE=0]="WAITING_FOR_CHANGE",e[e.ATTRACTORS=1]="ATTRACTORS",e[e.GROWING=2]="GROWING",e[e.DRAWING=3]="DRAWING",e[e.DONE=4]="DONE"}(Fr||(Fr={}));var Jr;!function(e){e[e.WAITING_FOR_CHANGE=0]="WAITING_FOR_CHANGE",e[e.ATTRACTORS=1]="ATTRACTORS",e[e.GROWING=2]="GROWING",e[e.DRAWING=3]="DRAWING",e[e.DONE=4]="DONE"}(Jr||(Jr={}));var Qr=function(){function e(t,n,r,a,i){Object(B.a)(this,e),this.modelProps=t,this.scene=n,this.setLoading=r,this.setPrice=a,this.setDimensions=i,this.iteration=0,this.rotation=0,this.status=Jr.ATTRACTORS,this.rootNode=void 0,this.extrasRootNode=void 0,this.material=void 0,this.rootNode=new b.TransformNode("modelRoot"),this.extrasRootNode=new b.TransformNode("extrasRoot"),this.material=C[t.material](n),xt(n),this.beforeRender=this.beforeRender.bind(this)}return Object(W.a)(e,[{key:"initAsync",value:function(){var e=Object(H.a)(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"start",value:function(){this.rootNode.getChildMeshes().forEach((function(e){e.dispose()}));var e=Er(130),t=C[i.PLYWOOD](this.scene),n=C[i.BLACK](this.scene),r=Tr(200,this.scene),a=Yn(r),o=a.pieces,s=a.edges,c=S()("1234"),u=zr(o,this.scene,t,c),h=kn(s);r.dispose(),u.parent=this.rootNode,h.material=n,h.parent=this.rootNode,e.material=n,e.parent=this.rootNode,0===this.extrasRootNode.getChildMeshes().length&&gt(this.extrasRootNode,this.scene,200,70),this.rootNode.rotation.y=0,this.extrasRootNode.rotation.y=0;var l=this.rootNode.getHierarchyBoundingVectors(),d=l.max.subtract(l.min),f=d.x*d.y*d.z/1e3;this.setPrice(12.99+.0201*f),this.setDimensions(d),console.time("grow")}},{key:"beforeRender",value:function(){this.iteration++,this.status===Jr.ATTRACTORS&&(this.setLoading(1),this.status=Jr.DONE),this.rotation+=.001,this.rootNode.rotation.y=this.rotation,this.extrasRootNode.rotation.y=this.rotation}},{key:"onUpdate",value:function(e){var t=this,n=J(this.modelProps,e);console.log(n,"changed"),this.modelProps=e,n.includes("material")?(console.log("material changed"),this.material=C[this.modelProps.material](this.scene),this.rootNode.getChildMeshes().forEach((function(e){e.material=t.material}))):n.includes("seed")?(this.setLoading(1),this.status=Jr.ATTRACTORS):(this.setLoading(1),this.status=Jr.WAITING_FOR_CHANGE)}},{key:"startExport",value:function(){}},{key:"commitChanges",value:function(){this.status===Jr.WAITING_FOR_CHANGE&&(this.status=Jr.ATTRACTORS)}}]),e}();function $r(){var e=Object(s.useState)(0),t=Object(l.a)(e,2),n=t[0],r=t[1],a=Object(s.useState)(0),c=Object(l.a)(a,2),u=c[0],h=c[1],p=Object(s.useState)(void 0),m=Object(l.a)(p,2),v=m[0],j=m[1],b=Object(s.useState)(void 0),g=Object(l.a)(b,2),x=g[0],O=g[1],y=Object(s.useState)(i.BLACK),w=Object(l.a)(y,2),M=w[0],C=w[1],E=Object(s.useState)(Math.random().toString(36).substr(2,5)),T=Object(l.a)(E,2),S=T[0],R=T[1],L=Object(s.useState)(10),A=Object(l.a)(L,2),N=A[0],k=A[1],P=Object(s.useState)(10),I=Object(l.a)(P,2),B=I[0],W=I[1],z=Object(s.useState)(.5),D=Object(l.a)(z,2),V=D[0],F=D[1],G=Object(s.useState)(4),_=Object(l.a)(G,2),H=_[0],U=_[1],Y={cubeWidth:N,cubeHeight:B,material:M,fill:V,seed:S,numBoxes:H},K=qr(Y,Qr,r,h,j,O);Object(s.useEffect)((function(){K&&K.onUpdate(Y)}),[N,B,M,V,S,H]);var Z=function(){K&&K.commitChanges()};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(pt,{fps:n,loading:u}),Object(o.jsx)(d.a,{item:!0,xs:3,style:{height:"100vh",overflow:"auto"},children:Object(o.jsxs)(ht.a,{p:4,children:[Object(o.jsx)(f.a,{component:"h2",variant:"h6",children:"Origami Series"}),Object(o.jsx)(f.a,{component:"h1",variant:"h4",children:'"Ico"'}),Object(o.jsx)(Ut,{value:S,setValue:R}),Object(o.jsx)(Lt,{material:M,setMaterial:C}),Object(o.jsx)(dt,{label:"Cube width",value:N,min:10,max:15,units:"cm",setValue:k,onCommit:Z}),Object(o.jsx)(dt,{label:"Cube height",value:B,min:10,max:30,units:"cm",setValue:W,onCommit:Z}),Object(o.jsx)(dt,{label:"Density",value:V,min:0,max:1,percent:!0,setValue:F,onCommit:Z}),Object(o.jsx)(dt,{label:"Number of boxes",value:H,min:4,max:6,setValue:U,onCommit:Z}),v&&x&&Object(o.jsx)(It,{onExport:function(){return K&&K.startExport()},price:v,dimensions:x,modelProps:Y}),Object(o.jsx)(lt.a,{}),Object(o.jsx)(ht.a,{my:2,children:Object(o.jsx)(f.a,{color:"textSecondary",variant:"body2",children:"Made from laser cut wood"})}),Object(o.jsx)(_t,{})]})})]})}var ea=n(380),ta=n(225),na=n(376),ra=n(379),aa=function(e){Object(na.a)(n,e);var t=Object(ra.a)(n);function n(e,r){var a;return Object(B.a)(this,n),(a=t.call(this,e)).pieces=r,a.pieceByNode=new Map,a.segmentsByPiece=new Map,r.map((function(e){return a.segmentsByPiece.set(e,[])})),a}return Object(W.a)(n,[{key:"addNode",value:function(e,t){var r=this,a=Wt.a.minBy(this.pieces,(function(t){return function(e,t){return t.isHolder?1/0:t.center.subtract(e).length()}(e,t)}));if(!a)throw Error("No nearest piece found");var i=Object(ea.a)(Object(ta.a)(n.prototype),"addNode",this).call(this,e,t);return this.pieceByNode.set(i,a),t&&t.length>0&&t.forEach((function(e){var t=r.pieceByNode.get(e);if(t&&t===a){var n=r.segmentsByPiece.get(a);if(!n)throw Error("segment list not found for piece");n.push([e,i])}})),i}},{key:"getSegmentsByPiece",value:function(){return this.segmentsByPiece}}]),n}(Dt);var ia=n(213),oa={excludeMeshes:[],samplePoints:1e4,thickness:0};function sa(e,t){var n=100,r=e.verticesLocal.map((function(e){return[e.x,e.z]}));r.push(r[0]);var a=Object(mn.polygon)([r]);do{var i=e.verticesLocal.slice(1).reduce((function(e,t){return Y.e.Minimize(t,e)}),e.verticesLocal[0]),o=e.verticesLocal.slice(1).reduce((function(e,t){return Y.e.Maximize(t,e)}),e.verticesLocal[0]),s=new Y.e(Z(i.x,o.x,t),0,Z(i.z,o.z,t)),c=Object(mn.point)([s.x,s.z]);if(Object(ia.a)(c,a))return Y.e.TransformCoordinates(s,e.matrix);n--}while(n>0);throw new Error("Could not find point on piece")}function ca(e){return new it({points:e,getX:function(e){return e.x},getY:function(e){return e.y},getZ:function(e){return e.z},ArrayType:Array,axisCount:3,nodeSize:1})}var ua,ha=n(240),la=n.n(ha);!function(e){e[e.WAITING_FOR_CHANGE=0]="WAITING_FOR_CHANGE",e[e.ATTRACTORS=1]="ATTRACTORS",e[e.GROWING=2]="GROWING",e[e.DRAWING=3]="DRAWING",e[e.DONE=4]="DONE"}(ua||(ua={}));var da=function(){function e(t,n,r,a,i){Object(B.a)(this,e),this.modelProps=t,this.scene=n,this.setLoading=r,this.setPrice=a,this.setDimensions=i,this.iteration=0,this.rotation=0,this.status=ua.ATTRACTORS,this.rootNode=void 0,this.extrasRootNode=void 0,this.material=void 0,this.spaceColonization=void 0,this.mesh=void 0,this.pieces=void 0,this.edges=void 0,this.pieceDrawer=void 0,this.randomGenerator=void 0,this.font=null,this.rootNode=new b.TransformNode("modelRoot"),this.extrasRootNode=new b.TransformNode("extrasRoot"),this.material=C[t.material](n),this.randomGenerator=S()(this.modelProps.seed),xt(n),this.beforeRender=this.beforeRender.bind(this)}return Object(W.a)(e,[{key:"initAsync",value:function(){var e=Object(H.a)(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dn();case 2:this.font=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"start",value:function(){la()(this.font),this.rootNode.getChildMeshes().forEach((function(e){e.dispose()}));var e=10*this.modelProps.diameter/2,t=e-70,n=Un(t),r=C[i.PLYWOOD](this.scene),a=C[i.BLACK](this.scene),o=er(e),s=o.pieces,c=o.edges,u=o.mesh;this.spaceColonization=new aa({segmentLength:2,attractionDistance:60,killDistance:4,seed:this.modelProps.seed,drawSingleLeafs:!0,averageJitter:.01,distanceWeightFunction:function(e){return e}},s);var h=Math.round(Z(2,10,this.randomGenerator));console.log("Generating ".concat(h," start nodes"));for(var l=0;l<h;l++){var d=s[Math.floor(s.length*Math.random())];this.spaceColonization.addNode(sa(d,this.randomGenerator))}var f=C[i.WIRE](this.scene);u.material=f,this.mesh=u,this.pieces=s,this.edges=c,this.pieceDrawer=new Ln(this.spaceColonization,this.scene,r,this.randomGenerator,this.pieces,this.font,"UNFOLD / ICO / ".concat(this.modelProps.seed));var p=kn(c);p.material=a,p.parent=this.rootNode,n.material=a,n.parent=this.rootNode,u.parent=this.rootNode,0===this.extrasRootNode.getChildMeshes().length&&gt(this.extrasRootNode,this.scene,t+70,70),this.rootNode.rotation.y=0,this.extrasRootNode.rotation.y=0;var m=this.rootNode.getHierarchyBoundingVectors(),v=m.max.subtract(m.min),j=v.x*v.y*v.z/1e3;this.setPrice(12.99+.0201*j),this.setDimensions(v),console.time("grow")}},{key:"beforeRender",value:function(){if(this.iteration++,this.status===ua.ATTRACTORS){console.time("attractors");var e=function(e,t,n){for(var r=Object(I.a)(Object(I.a)({},oa),n),a=r.distance,i=r.distanceBottom||r.distance,o=e.getBoundingInfo().boundingBox,s=[],c=ca(s),u=0;u<r.samplePoints;u++){var h=sa(t[Math.floor(r.randomGenerator()*t.length)],r.randomGenerator),l=q(h.y,o.minimum.y,o.maximum.y,a,i);0===c.within(h.x,h.y,h.z,l).length&&(s.push(h),c=ca(s))}return console.info("Found ".concat(s.length," attractors")),s.map((function(e){return{position:e,killed:!1,reached:!1}}))}(this.mesh,this.pieces,{distance:10,randomGenerator:this.randomGenerator});console.timeEnd("attractors"),this.spaceColonization.setAttractors(e),this.status=ua.GROWING}if(this.status===ua.GROWING){var t=this.spaceColonization.stepFunction(),n=this.spaceColonization.getAttractors(),r=n.filter((function(e){return e.killed}));if(this.setLoading(r.length/n.length),t&&this.pieces){console.timeEnd("grow"),console.time("draw"),this.status=ua.DRAWING;var a=this.pieceDrawer.draw(),i=Object(l.a)(a,2),o=i[0],s=i[1];o.parent=this.rootNode,s.parent=this.rootNode,this.mesh&&this.mesh.dispose(),this.setLoading(1)}}this.rotation+=.001,this.rootNode.rotation.y=this.rotation,this.extrasRootNode.rotation.y=this.rotation}},{key:"onUpdate",value:function(e){var t=this,n=J(this.modelProps,e);console.log(n,"changed"),this.modelProps=e,n.includes("material")?(console.log("material changed"),this.material=C[this.modelProps.material](this.scene),this.rootNode.getChildMeshes().forEach((function(e){e.material=t.material}))):n.includes("seed")?(this.setLoading(1),this.status=ua.ATTRACTORS):(this.setLoading(1),this.status=ua.WAITING_FOR_CHANGE)}},{key:"startExport",value:function(){var e=cr(this.pieces);Hn(e.shapes,e.engravings,e.panels)}},{key:"commitChanges",value:function(){this.status===ua.WAITING_FOR_CHANGE&&(this.status=ua.ATTRACTORS)}}]),e}();function fa(){var e=Object(s.useState)(0),t=Object(l.a)(e,2),n=t[0],r=t[1],a=Object(s.useState)(0),c=Object(l.a)(a,2),u=c[0],h=c[1],p=Object(s.useState)(void 0),m=Object(l.a)(p,2),v=m[0],j=m[1],b=Object(s.useState)(void 0),g=Object(l.a)(b,2),x=g[0],O=g[1],y=Object(s.useState)(i.BLACK),w=Object(l.a)(y,2),M=w[0],C=w[1],E=Object(s.useState)(Math.random().toString(36).substr(2,5)),T=Object(l.a)(E,2),S=T[0],R=T[1],L=Object(s.useState)(40),A=Object(l.a)(L,2),N=A[0],k=A[1],P=Object(s.useState)(.5),I=Object(l.a)(P,2),B=I[0],W=I[1],z={diameter:N,material:M,fill:B,seed:S},D=qr(z,da,r,h,j,O);Object(s.useEffect)((function(){D&&D.onUpdate(z)}),[N,M,B,S]);var V=function(){D&&D.commitChanges()};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(pt,{fps:n,loading:u}),Object(o.jsx)(d.a,{item:!0,xs:3,style:{height:"100vh",overflow:"auto"},children:Object(o.jsxs)(ht.a,{p:4,children:[Object(o.jsx)(f.a,{component:"h2",variant:"h6",children:"Origami Series"}),Object(o.jsx)(f.a,{component:"h1",variant:"h4",children:'"Ico"'}),Object(o.jsx)(Ut,{value:S,setValue:R}),Object(o.jsx)(Lt,{material:M,setMaterial:C,onlyWood:!0}),Object(o.jsx)(dt,{label:"Diameter",value:N,min:30,max:50,units:"cm",setValue:k,onCommit:V}),Object(o.jsx)(dt,{label:"Density",value:B,min:0,max:1,percent:!0,setValue:W,onCommit:V}),v&&x&&Object(o.jsx)(It,{onExport:function(){return D&&D.startExport()},price:v,dimensions:x,modelProps:z}),Object(o.jsx)(lt.a,{}),Object(o.jsx)(ht.a,{my:2,children:Object(o.jsx)(f.a,{color:"textSecondary",variant:"body2",children:"Made from laser cut wood"})}),Object(o.jsx)(_t,{})]})})]})}function pa(){var e=Object(s.useRef)(null);return Object(s.useEffect)((function(){console.log("running setup"),e.current=function(){var e=document.getElementById("renderCanvas"),t=new b.Engine(e,!0),n=N(t,e);xt(n);new b.HemisphericLight("light",new b.Vector3(-.8,.8,.8),n);b.SphereBuilder.CreateSphere("sphere",{diameter:200}).material=C[i.REDWOOD](n),t.runRenderLoop((function(){n.render()}))}()}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsx)(d.a,{container:!0,spacing:3,children:Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:600,height:600})})})})}function ma(){return Object(s.useEffect)((function(){zn.a.load("/assets/fonts/machtgth.ttf",(function(e,t){if(t&&(console.log("font loaded"),function(e){var t=vn(e.getPath("Hello 0123456789",20,150,50)).features.map((function(e){return Tn(e,.5,8)})).map((function(e){return e.geometry.coordinates}));!function(e){console.log("drawing ".concat(e.coordinates.length," polygons"));var t='\n  <svg viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">\n    '.concat(e.coordinates.map((function(e){return function(e){return e.map((function(e,t){return function(e,t){var n=e.map((function(e){return"".concat(e[0],",").concat(e[1])}));return'<polyline stroke="'.concat(t,'" fill="none" points="').concat(n.join(" "),'" />')}(e,t>0?"#f00":"#000")})).join("\n")}(e)})).join("\n"),"\n  </svg>");document.getElementById("svg").innerHTML=t}(Object(mn.multiPolygon)(t).geometry)}(t)),e)throw e}))}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsx)(d.a,{container:!0,spacing:3,children:Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)("svg",{id:"svg",style:{border:"solid 1px #aaa"},width:800,height:800})})})})}function va(e){var t=function(e,t){var n=t.steps||32,r=t.height/2,a=[];a.push(new Y.e(-t.length,0,r));var i=b.Curve3.CreateQuadraticBezier(new Y.e(0,0,r),new Y.e(2.5,0,0),new Y.e(0,0,-r),10);a.push.apply(a,Object(g.a)(i.getPoints())),a.push(new Y.e(-t.length,0,-r)),a.push(new Y.e(-t.length,0,r));var o=[];if(t.holeRadius)for(var s=0;s<n;s++){var c=s/n*2*Math.PI,u=new Y.e(Math.sin(c)*t.holeRadius,0,Math.cos(c)*t.holeRadius);o.push(u)}return b.MeshBuilder.ExtrudePolygon(e,{shape:a.reverse(),holes:o.length>0?[o.reverse()]:void 0,depth:t.depth})}("jointClip",{height:e.clipWidth,length:e.clipLength+2.5,depth:e.clipThickness});t.position.x=2.5;var n=gn(b.MeshBuilder.CreateCylinder("jointPin",{diameter:3.5,height:1.1,subdivisions:2,tessellation:32}),(function(e){return e.x>.5&&e.y>0&&(e.x=.5),e})),r=K.a.MergeMeshes([t,n]);if(!r)throw new Error("Merging meshes failed");return r}function ja(e){var t=va({clipThickness:e.clipThickness,clipWidth:e.clipWidth,clipLength:e.clipLength}),n=va({clipThickness:e.clipThickness,clipWidth:e.clipWidth,clipLength:e.clipLength});t.position.y=-e.pieceThickness/2,t.position.x=e.stripWidth+e.clipLength,n.position.y=e.pieceThickness/2,n.rotation.x=Math.PI,n.position.x=e.stripWidth+e.clipLength;var r=b.MeshBuilder.CreateBox("body",{width:e.bodyWidth,depth:e.clipWidth,height:e.pieceThickness+.1});r.position.x=e.stripWidth+e.bodyWidth/2;var a=b.MeshBuilder.CreateBox("strip",{width:e.stripWidth,depth:e.clipWidth,height:.4});a.position.x=e.stripWidth/2;var i=K.a.MergeMeshes([t,n,r,a]);if(!i)throw new Error("Merging meshes failed");return i}var ba={pinDiameter:3,clipWidth:8,pieceThickness:3.3,jointTolerance:.3,clipThickness:.8,bodyWidth:1.5,clipLength:5.5,pieceClipClearance:.1,stripWidth:2.5};function ga(){return(2*ba.clipThickness+ba.pieceThickness)/2+ba.jointTolerance+ba.bodyWidth+ba.pieceClipClearance}function xa(){var e=Object(s.useRef)(null);return Object(s.useEffect)((function(){e.current=function(){var e=document.getElementById("renderCanvas"),t=new b.Engine(e,!0),n=N(t,e);new b.HemisphericLight("light",new b.Vector3(1,.7,1),n);var r=new b.StandardMaterial("myMaterial",n);r.wireframe=!0,nn(30,n);var a=[],i=function(){var e=ja(ba);return e.rotation.z=Math.PI,{left:e,right:ja(ba)}}(),o=i.left,s=i.right;return a.push(o,s),o.material=r,s.material=r,console.log("Frame offset:",ga()),console.log("Pin offset:",function(){return ga()+ba.clipLength-ba.bodyWidth-ba.pieceClipClearance+1}()),t.runRenderLoop((function(){n.render()})),{startExport:function(){x.STLExport.CreateSTL(a,!0,"export",!0)}}}()}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)(d.a,{container:!0,spacing:3,children:[Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:800,height:800})}),Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)(j.a,{variant:"contained",onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})})]})})}function Oa(){var e=Object(s.useRef)(null);return Object(s.useEffect)((function(){Object(H.a)(_.a.mark((function t(){return _.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ya();case 2:e.current=t.sent;case 3:case"end":return t.stop()}}),t)})))()}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsx)(d.a,{container:!0,spacing:3,children:Object(o.jsxs)(d.a,{item:!0,xs:6,children:[Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:800,height:800}),Object(o.jsx)(j.a,{onClick:function(){console.log("download"),e.current.startExport()},children:"Export"})]})})})}function ya(){return wa.apply(this,arguments)}function wa(){return(wa=Object(H.a)(_.a.mark((function e(){var t,n,r,a,o,s,c;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("renderCanvas"),n=new b.Engine(t,!0),r=N(n,t),(a=new b.StandardMaterial("wireframe",r)).wireframe=!0,nn(30,r),C[i.GRAY](r).wireframe=!0,o=qt(0,400,250,.9),(s=o.mesh).material=a,s.material=a,n.runRenderLoop((function(){r.render()})),c=function(){},e.abrupt("return",{startExport:c});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ma(e,t){var n=new Dt({openVenation:!1,killDistance:10,segmentLength:5,attractionDistance:150,rotation:e.rotation/2,seed:e.seed,adjustAverageDirectionFunction:function(e,t){if(t.direction&&0===t.children.length){var n=Math.max(0,5-t.distance);e=e.add(t.direction.scale(5*n)).normalize()}return e}}),r=qt(0,e.width,e.height,e.arc),a=r.mesh,i=r.excludeMeshes;return{spaceColonization:n,startNodes:Ft(82.5,6,20,3,0,n),mesh:a,excludeMeshes:i,holderPosition:100,holderHeight:35}}function Ca(){var e=Object(s.useState)(0),t=Object(l.a)(e,2),n=t[0],r=t[1],a=Object(s.useState)(0),c=Object(l.a)(a,2),u=c[0],h=c[1],p=Object(s.useState)(void 0),m=Object(l.a)(p,2),v=m[0],j=m[1],b=Object(s.useState)(void 0),g=Object(l.a)(b,2),x=g[0],O=g[1],y=Object(s.useState)(i.PLYWOOD),w=Object(l.a)(y,2),M=w[0],C=w[1],E=Object(s.useState)(Math.random().toString(36).substr(2,5)),T=Object(l.a)(E,2),S=T[0],R=T[1],L=Object(s.useState)(40),A=Object(l.a)(L,2),N=A[0],k=A[1],P=Object(s.useState)(25),I=Object(l.a)(P,2),B=I[0],W=I[1],z=Object(s.useState)(.9),D=Object(l.a)(z,2),V=D[0],F=D[1],G=Object(s.useState)(0),_=Object(l.a)(G,2),H=_[0],U=_[1],Y=Object(s.useState)(0),K=Object(l.a)(Y,2),Z=K[0],X=K[1],q=Object(s.useState)(1),J=Object(l.a)(q,2),Q=J[0],$=J[1],ee={width:N,height:B,arc:V,rotation:Z,insideGrowth:Q,material:M,fill:H,seed:S},te=Rt(ee,r,h,j,O,Ma);Object(s.useEffect)((function(){te&&te.onUpdate(ee)}),[N,B,V,M,Q,H,S,Z]);var ne=function(){te&&te.commitChanges()};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(pt,{fps:n,loading:u}),Object(o.jsx)(d.a,{item:!0,xs:3,style:{height:"100vh",overflow:"auto"},children:Object(o.jsxs)(ht.a,{p:4,children:[Object(o.jsx)(f.a,{component:"h2",variant:"h6",children:"Babylon Series"}),Object(o.jsx)(f.a,{component:"h1",variant:"h4",children:'"Atmosphere"'}),Object(o.jsx)(Ut,{value:S,setValue:R}),Object(o.jsx)(Lt,{material:M,setMaterial:C}),Object(o.jsx)(dt,{label:"Width",value:N,min:15,max:40,units:"cm",setValue:k,onCommit:ne}),Object(o.jsx)(dt,{label:"Height",value:B,min:15,max:40,units:"cm",setValue:W,onCommit:ne}),Object(o.jsx)(dt,{label:"Arc",value:V,min:.3,max:1,percent:!0,setValue:F,onCommit:ne}),Object(o.jsx)(dt,{label:"Density",value:H,min:0,max:1,percent:!0,setValue:U,onCommit:ne}),Object(o.jsx)(dt,{label:"Twist",value:Z,min:0,max:1,percent:!0,setValue:X,onCommit:ne}),Object(o.jsx)(dt,{label:"Inside growth",value:Q,min:0,max:1,percent:!0,setValue:$,onCommit:ne}),v&&x&&Object(o.jsx)(It,{onExport:function(){return te&&te.startExport()},price:v,dimensions:x,modelProps:ee}),Object(o.jsx)(lt.a,{}),Object(o.jsx)(ht.a,{my:2,children:Object(o.jsx)(f.a,{color:"textSecondary",variant:"body2",children:"The sphere is the most basic three-dimensional shape in the universe. But as you zoom in further and further, complex shapes take the upper hand."})}),Object(o.jsx)(_t,{})]})})]})}var Ea=1195,Ta=10;function Sa(e){if(0===e.length)throw Error("No pieces to pack");for(var t=Object(mn.multiPolygon)([]),n=Object(mn.lineStrings)([]),r=Object(mn.multiPolygon)([]),a=0;a<1;a++)Aa(a,r);return e.forEach((function(e,r){if(!e.shape||!e.holes)throw new Error("No piece shape or holes");var a=r%8,i=Object(Bt.floor)(r/8),o=Y.a.RotationAxis(Y.e.Forward(),Math.random()*(2*Math.PI)).setTranslation(new Y.e(530*(a+1),1205+530*(i+1),0)),s=e.shape.map((function(e){return Y.d.Transform(e,o)})),c=e.holes.map((function(e){return e.map((function(e){return Y.d.Transform(e,o)}))})).map((function(e){return Ra(e)})),u=Object(mn.polygon)([Ra(s)].concat(Object(g.a)(c)));if(e.engraving){var h,l=function(e,t){var n=Object(fn.a)(e);return Object(dn.a)(n,(function(e){var n=new Y.d(e[0],e[1]),r=Y.d.Transform(n,t);e[0]=r.x,e[1]=r.y})),n}(e.engraving,o);(h=n.features).push.apply(h,Object(g.a)(l.features))}var d=Object(ar.a)(t,u);if(!d)throw new Error("Union failed");t=d})),{shapes:La(t),engravings:n,panels:La(r)}}function Ra(e){var t=e.map((function(e){return[e.x,e.y]}));return t.push(t[0]),t}function La(e){return e.geometry.coordinates.reduce((function(e,t){var n=t.map((function(e){return e.map((function(e){return new Y.d(e[0],e[1])}))}));return e.push.apply(e,Object(g.a)(n)),e}),[])}function Aa(e,t){var n=[[805*e,0],[805*(e+1)-Ta,0],[805*(e+1)-Ta,Ea],[805*e,Ea],[805*e,0]];t.geometry.coordinates.push([n])}function Na(e,t,n,r,a,i){if(n>=r&&n<a){for(var o=ka(new Y.e(0,0,0),20,i),s=ka(new Y.e(0,0,0),40,i),c=[],u=0;u<4;u++){var h=30+u*(i/4);c.push([t[h-5].clone(),t[h+5].clone(),s[h+25].clone(),s[h-25].clone()])}var l=ne(t,[e]),d=ne(s,[o]),f=c.map((function(e){return ne(e,[])}));return $(en.a.union.apply(en.a,[l,d].concat(Object(g.a)(f)))[0])}return{shape:t,holes:[e]}}function ka(e,t,n){for(var r=[],a=0;a<n;a++){var i=a/n*Math.PI*2,o=new Y.e(Math.sin(i)*t,0,Math.cos(i)*t);r.push(e.add(o))}return r.push(r[0]),r.reverse()}function Pa(e,t,n,r){var a,i,o=n||Object(mn.lineStrings)([]);if(!e.previous)return o;var s=function(e,t){return{innerShape:e.innerShape.map((function(e,n){return oe((r=[e,t.innerShape[n]],Object(Bt.maxBy)(r,(function(e){return e.length()}))||Y.e.Zero()));var r})),outerShape:e.outerShape.map((function(e,n){return oe((r=[e,t.outerShape[n]],Object(Bt.minBy)(r,(function(e){return e.length()}))||Y.e.Zero()));var r}))}}(e,e.previous),c=e.outerShape.length-100,u=Math.round(e.outerShape.length/2)-1,h=Object(mn.lineStrings)([[[s.outerShape[100].x,s.outerShape[100].y],[s.innerShape[100].x,s.innerShape[100].y]],[[s.outerShape[c].x,s.outerShape[c].y],[s.innerShape[c].x,s.innerShape[c].y]],[[s.outerShape[u].x,s.outerShape[u].y],[s.innerShape[u].x,s.innerShape[u].y]],Ia(s.innerShape,s.outerShape).map((function(e){return[e.x,e.y]}))]);(a=o.features).push.apply(a,Object(g.a)(h.features));var l=function(e,t,n){return vn(e.getPath(t,0,0,n))}(t,"".concat(r).concat(e.id),7),d=Object(ln.a)(l,0,{pivot:[0,0]}),f=function(e){var t=Object(pn.a)(e);return[(t[0]+t[2])/2,(t[1]+t[3])/2]}(d);Object(dn.a)(d,(function(e){e[0]-=f[0],e[1]-=f[1]}));var p=(s.outerShape[0].x+s.innerShape[0].x)/2,m=(s.outerShape[0].y+s.innerShape[0].y)/2;return Object(dn.a)(d,(function(e){e[0]+=p,e[1]+=m})),(i=o.features).push.apply(i,Object(g.a)(d.features)),o}function Ia(e,t){return e.slice(6,e.length-6).map((function(e,n){var r=t[n+6];return e.add(r).scale(.5)}))}function Ba(e,t){for(var n,r=t.numLayers,a=t.layerThickness,i=t.width,o=t.holderFromLayer,s=t.holderToLayer,c=t.minOverlap,u=t.defaultWidth,h=t.prefix,l=t.radiusFunction,d=[],f=r-1;f>=0;f--){var p,m=f/(r-1),v=Wa(t.steps,new Y.e(0,0,0),l,m,i,c,u,null===(p=Object(Bt.last)(d))||void 0===p?void 0:p.radii),j=v.innerShape,b=v.outerShape,g=v.radii,x=Na(j,b,f,o,s,t.steps),O=x.shape,y=x.holes,w={id:f,innerShape:j,outerShape:b,radii:g,shape:se(O),holes:y.map(se),previous:Object(Bt.last)(d)};d.push(w)}d.forEach((function(t){t.engraving=Pa(t,e,t.engraving,h)}));var M=null===(n=Object(Bt.last)(d))||void 0===n?void 0:n.radii;if(!M)throw Error("no lastRadii");for(var C,E=r*a,T=M[0].innerRadius,S=M[0].outerRadius,R=Object(Bt.max)(d.flatMap((function(e){return e.radii.map((function(e){return e.outerRadius}))}))),L=o*a-70,A=(C=T/L,180*Math.atan(C)/Math.PI),N=0,k=d;N<k.length;N++){var P=k[N];console.log("Layer ".concat(P.id," - inner radius: ").concat(P.radii[0].innerRadius,", outer radius:  ").concat(P.radii[0].outerRadius))}return console.log("Lamp height is ".concat(E,"mm")),console.log("Bottom inner radius is ".concat(T,"mm")),console.log("Bottom outer radius is ".concat(S,"mm")),console.log("Max outer radius is ".concat(R,"mm")),console.log("Light source is ".concat(L,"mm from bottom of lamp")),console.log("Half of the lamps beam angle is ".concat(A," degrees")),d}function Wa(e,t,n,r,a,i,o,s){for(var c=[],u=[],h=[],l=0;l<e;l++){var d=l/e*Math.PI*2,f=n(r,d);la()(f<=1,"radius factor must not be higher than 1");var p=f*a/2,m=za(s?s[l].innerRadius:null,s?s[l].outerRadius:null,p,i,o),v=m.innerRadius,j=m.outerRadius;h.push({innerRadius:v,outerRadius:j}),c.push(new Y.e(Math.sin(d)*v,0,Math.cos(d)*v).add(t)),u.push(new Y.e(Math.sin(d)*j,0,Math.cos(d)*j).add(t))}return u.push(u[0]),c.push(c[0]),{innerShape:c.reverse(),outerShape:u.reverse(),radii:h}}function za(e,t,n,r,a){var i,o,s,c;if(t&&e&&(i=e,o=t,s=n-a,c=n,Math.min(o,c)-Math.max(i,s))<r)return n>t?{innerRadius:t-r,outerRadius:n}:{innerRadius:n-a,outerRadius:e+r};return{innerRadius:n-a,outerRadius:n}}var Da=function(e,t){return function(e){var t=-.75,n=t+(.95-t)*e;return Math.sin(Math.acos(n))}(Math.pow(e,.7))-Math.sin(e*Math.PI)*function(e,t){return Math.abs(Math.sin(4*e))*t}(t,.1)};var Va=.4;function Fa(e,t,n,r){var a=b.MeshBuilder.ExtrudePolygon("layer".concat(e.id),{shape:ue(e.shape),holes:e.holes.map(ue),depth:t},n);return a.material=r,a}var Ga=500;function _a(e,t,n){return"".concat(e.map((function(e){return Ha(e,"#000")})).join("\n"),"\n    ").concat(t.features.map((function(e){return function(e,t){var n=e.geometry.coordinates.map((function(e){return"".concat(Ua(e[0]),",").concat(Ua(e[1]))}));return'<polyline stroke="'.concat(t,'" fill="none" points="').concat(n.join(" "),'" />')}(e,"#f00")})).join("\n"),"\n    ").concat(n.map((function(e){return Ha(e,"#00f")})).join("\n"))}function Ha(e,t){var n=e.map((function(e){return"".concat(Ua(e.x),",").concat(Ua(e.y))}));return'<polygon stroke="'.concat(t,'" fill="none" points="').concat(n.join(" "),'" />')}function Ua(e){return e/25.4*96}function Ya(){var e=Object(s.useRef)(null);return Object(s.useEffect)((function(){(function(){var t=Object(H.a)(_.a.mark((function t(){return _.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ka();case 2:e.current=t.sent;case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[]),Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)(d.a,{container:!0,spacing:3,children:[Object(o.jsx)(d.a,{item:!0,xs:6,children:Object(o.jsx)("canvas",{id:"renderCanvas","touch-action":"none",width:800,height:800})}),Object(o.jsxs)(d.a,{item:!0,xs:6,children:[Object(o.jsx)("div",{style:{overflow:"scroll",width:"800px",height:"800px",border:"solid 1px #aaa"},children:Object(o.jsx)("svg",{id:"svg",viewBox:"500 6000 20000 16000",style:{},width:"8000",height:"8000"})}),Object(o.jsx)("br",{}),Object(o.jsx)(j.a,{variant:"contained",onClick:function(){console.log("download"),e.current.exportSTL()},children:"Export STL"}),Object(o.jsx)(j.a,{variant:"contained",onClick:function(){console.log("download"),e.current.startExport()},children:"Export SVG"})]})]})})}function Ka(){return Za.apply(this,arguments)}function Za(){return(Za=Object(H.a)(_.a.mark((function e(){var t,n,r,a,i,o,s,c,u,h,l,d,f,p,m,v,j;return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("renderCanvas"),n=new b.Engine(t,!0),r=N(n,t,700),new b.HemisphericLight("hemispheric-light",new b.Vector3(1,.7,1),r),a=new b.StandardMaterial("myMaterial",r),nn(30,r),e.next=8,Dn();case 8:i=e.sent,37,s=Ba(i,o={steps:256,numLayers:37,layerThickness:6.6,width:450,holderFromLayer:31,holderToLayer:33,minOverlap:8,defaultWidth:15,prefix:"A",radiusFunction:Da}),c=Object(fe.a)(s);try{for(c.s();!(u=c.n()).done;)h=u.value,Fa(h,o.layerThickness,r,a).position.y=h.id*o.layerThickness}catch(g){c.e(g)}finally{c.f()}return n.runRenderLoop((function(){r.render()})),l=Sa(s),d=l.shapes,f=l.engravings,p=l.panels,m=_a(d,f,p),document.getElementById("svg").innerHTML=m,v=function(){var e=Object(H.a)(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_n("export.svg",'<svg viewBox="0 0 20000 20000" xmlns="http://www.w3.org/2000/svg">'.concat(m,"</svg>"));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(){var e=Object(H.a)(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",{startExport:v,exportSTL:j});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Xa=n(531),qa=n(532);var Ja,Qa,$a=6.6;!function(e){e[e.WITCH_HAT=0]="WITCH_HAT",e[e.SHRINK_WRAP=1]="SHRINK_WRAP",e[e.SPHERE=2]="SPHERE",e[e.STRAIGHT=3]="STRAIGHT",e[e.CONE=4]="CONE",e[e.ANGLE=5]="ANGLE"}(Qa||(Qa={}));var ei,ti=(Ja={},Object(O.a)(Ja,Qa.SHRINK_WRAP,Da),Object(O.a)(Ja,Qa.WITCH_HAT,(function(e,t){return.2+.8*Math.pow(1-e,3)})),Object(O.a)(Ja,Qa.SPHERE,(function(e,t){return function(e,t,n){var r=t+(n-t)*e;return Math.sin(Math.acos(r))}(e,-.2,.9)})),Object(O.a)(Ja,Qa.STRAIGHT,(function(e,t){return 1})),Object(O.a)(Ja,Qa.CONE,(function(e,t){return.5+.5*(1-e)})),Object(O.a)(Ja,Qa.ANGLE,(function(e,t){return e>.3?q(e,1,.3,.4,.95):q(e,.3,0,.95,1)})),Ja);!function(e){e[e.NEW=0]="NEW",e[e.DRAWING=1]="DRAWING",e[e.DONE=2]="DONE"}(ei||(ei={}));var ni=function(){function e(t,n,r,a,i){Object(B.a)(this,e),this.modelProps=t,this.scene=n,this.setLoading=r,this.setPrice=a,this.setDimensions=i,this.rotation=0,this.status=ei.NEW,this.rootNode=void 0,this.extrasRootNode=void 0,this.material=void 0,this.font=null,this.pieces=[],this.drawingPieceNumber=0,this.rootNode=new b.TransformNode("modelRoot"),this.extrasRootNode=new b.TransformNode("extrasRoot"),this.material=C[t.material](n),xt(n),this.beforeRender=this.beforeRender.bind(this)}return Object(W.a)(e,[{key:"initAsync",value:function(){var e=Object(H.a)(_.a.mark((function e(){return _.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dn();case 2:this.font=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"start",value:function(){this.render()}},{key:"render",value:function(){la()(this.font),this.rootNode.getChildMeshes().forEach((function(e){e.dispose()}));var e=Math.round(10*this.modelProps.height/$a),t={steps:256,numLayers:e,layerThickness:$a,width:10*this.modelProps.diameter,holderFromLayer:e-8,holderToLayer:e-6,minOverlap:8,defaultWidth:15,prefix:"A",radiusFunction:ti[this.modelProps.radiusFunctionName]};this.pieces=Ba(this.font,t);var n=t.holderFromLayer*$a+20;gt(this.extrasRootNode,this.scene,n,0),this.rootNode.rotation.y=0,this.extrasRootNode.rotation.y=0,this.setPrice(this.modelProps.height*this.modelProps.diameter*.3),this.status=ei.DRAWING,this.drawingPieceNumber=0}},{key:"beforeRender",value:function(){if(this.rotation+=.001,this.rootNode.rotation.y=this.rotation,this.extrasRootNode.rotation.y=this.rotation,this.status===ei.DRAWING){var e=this.pieces[this.drawingPieceNumber],t=this.modelProps.preview?function(e,t,n,r){var a=new b.TransformNode("layer".concat(e.id)),i=b.MeshBuilder.ExtrudePolygon("layer".concat(e.id),{shape:ue(e.shape),holes:e.holes.map(ue),depth:200},n);i.position.y=100;var o=(t-3*Va)/2,s=Object(Bt.range)(100).map((function(e){return new Y.e(e%2*(o-Va),0,e*Ga/100-250)})),c=new Y.e(Va,0,0),u=[].concat(Object(g.a)(s),Object(g.a)(s.map((function(e){return e.add(c)})).reverse())),h=b.MeshBuilder.ExtrudePolygon("layer".concat(e.id,"-simple"),{shape:u.reverse(),depth:Ga},n);h.rotation.z=Math.PI/2,h.position.x=-250,h.bakeCurrentTransformIntoVertices(),h.rotation.y=Math.PI*Math.random();var l=b.CSG.FromMesh(h),d=b.CSG.FromMesh(i);console.time("intersect");var f=d.intersect(l);console.timeEnd("intersect");var p=f.toMesh("layer".concat(e.id,"-wave-bottom"),r,n);h.dispose(),i.dispose(),n.removeMesh(h),n.removeMesh(i),p.parent=a;var m=p.clone("layer".concat(e.id,"-wave-top"));m.position.y+=(t-.8)/2+Va,console.log("pos",p.position.y,m.position.y);var v=b.MeshBuilder.ExtrudePolygon("top".concat(e.id),{shape:ue(e.shape),holes:e.holes.map(ue),depth:Va},n);return v.parent=a,v.position.y=0,v.material=r,v.clone("mid".concat(e.id)).position.y=o+.8,v.clone("bottom".concat(e.id)).position.y=t-Va,a}(e,$a,this.scene,this.material):Fa(e,$a,this.scene,this.material);t.position.y=e.id*$a,t.parent=this.rootNode;var n=(this.drawingPieceNumber+1)/this.pieces.length;this.setLoading(n),this.drawingPieceNumber++,1===n&&(this.status=ei.DONE)}}},{key:"onUpdate",value:function(e){var t=this,n=J(this.modelProps,e);console.log(n,"changed"),this.modelProps=e,n.includes("material")?(console.log("material changed"),this.material=C[this.modelProps.material](this.scene),this.rootNode.getChildMeshes().forEach((function(e){e.material=t.material}))):this.render()}},{key:"startExport",value:function(){var e=Sa(this.pieces),t=_a(e.shapes,e.engravings,e.panels);_n("export.svg",'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20000 20000">'.concat(t,"</svg>"))}},{key:"commitChanges",value:function(){}}]),e}();function ri(){var e=Object(s.useState)(0),t=Object(l.a)(e,2),n=t[0],r=t[1],a=Object(s.useState)(0),c=Object(l.a)(a,2),u=c[0],h=c[1],p=Object(s.useState)(void 0),v=Object(l.a)(p,2),j=v[0],b=v[1],g=Object(s.useState)(void 0),x=Object(l.a)(g,2),O=x[0],y=x[1],w=Object(s.useState)(i.PLYWOOD),M=Object(l.a)(w,2),C=M[0],E=M[1],T=Object(s.useState)(Math.random().toString(36).substr(2,5)),S=Object(l.a)(T,2),R=S[0],L=(S[1],Object(s.useState)(40)),A=Object(l.a)(L,2),N=A[0],k=A[1],P=Object(s.useState)(25),I=Object(l.a)(P,2),B=I[0],W=I[1],z=Object(s.useState)(Qa.SHRINK_WRAP),D=Object(l.a)(z,2),V=D[0],F=D[1],G=Object(s.useState)(!1),_=Object(l.a)(G,2),H=_[0],U=_[1],Y={diameter:N,material:C,height:B,seed:R,radiusFunctionName:V,preview:H},K=qr(Y,ni,r,h,b,y,800);Object(s.useEffect)((function(){K&&K.onUpdate(Y)}),[N,C,B,R,V,H]);var Z=function(){K&&K.commitChanges()};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(pt,{fps:n,loading:u}),Object(o.jsx)(d.a,{item:!0,xs:3,style:{height:"100vh",overflow:"auto"},children:Object(o.jsxs)(ht.a,{p:4,children:[Object(o.jsx)(f.a,{component:"h2",variant:"h6",children:"Cardboard Lamp Designer"}),Object(o.jsx)(Lt,{material:C,setMaterial:E,onlyWood:!0}),Object(o.jsxs)(Se.a,{fullWidth:!0,select:!0,margin:"normal",label:"Model",value:V,onChange:function(e){F(e.target.value)},children:[Object(o.jsx)(m.a,{value:Qa.SHRINK_WRAP,children:"Shrink Wrap"}),Object(o.jsx)(m.a,{value:Qa.WITCH_HAT,children:"Witch Hat"}),Object(o.jsx)(m.a,{value:Qa.SPHERE,children:"Sphere"}),Object(o.jsx)(m.a,{value:Qa.STRAIGHT,children:"Straight"}),Object(o.jsx)(m.a,{value:Qa.CONE,children:"Cone"}),Object(o.jsx)(m.a,{value:Qa.ANGLE,children:"Angle"})]}),Object(o.jsx)(dt,{label:"Diameter",value:N,min:30,max:50,units:"cm",setValue:k,onCommit:Z}),Object(o.jsx)(dt,{label:"Height",value:B,min:15,max:50,units:"cm",setValue:W,onCommit:Z}),Object(o.jsx)(Xa.a,{control:Object(o.jsx)(qa.a,{checked:H,onChange:function(e){U(e.target.checked)}}),label:"High quality preview"}),j&&Object(o.jsx)(It,{onExport:function(){return K&&K.startExport()},price:j,dimensions:O,modelProps:Y})]})})]})}window.earcut=P;var ai=Object(He.a)((function(e){return{root:{height:"100vh"}}}));var ii=function(){var e=ai();return Object(o.jsxs)(d.a,{container:!0,component:"main",className:e.root,children:[Object(o.jsx)(Ue.a,{}),Object(o.jsx)(Ve.a,{children:Object(o.jsxs)(Fe.c,{children:[Object(o.jsx)(Fe.a,{path:"/cardboard",children:Object(o.jsx)(ri,{})}),Object(o.jsx)(Fe.a,{path:"/grow",children:Object(o.jsx)(Oe,{})}),Object(o.jsx)(Fe.a,{path:"/veins",children:Object(o.jsx)(De,{})}),Object(o.jsx)(Fe.a,{path:"/pixel",children:Object(o.jsx)(k,{})}),Object(o.jsx)(Fe.a,{path:"/branch",children:Object(o.jsx)(F,{})}),Object(o.jsx)(Fe.a,{path:"/test-tube",children:Object(o.jsx)(_e,{})}),Object(o.jsx)(Fe.a,{path:"/test-material",children:Object(o.jsx)(pa,{})}),Object(o.jsx)(Fe.a,{path:"/test/text",children:Object(o.jsx)(ma,{})}),Object(o.jsx)(Fe.a,{path:"/test/cardboard",children:Object(o.jsx)(Ya,{})}),Object(o.jsx)(Fe.a,{path:"/test/connector",children:Object(o.jsx)(xa,{})}),Object(o.jsx)(Fe.a,{path:"/test/shapes",children:Object(o.jsx)(Oa,{})}),Object(o.jsx)(Fe.a,{path:"/ico",children:Object(o.jsx)(qe,{})}),Object(o.jsx)(Fe.a,{path:"/csg",children:Object(o.jsx)($e,{})}),Object(o.jsx)(Fe.a,{path:"/box",children:Object(o.jsx)(ut,{})}),Object(o.jsx)(Fe.a,{path:"/debug",children:Object(o.jsx)(Ee,{})}),Object(o.jsx)(Fe.a,{path:"/clipper",children:Object(o.jsx)(tn,{})}),Object(o.jsx)(Fe.a,{path:"/test",children:Object(o.jsx)(gr,{})}),Object(o.jsx)(Fe.a,{path:"/holder",children:Object(o.jsx)(Yr,{})}),Object(o.jsx)(Fe.a,{path:"/joints",children:Object(o.jsx)(Kr,{})}),Object(o.jsx)(Fe.a,{path:"/polygon",children:Object(o.jsx)(Hr,{})}),Object(o.jsx)(Fe.a,{path:"/socket",children:Object(o.jsx)(Zr,{})}),Object(o.jsx)(Fe.a,{path:"/cubism",children:Object(o.jsx)(Yt,{})}),Object(o.jsx)(Fe.a,{path:"/infinity",children:Object(o.jsx)(Zt,{})}),Object(o.jsx)(Fe.a,{path:"/sphere",children:Object(o.jsx)(Qt,{})}),Object(o.jsx)(Fe.a,{path:"/wood-sphere",children:Object(o.jsx)(Ca,{})}),Object(o.jsx)(Fe.a,{path:"/wood",children:Object(o.jsx)(_r,{})}),Object(o.jsx)(Fe.a,{path:"/wood-grow",children:Object(o.jsx)($r,{})}),Object(o.jsx)(Fe.a,{path:"/wood-3d",children:Object(o.jsx)(fa,{})}),Object(o.jsx)(Fe.a,{path:"/",children:Object(o.jsx)(Xt,{})})]})})]})},oi=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,544)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),i(e),o(e)}))};h.a.render(Object(o.jsx)(c.a.StrictMode,{children:Object(o.jsx)(ii,{})}),document.getElementById("root")),oi()}},[[482,1,2]]]);